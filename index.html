<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>GrumpyLinks â€“ AI-Powered Pain Point Discovery</title>
<script src="env-config.js"></script>
<style>
:root {
  --bg:#fafafa; --sidebar:#ffffff; --card:#ffffff; --ink:#1a1a1a; --muted:#6b7280;
  --accent:#3b82f6; --success:#10b981; --warning:#f59e0b; --danger:#ef4444;
  --border:#e5e7eb; --hover:#f9fafb; --subtle:#f8fafc;
  --shadow:0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
  --shadow-lg:0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  --shadow-xl:0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  --header-height: 64px; /* Define a fixed height for the top bar */
  
  /* Platform Colors */
  --reddit:#ff4500; --twitter:#1da1f2; --linkedin:#0077b5; --hackernews:#ff6600;
  --github:#333; --stackoverflow:#f48024; --medium:#000; --quora:#b92b27;
  --youtube:#ff0000; --producthunt:#da552f; --discord:#5865f2; --glassdoor:#0caa41;
  --trustpilot:#00b67a; --appstore:#007aff; --tiktok:#000000;
}

* { box-sizing: border-box; }
html,body { margin:0; padding:0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', Helvetica, sans-serif; }
body { background:var(--bg); color:var(--ink); line-height:1.6; font-size:14px; overflow-x: hidden; }

/* Layout */
.app { 
  display:flex; 
  flex-direction:column; /* Stack header and main content vertically */
  min-height:100vh; 
  width: 100%; 
  max-width: 100vw; 
}

/* Header/Top Bar */
.header-top-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 32px; /* Consistent padding */
  height: var(--header-height);
  background: var(--sidebar); /* Match sidebar background for continuity */
  border-bottom: 1px solid var(--border);
  box-shadow: var(--shadow);
  flex-shrink: 0; /* Prevent header from shrinking */
  position: sticky; /* Make it sticky */
  top: 0;
  z-index: 100;
}

.header-logo {
  display: flex;
  align-items: center;
  gap: 8px; /* Space between emoji and text */
  text-decoration: none;
  color: var(--ink);
}

.header-logo .logo-emoji {
  font-size: 32px; /* Smaller for header */
  line-height: 1;
}

.header-logo .logo-text {
  font-size: 20px;
  font-weight: 700;
  letter-spacing: -0.5px;
}

.header-logo .logo-subtitle {
  display: none; /* Hide on small header, or make it very subtle */
}

/* Main search in header */
.header-search-container {
  display: flex;
  flex-grow: 1; /* Allow search to take available space */
  max-width: 700px; /* Constrain width on large screens */
  margin: 0 20px;
  gap: 8px;
  align-items: center;
}

.header-search-input {
  flex-grow: 1;
  padding: 10px 14px;
  border: 1px solid var(--border);
  border-radius: 8px;
  font-size: 15px;
  background: var(--subtle);
  transition: all 0.2s ease;
  font-weight: 500;
}
.header-search-input:focus {
  outline: none;
  border-color: var(--accent);
  background: white;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.header-query-dropdown {
  padding: 10px 14px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: white;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}
.header-query-dropdown:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.header-search-btn {
  padding: 10px 20px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 15px;
  box-shadow: var(--shadow);
  flex-shrink: 0;
}
.header-search-btn:hover {
  background: #2563eb;
  transform: translateY(-1px);
  box-shadow: var(--shadow-lg);
}

.newsletter-toggle-btn {
  background: none;
  border: 1px solid var(--border);
  padding: 8px 12px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  color: var(--ink);
  cursor: pointer;
  transition: all 0.2s ease;
}
.newsletter-toggle-btn:hover {
  background: var(--hover);
  border-color: var(--accent);
}

/* Mobile filter/nav toggle */
.mobile-filter-toggle {
  display: none; /* Hidden by default on desktop */
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--ink);
}

/* Main Content */
.main-content { 
  flex:1; 
  padding:24px 32px; 
  overflow-y:auto; 
  background:var(--bg); 
  display: flex;
  flex-direction: column;
}

/* Content Header - Simplified */
.content-header {
  margin-bottom:24px; /* More space */
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.page-title { 
  font-size:28px; /* Slightly larger */
  font-weight:800; 
  margin:0; 
  color:var(--ink); 
  letter-spacing:-0.8px;
}
.page-subtitle { 
  font-size:15px; 
  color:var(--muted); 
  margin:0; 
  font-weight:500;
}

/* Filters Section (Desktop) */
.filter-section-desktop {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 24px; /* Space below filters */
  display: grid; 
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  box-shadow: var(--shadow);
  align-items: center;
}

.filter-section-desktop .nav-title {
  font-size:11px; font-weight:600; color:var(--muted); 
  text-transform:uppercase; letter-spacing:1px; 
  margin-bottom:0; /* Align with inputs */
  align-self: center;
}

.filter-select {
  width:100%; padding:10px 14px; border:1px solid var(--border);
  border-radius:8px; background:white; font-size:14px;
  font-weight:500; cursor:pointer; transition:all 0.2s ease;
}
.filter-select:focus {
  outline:none; border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(59, 130, 246, 0.1);
}

.overall-insights-card {
  background: linear-gradient(135deg, var(--accent) 0%, #2563eb 100%);
  color: white;
  padding: 24px;
  border-radius: 10px;
  margin-bottom: 24px;
  box-shadow: var(--shadow-lg);
}

.overall-insights-card h2 {
  font-size: 20px;
  font-weight: 700;
  margin-top: 0;
  margin-bottom: 12px;
}

.overall-insights-card p {
  font-size: 16px;
  line-height: 1.5;
  margin-bottom: 16px;
  opacity: 0.9;
}

.overall-insights-card ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.overall-insights-card li {
  font-size: 15px;
  margin-bottom: 8px;
  position: relative;
  padding-left: 20px;
}

.overall-insights-card li::before {
  content: 'ðŸ’¡'; /* Lightbulb emoji */
  position: absolute;
  left: 0;
  font-size: 14px;
  top: 2px;
}

/* Results Header - Simplified */
.results-header {
  margin-bottom:16px;
}
.section-title { font-size:18px; font-weight:700; margin:0; color:var(--ink); }

.results-grid {
  display:grid; grid-template-columns:repeat(auto-fit, minmax(380px, 1fr)); /* Adjusted minmax for better fit */
  gap:16px;
}

/* Card Design - More Compact */
.result-card {
  background:white; border:1px solid var(--border); border-radius:10px;
  padding:20px; transition:all 0.3s ease; position:relative;
  box-shadow:var(--shadow);
  display: flex;
  flex-direction: column;
}
.result-card:hover {
  box-shadow:var(--shadow-lg); /* Slightly less aggressive shadow on hover */
  transform:translateY(-2px); /* More noticeable lift */
  border-color:#d1d5db;
}

.card-header {
  margin-bottom:12px;
}

.result-title {
  font-weight:700; font-size:16px; line-height:1.4; margin:0 0 8px 0; /* Slightly larger title */
  color:var(--ink);
}
.result-title a { color:inherit; text-decoration:none; }
.result-title a:hover { color:var(--accent); }

.source-badge {
  display:inline-flex; align-items:center; gap:4px; padding:3px 8px; border-radius:4px; 
  font-size:10px; font-weight:600; color:white; text-transform:uppercase;
  letter-spacing:0.5px;
}
.source-reddit { background:var(--reddit); }
.source-twitter { background:var(--twitter); }
.source-linkedin { background:var(--linkedin); }
.source-hackernews { background:var(--hackernews); }
.source-github { background:var(--github); }
.source-stackoverflow { background:var(--stackoverflow); }
.source-medium { background:var(--medium); }
.source-quora { background:var(--quora); }
.source-youtube { background:var(--youtube); }
.source-producthunt { background:var(--producthunt); }
.source-discord { background:var(--discord); }
.source-glassdoor { background:var(--glassdoor); }
.source-trustpilot { background:var(--trustpilot); }
.source-appstore { background:var(--appstore); }
.source-tiktok { background:var(--tiktok); }
.source-default { background:var(--muted); }

.result-snippet {
  color:var(--muted); font-size:14px; line-height:1.5; /* Slightly larger snippet font */
  margin-bottom:16px; display:-webkit-box; -webkit-line-clamp:3; 
  -webkit-box-orient:vertical; overflow:hidden;
}

/* AI Insight - Emphasized */
.ai-insight {
  background:var(--subtle); /* Consistent light background */
  border:1px solid var(--border); /* Subtle border */
  border-left: 4px solid var(--accent); /* Accent color left border for emphasis */
  border-radius:6px; 
  padding:15px; /* More padding */
  margin-bottom:12px;
  flex-grow: 1; /* Make insight fill available vertical space */
  display: flex;
  flex-direction: column;
}
.ai-insight-label {
  font-size:10px; font-weight:600; color:var(--muted);
  text-transform:uppercase; letter-spacing:1px; margin-bottom:8px; /* More space */
  display:flex; justify-content:space-between; align-items:center;
}
.urgency-badge {
  padding:3px 8px; border-radius:12px; font-size:10px; font-weight:700; /* Slightly larger badge */
  text-transform:uppercase; letter-spacing:0.5px;
}
.urgency-high { background:var(--danger); color:white; }
.urgency-medium { background:var(--warning); color:white; }
.urgency-low { background:var(--muted); color:white; }

.ai-insight-text {
  font-size:14px; color:var(--ink); line-height:1.4;
  font-weight:500;
  flex-grow: 1; /* Allow text to grow */
}

.card-footer {
  display:flex; justify-content:space-between; align-items:center;
  font-size:12px; /* Slightly larger footer font */
  color:var(--muted); margin-top:16px;
  padding-top:12px; border-top:1px solid var(--border);
}

.copy-link {
  color:var(--accent); cursor:pointer; font-weight:600;
  padding:6px 10px; border-radius:6px; transition:all 0.2s ease; /* Larger touch target */
  font-size:12px; text-transform:uppercase; letter-spacing:0.5px;
}
.copy-link:hover { 
  background:var(--accent); 
  color:white;
  transform:translateY(-1px);
  box-shadow: var(--shadow);
}

/* Loading & Empty States */
.loading { 
  text-align:center; padding:60px 20px; color:var(--muted);
  grid-column:1 / -1;
}
.spinner {
  display:inline-block; width:18px; height:18px; margin-right:8px;
  border:2px solid var(--border); border-top:2px solid var(--accent);
  border-radius:50%; animation:spin 1s linear infinite;
}
@keyframes spin { 0%{ transform:rotate(0deg); } 100%{ transform:rotate(360deg); } }

.empty-state { 
  text-align:center; padding:60px 20px; color:var(--muted);
  grid-column:1 / -1;
}
.empty-state h3 { color:var(--ink); font-weight:700; margin-bottom:8px; font-size:18px; }

/* Newsletter Modal/Overlay */
.newsletter-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.6);
  display: none; /* Hidden by default */
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.newsletter-modal-content {
  background: var(--card);
  padding: 30px;
  border-radius: 10px;
  box-shadow: var(--shadow-lg);
  max-width: 400px;
  width: 90%;
  text-align: center;
  position: relative;
}

.newsletter-modal-close {
  position: absolute;
  top: 15px;
  right: 15px;
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--muted);
}
.newsletter-modal-close:hover {
  color: var(--ink);
}

.newsletter-modal .newsletter-desc {
  font-size: 14px;
  margin-bottom: 20px;
}

.newsletter-modal .newsletter-btn {
  background:var(--success) !important;
  margin-top: 10px;
}

.newsletter-modal .newsletter-privacy {
  font-size: 11px;
  margin-top: 10px;
}

/* Mobile Nav/Filter Modal */
.mobile-nav-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: var(--sidebar);
  z-index: 999; /* Below newsletter modal */
  padding: 20px;
  display: none; /* Hidden by default, toggled by JS */
  overflow-y: auto;
  transform: translateX(100%); /* Start off-screen */
  transition: transform 0.3s ease-out;
}

.mobile-nav-modal.active {
  transform: translateX(0);
}

.mobile-nav-modal .nav-section {
  margin-bottom: 20px;
}

.mobile-nav-modal .nav-title {
  margin-bottom: 10px;
}

.mobile-nav-modal .search-input,
.mobile-nav-modal .query-dropdown,
.mobile-nav-modal .filter-select {
  width: 100%;
  padding: 10px 14px;
  margin-bottom: 8px;
  font-size: 16px; /* Prevent zoom on iOS */
}

/* Responsive adjustments */
@media (max-width: 1024px) {
  .header-top-bar {
    padding: 0 16px;
    height: 56px; /* Slightly shorter on mobile */
  }

  .header-search-container {
    display: none; /* Hide main search from header on mobile, move to modal */
  }

  .newsletter-toggle-btn {
    display: none; /* Hide newsletter toggle button on mobile header */
  }

  .mobile-filter-toggle {
    display: block; /* Show hamburger/filter button */
  }

  .filter-section-desktop {
    display: none; /* Hide desktop filters on mobile */
  }

  .main-content {
    padding: 16px;
  }

  .page-title {
    font-size: 24px;
  }

  .results-grid {
    grid-template-columns: 1fr;
    gap: 12px;
  }
  .result-card {
    padding: 16px;
  }
}

@media (max-width: 768px) {
  .header-top-bar {
    padding: 0 12px;
  }
  .main-content {
    padding: 12px;
  }
  .overall-insights-card {
    padding: 20px;
  }
  .overall-insights-card h2 {
    font-size: 18px;
  }
  .overall-insights-card p {
    font-size: 14px;
  }
  .overall-insights-card li {
    font-size: 14px;
  }
  .newsletter-modal-content {
    padding: 20px;
  }
}
</style>
</head>
<body>

<div class="app">
  <header class="header-top-bar">
    <a href="#" class="header-logo" onclick="location.reload(); return false;">
      <span class="logo-emoji">ðŸ˜ </span>
      <span class="logo-text">GrumpyLinks</span>
    </a>

    <div class="header-search-container">
      <input id="headerSearchInput" class="header-search-input" type="text" 
             placeholder="Brand, product, or topic..." />
      <select id="headerQueryDropdown" class="header-query-dropdown">
        <option value="">General Pain Points</option>
        <option value="competitor_hate">Competitor Complaints</option>
        <option value="switching_signals">Switching Signals</option>
        <option value="wish_list">Unmet Needs</option>
        <option value="feature_requests">Feature Requests</option>
        <option value="urgent_help">Urgent Problems</option>
      </select>
      <button id="headerSearchBtn" class="header-search-btn">Search</button>
    </div>

    <button id="newsletterToggleBtn" class="newsletter-toggle-btn">Subscribe</button>
    <button id="mobileFilterToggle" class="mobile-filter-toggle">â˜°</button>
  </header>

  <main class="main-content">
    <header class="content-header">
      <h1 class="page-title" id="pageTitle">User Pain Points</h1>
    </header>

    <section class="filter-section-desktop">
      <div class="nav-title">Filters</div>
      <select id="platformSelect" class="filter-select">
        <option value="all">All Platforms</option>
        <option value="reddit">Reddit</option>
        <option value="twitter">Twitter</option>
        <option value="linkedin">LinkedIn</option>
        <option value="hackernews">Hacker News</option>
        <option value="youtube">YouTube</option>
        <option value="medium">Medium</option>
        <option value="producthunt">Product Hunt</option>
        <option value="discord">Discord</option>
        <option value="glassdoor">Glassdoor</option>
        <option value="trustpilot">Trustpilot</option>
        <option value="appstore">App Stores</option>
        <option value="forums">Forums</option>
      </select>
      
      <select id="timeSelect" class="filter-select">
        <option value="d7">Last 7 days</option>
        <option value="d1">Last 24 hours</option>
        <option value="d30">Last 30 days</option>
        <option value="d365">Last year</option>
      </select>
    </section>

    <section id="overallInsights" class="overall-insights-card" style="display:none;">
      <h2 id="mainPainPoint"></h2>
      <p>Overall Opportunity Score: <span id="opportunityScore"></span>/10</p>
      <h3>Top Actionable Ideas:</h3>
      <ul id="topActionableIdeas"></ul>
    </section>

    <section class="results-section">
      <div id="resultsGrid" class="results-grid">
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading demo search...</p>
        </div>
      </div>
    </section>
  </main>

  <div id="newsletterModal" class="newsletter-modal">
    <div class="newsletter-modal-content">
      <button class="newsletter-modal-close" id="newsletterCloseBtn">&times;</button>
      <div class="logo">
        <span class="logo-emoji">ðŸ˜ </span>
        <span class="logo-text">GrumpyLinks</span>
      </div>
      <p class="newsletter-desc">
        User pain points and business opportunities delivered to your inbox
      </p>
      <input id="emailInput" class="header-search-input" type="email" 
             placeholder="your@email.com" style="margin-bottom:6px;" />
      <button id="subscribeBtn" class="header-search-btn newsletter-btn">
        Subscribe Free
      </button>
      <div class="newsletter-privacy">
        No spam, unsubscribe anytime
      </div>
    </div>
  </div>

  <div id="mobileNavModal" class="mobile-nav-modal">
    <div class="nav-section">
      <div class="nav-title">Search</div>
      <input id="mobileSearchInput" class="search-input" type="text" 
             placeholder="Brand, product, or topic..." />
      <select id="mobileQueryDropdown" class="query-dropdown">
        <option value="">General Pain Points</option>
        <option value="competitor_hate">Competitor Complaints</option>
        <option value="switching_signals">Switching Signals</option>
        <option value="wish_list">Unmet Needs</option>
        <option value="feature_requests">Feature Requests</option>
        <option value="urgent_help">Urgent Problems</option>
      </select>
      <button id="mobileSearchBtn" class="search-btn">Search</button>
    </div>

    <div class="nav-section">
      <div class="nav-title">Filters</div>
      <select id="mobilePlatformSelect" class="filter-select">
        <option value="all">All Platforms</option>
        <option value="reddit">Reddit</option>
        <option value="twitter">Twitter</option>
        <option value="linkedin">LinkedIn</option>
        <option value="hackernews">Hacker News</option>
        <option value="youtube">YouTube</option>
        <option value="medium">Medium</option>
        <option value="producthunt">Product Hunt</option>
        <option value="discord">Discord</option>
        <option value="glassdoor">Glassdoor</option>
        <option value="trustpilot">Trustpilot</option>
        <option value="appstore">App Stores</option>
        <option value="forums">Forums</option>
      </select>
      
      <select id="mobileTimeSelect" class="filter-select">
        <option value="d7">Last 7 days</option>
        <option value="d1">Last 24 hours</option>
        <option value="d30">Last 30 days</option>
        <option value="d365">Last year</option>
      </select>
    </div>
    <div class="nav-section">
      <button id="mobileCloseNav" class="newsletter-toggle-btn">Close Filters</button>
    </div>
  </div>

</div>

<script>
// Configuration
const API_CONFIG = {
  GOOGLE_API_KEY: '',
  SEARCH_ENGINE_ID: '',
  LAMBDA_ENDPOINT: ''
};

function loadConfig() {
  if (window.ENV) {
    API_CONFIG.GOOGLE_API_KEY = window.ENV.GOOGLE_API_KEY || '';
    API_CONFIG.SEARCH_ENGINE_ID = window.ENV.SEARCH_ENGINE_ID || '';
    API_CONFIG.LAMBDA_ENDPOINT = window.ENV.LAMBDA_ENDPOINT || '';
  }
}

// Power Queries
const POWER_QUERIES = {
  'competitor_hate': {
    id: 'competitor_hate',
    title: 'Competitor Complaints',
    template: '("hate" OR "frustrated with" OR "terrible") {{keyword}}'
  },
  'switching_signals': {
    id: 'switching_signals',
    title: 'Switching Signals',
    template: '("switching from" OR "alternative to" OR "leaving") {{keyword}}'
  },
  'wish_list': {
    id: 'wish_list',
    title: 'Unmet Needs',
    template: '"I wish there was" OR "someone should build" {{keyword}}'
  },
  'feature_requests': {
    id: 'feature_requests',
    title: 'Feature Requests',
    template: '("should add" OR "missing feature" OR "needs to support") {{keyword}}'
  },
  'urgent_help': {
    id: 'urgent_help',
    title: 'Urgent Problems',
    template: '("need help with" OR "urgent" OR "stuck with") {{keyword}}'
  }
};

const PLATFORMS = {
  all: { sites: [] },
  reddit: { sites: ['site:reddit.com'] },
  twitter: { sites: ['site:twitter.com', 'site:x.com'] },
  linkedin: { sites: ['site:linkedin.com'] },
  hackernews: { sites: ['site:news.ycombinator.com'] },
  youtube: { sites: ['site:youtube.com'] },
  medium: { sites: ['site:medium.com'] },
  producthunt: { sites: ['site:producthunt.com'] },
  discord: { sites: ['site:discord.com'] },
  glassdoor: { sites: ['site:glassdoor.com'] },
  trustpilot: { sites: ['site:trustpilot.com'] },
  appstore: { sites: ['site:apps.apple.com', 'site:play.google.com'] },
  forums: { sites: ['site:stackoverflow.com', 'site:quora.com'] }
};

let currentAnalysis = null;

// Demo Results Data
const DEMO_RESULTS = {
  query: "airplane wifi",
  results: [
    {
      title: "Zach (Probably) on X: \"This is actually painful, #ChatGPT works well ...\"",
      snippet: "This is actually painful, #ChatGPT works well on airplane wifi more or less... #Grok... Sucks. Like holy fuck does it SUCK on whatever insane networking is ...",
      link: "https://x.com/ThatOtherZach/status/1956024889560760322",
      displayLink: "x.com",
      insight: {
        businessOpportunity: "Develop an AI model optimized for low-bandwidth airplane wifi that offers a competitive advantage over existing AI assistants like Grok. Market it directly to travelers.",
        urgency: "medium"
      }
    },
    {
      title: "Why Wont Snapchat Work on Breeze Airplane Wifi | TikTok",
      snippet: "... broken Â· original sound - The office quote.s Â· Why Wont My Snap Chat Let Me ... Snapchat Is So Annoying Â· Why Is Snapchat Not Sending My Snaps. 364Likes. 203 ...",
      link: "https://www.tiktok.com/discover/why-wont-snapchat-work-on-breeze-airplane-wifi",
      displayLink: "www.tiktok.com",
      insight: {
        businessOpportunity: "Create a mobile app troubleshooting guide specifically for Snapchat and other popular apps on Breeze Airways wifi, offering solutions and workarounds.",
        urgency: "medium"
      }
    },
    {
      title: "iOS - NextDNS Help Center",
      snippet: "Public WiFis / Airplane WiFi / Hotel WiFis / Captive Portal WiFis. Couldn't ... Wrongly 'seemingly' blocked from NextDNS and need help here.. also for ...",
      link: "https://help.nextdns.io/tag/ios",
      displayLink: "help.nextdns.io",
      insight: {
        businessOpportunity: "Offer a VPN service optimized to bypass captive portals and improve connectivity on public and airplane wifi networks, specifically for iOS devices.",
        urgency: "high"
      }
    },
    {
      title: "How to Connect Laptop to Airplane Wifi | TikTok",
      snippet: "... Airplane Wifi Spirit, How to Fix Unable to Connect to Wifi Hp Laptop ... How to Connect Phone to Pc with Broken Screen Â· Cara Guna Usb Wifi Adapter.",
      link: "https://www.tiktok.com/discover/how-to-connect-laptop-to-airplane-wifi",
      displayLink: "www.tiktok.com",
      insight: {
        businessOpportunity: "Develop a simplified step-by-step video tutorial series on connecting different laptop brands to airplane wifi, monetized through ads or premium content.",
        urgency: "low"
      }
    },
    {
      title: "Reclining your seat on a flight. I didn't know it was so taboo ...",
      snippet: "airplane wifi is ass so I used my Nintendo Switch) But for longer flights ... What do you need help on? Cancel X. Post New Message. You're browsing the ...",
      link: "https://gamefaqs.gamespot.com/boards/264562-playstation-5/81025624",
      displayLink: "gamefaqs.gamespot.com",
      insight: {
        businessOpportunity: "Develop a curated entertainment package (movies, games, ebooks) that can be downloaded before the flight and enjoyed without relying on airplane wifi.",
        urgency: "low"
      }
    },
    {
      title: "Starlink MCI to IAH : r/unitedairlines",
      snippet: "... airplane WiFi. Upvote 2. Downvote Reply reply. Award ... I hate this about United Â· r/unitedairlines - I hate this about United. 2. 25 ...",
      link: "https://www.reddit.com/r/unitedairlines/comments/1mqcce2/starlink_mci_to_iah/",
      displayLink: "www.reddit.com",
      insight: {
        businessOpportunity: "Create a real-time airplane wifi speed test and review platform where users can rate and compare the performance of different airlines' wifi services. Offer premium data insights to airlines.",
        urgency: "medium"
      }
    }
  ],
  overallAnalysis: {
    mainPainPoint: "Users frequently experience frustration with slow, unreliable, or non-functional airplane and public Wi-Fi, impacting their ability to use apps, AI services, and enjoy digital entertainment.",
    overallOpportunityScore: 7,
    topActionableIdeas: [
      "Develop specialized software/hardware for optimizing app performance on low-bandwidth networks (e.g., AI models, streaming enhancers).",
      "Create comprehensive troubleshooting guides or tools for common public/airplane Wi-Fi connectivity issues across various devices.",
      "Offer offline entertainment packages or VPN services designed to bypass common Wi-Fi restrictions and improve user experience."
    ]
  }
};

// Initialize
function init() {
  loadConfig();
  setupEventListeners();
  loadDemoSearch();
}

function setupEventListeners() {
  // Header search
  document.getElementById('headerSearchBtn').onclick = performSearch;
  document.getElementById('headerSearchInput').onkeydown = (e) => {
    if (e.key === 'Enter') performSearch();
  };
  document.getElementById('headerSearchInput').oninput = (e) => {
    localStorage.setItem('grumpy_search', e.target.value);
  };

  // Mobile search (within modal)
  document.getElementById('mobileSearchBtn').onclick = performSearchFromMobile;
  document.getElementById('mobileSearchInput').onkeydown = (e) => {
    if (e.key === 'Enter') performSearchFromMobile();
  };

  // Newsletter signup handler
  document.getElementById('newsletterToggleBtn').onclick = () => {
    document.getElementById('newsletterModal').style.display = 'flex';
  };
  document.getElementById('newsletterCloseBtn').onclick = () => {
    document.getElementById('newsletterModal').style.display = 'none';
  };
  document.getElementById('subscribeBtn').onclick = handleNewsletterSignup;
  document.getElementById('emailInput').onkeydown = (e) => {
    if (e.key === 'Enter') handleNewsletterSignup();
  };

  // Mobile filter/nav toggle
  document.getElementById('mobileFilterToggle').onclick = () => {
    document.getElementById('mobileNavModal').classList.add('active');
  };
  document.getElementById('mobileCloseNav').onclick = () => {
    document.getElementById('mobileNavModal').classList.remove('active');
  };

  // Sync inputs across desktop/mobile views
  document.getElementById('headerSearchInput').addEventListener('input', (e) => {
    document.getElementById('mobileSearchInput').value = e.target.value;
  });
  document.getElementById('mobileSearchInput').addEventListener('input', (e) => {
    document.getElementById('headerSearchInput').value = e.target.value;
  });
  document.getElementById('headerQueryDropdown').addEventListener('change', (e) => {
    document.getElementById('mobileQueryDropdown').value = e.target.value;
  });
  document.getElementById('mobileQueryDropdown').addEventListener('change', (e) => {
    document.getElementById('headerQueryDropdown').value = e.target.value;
  });
  document.getElementById('platformSelect').addEventListener('change', (e) => {
    document.getElementById('mobilePlatformSelect').value = e.target.value;
  });
  document.getElementById('mobilePlatformSelect').addEventListener('change', (e) => {
    document.getElementById('platformSelect').value = e.target.value;
  });
  document.getElementById('timeSelect').addEventListener('change', (e) => {
    document.getElementById('mobileTimeSelect').value = e.target.value;
  });
  document.getElementById('mobileTimeSelect').addEventListener('change', (e) => {
    document.getElementById('timeSelect').value = e.target.value;
  });
}

function handleNewsletterSignup() {
  const email = document.getElementById('emailInput').value.trim();
  if (!email) {
    alert('Please enter your email address');
    return;
  }
  
  if (!email.includes('@')) {
    alert('Please enter a valid email address');
    return;
  }
  
  const btn = document.getElementById('subscribeBtn');
  const originalText = btn.textContent;
  btn.textContent = 'Subscribed! âœ“';
  btn.style.background = 'var(--success)';
  
  setTimeout(() => {
    btn.textContent = originalText;
    document.getElementById('emailInput').value = '';
    document.getElementById('newsletterModal').style.display = 'none'; // Close modal after success
  }, 2000);
  
  console.log('Newsletter signup:', email);
}

function loadDemoSearch() {
  document.getElementById('headerSearchInput').value = DEMO_RESULTS.query;
  document.getElementById('mobileSearchInput').value = DEMO_RESULTS.query; // Sync mobile input
  displayDemoResults();
}

function displayDemoResults() {
  const grid = document.getElementById('resultsGrid');
  const pageTitle = document.getElementById('pageTitle');
  const overallInsightsCard = document.getElementById('overallInsights');
  
  pageTitle.textContent = `User Pain Points for "${DEMO_RESULTS.query}"`;

  // Display overall insights
  if (DEMO_RESULTS.overallAnalysis) {
    overallInsightsCard.style.display = 'block';
    document.getElementById('mainPainPoint').textContent = DEMO_RESULTS.overallAnalysis.mainPainPoint;
    document.getElementById('opportunityScore').textContent = DEMO_RESULTS.overallAnalysis.overallOpportunityScore;
    const topIdeasList = document.getElementById('topActionableIdeas');
    topIdeasList.innerHTML = '';
    DEMO_RESULTS.overallAnalysis.topActionableIdeas.forEach(idea => {
      const li = document.createElement('li');
      li.textContent = idea;
      topIdeasList.appendChild(li);
    });
  } else {
    overallInsightsCard.style.display = 'none';
  }
  
  let html = '';
  DEMO_RESULTS.results.forEach(result => {
    const platformClass = getPlatformClass(result.displayLink);
    const platformName = getPlatformName(result.displayLink);
    
    let snippet = result.snippet;
    const painWords = ['painful', 'sucks', 'hate', 'broken', 'annoying', 'ass', 'taboo', 'blocked', 'help', 'frustrated', 'wish', 'need', 'urgent', 'switching', 'alternative', 'missing', 'lack', 'terrible', 'doesn\'t work', 'awful'];
    painWords.forEach(word => {
      const regex = new RegExp(`\\b${word}\\b`, 'gi');
      snippet = snippet.replace(regex, `<mark style="background:#fef3c7; padding:2px 4px; border-radius:3px; font-weight:600;">$&</mark>`);
    });
    
    html += `
      <div class="result-card">
        <div class="card-header">
          <h3 class="result-title">
            <a href="${result.link}" target="_blank" rel="noopener">${result.title}</a>
          </h3>
          <span class="source-badge ${platformClass}">${platformName}</span>
        </div>
        
        <div class="result-snippet">${snippet}</div>
        
        <div class="ai-insight">
          <div class="ai-insight-label">
            Business Opportunity
            <span class="urgency-badge urgency-${result.insight.urgency}">
              ${result.insight.urgency.toUpperCase()}
            </span>
          </div>
          <div class="ai-insight-text">${result.insight.businessOpportunity}</div>
        </div>
        
        <div class="card-footer">
          <span>${result.displayLink}</span>
          <span class="copy-link" onclick="copyToClipboard('${result.link}')">Copy Link</span>
        </div>
      </div>
    `;
  });
  
  grid.innerHTML = html;
}

function buildSearchQuery(template, keyword, platform) {
  let query = template.replace(/\{\{keyword\}\}/g, `"${keyword}"`);
  
  const platformConfig = PLATFORMS[platform] || PLATFORMS.all;
  if (platformConfig.sites.length > 0) {
    query += ' (' + platformConfig.sites.join(' OR ') + ')';
  }
  
  return query;
}

function buildNormalSearchQuery(keyword, platform) {
  let query = `("frustrated" OR "hate" OR "terrible" OR "broken" OR "annoying" OR "wish there was" OR "need help" OR "problem with" OR "doesn't work" OR "awful" OR "sucks") "${keyword}"`;
  
  const platformConfig = PLATFORMS[platform] || PLATFORMS.all;
  if (platformConfig.sites.length > 0) {
    query += ' (' + platformConfig.sites.join(' OR ') + ')';
  }
  
  return query;
}

function getPlatformClass(domain) {
  if (domain.includes('reddit')) return 'source-reddit';
  if (domain.includes('twitter') || domain.includes('x.com')) return 'source-twitter';
  if (domain.includes('linkedin')) return 'source-linkedin';
  if (domain.includes('news.ycombinator')) return 'source-hackernews';
  if (domain.includes('github')) return 'source-github';
  if (domain.includes('stackoverflow')) return 'source-stackoverflow';
  if (domain.includes('medium')) return 'source-medium';
  if (domain.includes('quora')) return 'source-quora';
  if (domain.includes('youtube')) return 'source-youtube';
  if (domain.includes('producthunt')) return 'source-producthunt';
  if (domain.includes('discord')) return 'source-discord';
  if (domain.includes('glassdoor')) return 'source-glassdoor';
  if (domain.includes('trustpilot')) return 'source-trustpilot';
  if (domain.includes('tiktok')) return 'source-tiktok';
  if (domain.includes('apps.apple.com') || domain.includes('play.google.com')) return 'source-appstore';
  return 'source-default';
}

function getPlatformName(domain) {
  if (domain.includes('reddit')) return 'Reddit';
  if (domain.includes('twitter') || domain.includes('x.com')) return 'Twitter';
 if (domain.includes('linkedin')) return 'LinkedIn';
 if (domain.includes('news.ycombinator')) return 'Hacker News';
 if (domain.includes('github')) return 'GitHub';
 if (domain.includes('stackoverflow')) return 'Stack Overflow';
 if (domain.includes('medium')) return 'Medium';
 if (domain.includes('quora')) return 'Quora';
 if (domain.includes('youtube')) return 'YouTube';
 if (domain.includes('producthunt')) return 'Product Hunt';
 if (domain.includes('discord')) return 'Discord';
 if (domain.includes('glassdoor')) return 'Glassdoor';
 if (domain.includes('trustpilot')) return 'Trustpilot';
 if (domain.includes('tiktok')) return 'TikTok';
 if (domain.includes('apps.apple.com')) return 'App Store';
 if (domain.includes('play.google.com')) return 'Play Store';
 return domain.split('.')[0];
}

function findInsightForResult(result, analysis) {
 if (!analysis || !analysis.resultInsights) {
   return {
     businessOpportunity: "AI analysis not available for this result",
     urgency: "low"
   };
 }
 
 const resultTitleWords = result.title.toLowerCase().split(' ').slice(0, 5).join(' ');
 
 const matchingInsight = analysis.resultInsights.find(insight => {
   const insightTitleWords = insight.title.toLowerCase().split(' ').slice(0, 5).join(' ');
   return resultTitleWords.includes(insightTitleWords.slice(0, 20)) || 
          insightTitleWords.includes(resultTitleWords.slice(0, 20));
 });
 
 if (matchingInsight) {
   return matchingInsight;
 }
 
 // Fallback to a default or first insight if no direct match (though Gemini should match)
 return analysis.resultInsights[0] || {
   businessOpportunity: "Monitor this result for business opportunities",
   urgency: "medium"
 };
}

async function performGoogleSearch(query, timeRange) {
 if (!API_CONFIG.GOOGLE_API_KEY || !API_CONFIG.SEARCH_ENGINE_ID) {
   throw new Error('Google API not configured. Please set GOOGLE_API_KEY and SEARCH_ENGINE_ID in env-config.js.');
 }
 
 const params = new URLSearchParams({
   key: API_CONFIG.GOOGLE_API_KEY,
   cx: API_CONFIG.SEARCH_ENGINE_ID,
   q: query,
   num: '8',
   dateRestrict: timeRange
 });
 
 const response = await fetch(`https://www.googleapis.com/customsearch/v1?${params}`);
 if (!response.ok) {
   const error = await response.json();
   throw new Error(error.error?.message || 'Google Custom Search failed. Check API key and search engine ID.');
 }
 
 const data = await response.json();
 return data.items || [];
}

async function analyzeWithAI(results, query, platform) {
 if (!API_CONFIG.LAMBDA_ENDPOINT) {
   return {
     mainPainPoint: "AI analysis not configured. Please set LAMBDA_ENDPOINT in env-config.js.",
     resultInsights: [],
     overallOpportunityScore: 3,
     topActionableIdeas: ["Configure Lambda endpoint to enable AI analysis"]
   };
 }

 try {
   const response = await fetch(API_CONFIG.LAMBDA_ENDPOINT, {
     method: 'POST',
     headers: { 'Content-Type': 'application/json' },
     body: JSON.stringify({ query, platform, results: results.slice(0, 8) })
   });

   if (!response.ok) {
     const errorText = await response.text();
     throw new Error(`AI analysis failed: ${response.status} - ${errorText}`);
   }
   return await response.json();
 } catch (error) {
   console.error('AI analysis error:', error);
   return {
     mainPainPoint: "AI analysis temporarily unavailable due to an error.",
     resultInsights: [],
     overallOpportunityScore: 1,
     topActionableIdeas: ["AI analysis error - please try again or check Lambda logs."]
   };
 }
}

async function performSearch() {
  const keyword = document.getElementById('headerSearchInput').value.trim();
  const queryType = document.getElementById('headerQueryDropdown').value;
  const platform = document.getElementById('platformSelect').value;
  const timeRange = document.getElementById('timeSelect').value;
  await executeSearch(keyword, queryType, platform, timeRange);
}

async function performSearchFromMobile() {
  const keyword = document.getElementById('mobileSearchInput').value.trim();
  const queryType = document.getElementById('mobileQueryDropdown').value;
  const platform = document.getElementById('mobilePlatformSelect').value;
  const timeRange = document.getElementById('mobileTimeSelect').value;
  document.getElementById('mobileNavModal').classList.remove('active'); // Close modal
  await executeSearch(keyword, queryType, platform, timeRange);
}

async function executeSearch(keyword, queryType, platform, timeRange) {
 if (!keyword) {
   alert('Please enter a search term');
   return;
 }
 
 showLoading();
 
 try {
   let query;
   let powerQuery = null;
   
   if (queryType && POWER_QUERIES[queryType]) {
     powerQuery = POWER_QUERIES[queryType];
     query = buildSearchQuery(powerQuery.template, keyword, platform);
   } else {
     query = buildNormalSearchQuery(keyword, platform);
   }
   
   const results = await performGoogleSearch(query, timeRange);
   
   let analysis = null;
   if (results.length > 0) {
     analysis = await analyzeWithAI(results, query, platform);
     currentAnalysis = analysis;
   }
   
   displayResults(results, keyword, analysis);
   
 } catch (error) {
   showError(error.message);
 }
}

function showLoading() {
  document.getElementById('overallInsights').style.display = 'none'; // Hide overall insights during loading
  document.getElementById('resultsGrid').innerHTML = `
   <div class="loading">
     <div class="spinner"></div>
     <p>Analyzing pain points...</p>
   </div>
 `;
  document.getElementById('pageTitle').textContent = 'Analyzing Pain Points...';
}

function showError(message) {
  document.getElementById('overallInsights').style.display = 'none';
  document.getElementById('resultsGrid').innerHTML = `
   <div class="empty-state">
     <h3>Search Error</h3>
     <p>${message}</p>
     <p>Please check your API configuration or try again.</p>
   </div>
 `;
  document.getElementById('pageTitle').textContent = 'Error';
}

function displayResults(results, keyword, analysis) {
 const grid = document.getElementById('resultsGrid');
 const pageTitle = document.getElementById('pageTitle');
 const overallInsightsCard = document.getElementById('overallInsights');

 pageTitle.textContent = `User Pain Points for "${keyword}"`;
 
 // Display overall insights
 if (analysis && analysis.mainPainPoint) {
    overallInsightsCard.style.display = 'block';
    document.getElementById('mainPainPoint').textContent = analysis.mainPainPoint;
    document.getElementById('opportunityScore').textContent = analysis.overallOpportunityScore;
    const topIdeasList = document.getElementById('topActionableIdeas');
    topIdeasList.innerHTML = '';
    analysis.topActionableIdeas.forEach(idea => {
      const li = document.createElement('li');
      li.textContent = idea;
      topIdeasList.appendChild(li);
    });
  } else {
    overallInsightsCard.style.display = 'none';
  }

 if (!results.length) {
   grid.innerHTML = `
     <div class="empty-state">
       <h3>No Results Found</h3>
       <p>Try a different search term or platform.</p>
     </div>
   `;
   return;
 }
 
 let html = '';
 results.forEach(result => {
   const platformClass = getPlatformClass(result.displayLink);
   const platformName = getPlatformName(result.displayLink);
   
   let snippet = result.snippet || '';
   const painWords = ['frustrated', 'hate', 'terrible', 'broken', 'annoying', 'wish', 'need', 'help', 'urgent', 'switching', 'alternative', 'missing', 'lack', 'problem', 'doesn\'t work', 'awful', 'sucks', 'painful'];
   painWords.forEach(word => {
     const regex = new RegExp(`\\b${word}\\b`, 'gi');
     snippet = snippet.replace(regex, `<mark style="background:#fef3c7; padding:2px 4px; border-radius:3px; font-weight:600;">$&</mark>`);
   });
   
   html += `
     <div class="result-card">
       <div class="card-header">
         <h3 class="result-title">
           <a href="${result.link}" target="_blank" rel="noopener">${result.title}</a>
         </h3>
         <span class="source-badge ${platformClass}">${platformName}</span>
       </div>
       
       <div class="result-snippet">${snippet}</div>
   `;
   
   if (analysis) {
     const insight = findInsightForResult(result, analysis);
     html += `
       <div class="ai-insight">
         <div class="ai-insight-label">
           Business Opportunity
           <span class="urgency-badge urgency-${insight.urgency || 'medium'}">
             ${(insight.urgency || 'medium').toUpperCase()}
           </span>
         </div>
         <div class="ai-insight-text">${insight.businessOpportunity || 'Analyzing business opportunity...'}</div>
       </div>
     `;
   }
   
   html += `
       <div class="card-footer">
         <span>${result.displayLink}</span>
         <span class="copy-link" onclick="copyToClipboard('${result.link}')">Copy Link</span>
       </div>
     </div>
   `;
 });
 
 grid.innerHTML = html;
}

function copyToClipboard(text) {
 navigator.clipboard.writeText(text).then(() => {
   // Optional: Add a small visual feedback (e.g., a temporary "Copied!" message)
   const originalText = event.target.textContent;
   event.target.textContent = 'Copied!';
   setTimeout(() => {
     event.target.textContent = originalText;
   }, 1500);
 });
}

window.copyToClipboard = copyToClipboard; // Make accessible globally for onclick

init();
</script>
</body>
</html>