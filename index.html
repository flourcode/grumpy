<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GrumpyLinks ‚Äî AI-Powered Pain Point Discovery</title>
<script src="env-config.js"></script>
<style>
:root {
  --bg:#f8fafc; --sidebar:#ffffff; --card:#ffffff; --ink:#1e293b; --muted:#64748b;
  --accent:#3b82f6; --success:#10b981; --warning:#f59e0b; --danger:#ef4444;
  --border:#e2e8f0; --hover:#f1f5f9; --ai:#8b5cf6;
  --shadow:0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px 0 rgba(0,0,0,0.06);
  --shadow-lg:0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
  
  /* Platform Colors */
  --reddit:#ff4500; --twitter:#1da1f2; --linkedin:#0077b5; --hackernews:#ff6600;
  --github:#333; --stackoverflow:#f48024; --medium:#000; --quora:#b92b27;
  
  /* Priority Colors (like Taskly) */
  --high-priority:#ef4444; --medium-priority:#f59e0b; --low-priority:#64748b;
}

* { box-sizing: border-box; }
html,body { margin:0; padding:0; font-family: 'Inter', system-ui, sans-serif; }
body { background:var(--bg); color:var(--ink); line-height:1.5; }

/* Layout */
.app { display:flex; min-height:100vh; }

/* Sidebar - Taskly Style */
.sidebar {
  width:280px; background:var(--sidebar); border-right:1px solid var(--border);
  padding:24px 16px; overflow-y:auto; flex-shrink:0;
}

.logo { 
  font-size:22px; font-weight:700; margin-bottom:32px; color:var(--ink);
  display:flex; align-items:center; gap:8px;
}

.nav-section { margin-bottom:28px; }
.nav-title { 
  font-size:12px; font-weight:600; color:var(--muted); 
  text-transform:uppercase; letter-spacing:0.8px; margin-bottom:12px; 
}

/* Search */
.search-input {
  width:100%; padding:12px 16px; border:1px solid var(--border);
  border-radius:8px; font-size:14px; background:white;
  transition:border-color 0.2s ease; margin-bottom:8px;
}
.search-input:focus {
  outline:none; border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(59,130,246,0.1);
}

.search-btn {
  width:100%; padding:10px; background:var(--accent);
  color:white; border:none; border-radius:6px; font-weight:500;
  cursor:pointer; transition:background 0.2s ease; font-size:14px;
}
.search-btn:hover { background:#2563eb; }

/* Power Queries - Taskly Navigation Style */
.power-query {
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 12px; margin-bottom:4px; border-radius:6px;
  cursor:pointer; transition:background 0.2s ease; font-size:14px;
}
.power-query:hover { background:var(--hover); }
.power-query.active { background:#dbeafe; color:var(--accent); }

.query-info { display:flex; align-items:center; gap:8px; }
.query-icon { font-size:16px; }
.query-details { }
.query-title { font-weight:500; margin:0; }
.query-desc { font-size:12px; color:var(--muted); margin:2px 0 0 0; }

/* Filters */
.filter-select {
  width:100%; padding:8px 12px; border:1px solid var(--border);
  border-radius:6px; background:white; margin-bottom:8px; font-size:14px;
}

/* Main Content */
.main-content { flex:1; padding:24px; overflow-y:auto; }

/* Header - Taskly Style */
.content-header {
  display:flex; justify-content:space-between; align-items:center;
  margin-bottom:24px;
}
.page-title { font-size:28px; font-weight:700; margin:0; }
.header-actions { display:flex; gap:12px; align-items:center; }
.status-badge {
  padding:6px 12px; border-radius:20px; font-size:12px; font-weight:500;
  display:flex; align-items:center; gap:6px;
}
.status-success { background:#dcfce7; color:#166534; }
.status-warning { background:#fef3c7; color:#92400e; }
.status-info { background:#dbeafe; color:#1e40af; }

/* Results Grid - Taskly Card Style */
.results-section { }
.section-header {
  display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;
}
.section-title { font-size:18px; font-weight:600; margin:0; }
.results-count { color:var(--muted); font-size:14px; }

.results-grid {
  display:grid; grid-template-columns:repeat(auto-fit, minmax(380px, 1fr));
  gap:16px;
}

/* Card Design - Exact Taskly Style */
.result-card {
  background:white; border:1px solid var(--border); border-radius:8px;
  padding:16px; transition:all 0.2s ease; position:relative;
}
.result-card:hover {
  box-shadow:var(--shadow-lg); transform:translateY(-1px);
}

/* Priority Indicator (like Taskly) */
.priority-dot {
  position:absolute; top:16px; right:16px; width:8px; height:8px;
  border-radius:50%; 
}
.priority-high { background:var(--high-priority); }
.priority-medium { background:var(--medium-priority); }
.priority-low { background:var(--low-priority); }

.card-header {
  display:flex; justify-content:space-between; align-items:start;
  margin-bottom:12px; gap:16px;
}

.result-title {
  font-weight:600; font-size:15px; line-height:1.4; margin:0;
  color:var(--ink); flex:1;
}
.result-title a { color:inherit; text-decoration:none; }
.result-title a:hover { color:var(--accent); }

.source-badge {
  padding:3px 8px; border-radius:12px; font-size:11px; font-weight:600;
  color:white; text-transform:uppercase; flex-shrink:0;
}
.source-reddit { background:var(--reddit); }
.source-twitter { background:var(--twitter); }
.source-linkedin { background:var(--linkedin); }
.source-hackernews { background:var(--hackernews); }
.source-github { background:var(--github); }
.source-stackoverflow { background:var(--stackoverflow); }
.source-medium { background:var(--medium); }
.source-quora { background:var(--quora); }
.source-default { background:var(--muted); }

.result-snippet {
  color:var(--muted); font-size:14px; line-height:1.5; 
  margin-bottom:12px; display:-webkit-box; -webkit-line-clamp:3; 
  -webkit-box-orient:vertical; overflow:hidden;
}

/* Action Button - The Key Addition */
.action-btn {
  background:rgba(59,130,246,0.1); color:var(--accent); border:1px solid rgba(59,130,246,0.2);
  padding:8px 12px; border-radius:6px; font-size:12px; font-weight:500;
  cursor:pointer; transition:all 0.2s ease; display:inline-flex;
  align-items:center; gap:6px; margin-bottom:8px;
}
.action-btn:hover {
  background:var(--accent); color:white;
}

.card-footer {
  display:flex; justify-content:space-between; align-items:center;
  font-size:12px; color:var(--muted); margin-top:12px;
  padding-top:12px; border-top:1px solid #f1f5f9;
}

.card-meta { display:flex; gap:12px; }

/* Loading & Empty States */
.loading { text-align:center; padding:60px 20px; color:var(--muted); }
.spinner {
  display:inline-block; width:20px; height:20px; margin-right:8px;
  border:2px solid #e5e7eb; border-top:2px solid var(--accent);
  border-radius:50%; animation:spin 1s linear infinite;
}
@keyframes spin { 0%{ transform:rotate(0deg); } 100%{ transform:rotate(360deg); } }

.empty-state { 
  text-align:center; padding:80px 20px; color:var(--muted);
  grid-column:1 / -1;
}
.empty-state .emoji { font-size:48px; margin-bottom:16px; display:block; }

/* Responsive */
@media (max-width: 1024px) {
  .app { flex-direction:column; }
  .sidebar { width:100%; padding:16px; }
  .main-content { padding:16px; }
  .results-grid { grid-template-columns:1fr; }
}
</style>
</head>
<body>

<div class="app">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <span>üò†</span>
      <span>GrumpyLinks</span>
    </div>

    <div class="nav-section">
      <div class="nav-title">Search</div>
      <input id="searchInput" class="search-input" type="text" 
             placeholder="Brand, product, or topic..." />
      <button id="searchBtn" class="search-btn">üîç Hunt Pain Points</button>
    </div>

    <div class="nav-section">
      <div class="nav-title">Power Queries</div>
      <div id="powerQueries"></div>
    </div>

    <div class="nav-section">
      <div class="nav-title">Filters</div>
      <select id="platformSelect" class="filter-select">
        <option value="all">All Platforms</option>
        <option value="reddit">Reddit</option>
        <option value="twitter">Twitter/X</option>
        <option value="linkedin">LinkedIn</option>
        <option value="hackernews">Hacker News</option>
        <option value="forums">Forums</option>
      </select>
      
      <select id="timeSelect" class="filter-select">
        <option value="d7">Last 7 days</option>
        <option value="d1">Last 24 hours</option>
        <option value="d30">Last 30 days</option>
      </select>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <header class="content-header">
      <h1 class="page-title">Pain Point Discovery</h1>
      <div class="header-actions">
        <span id="statusBadge" class="status-badge status-info">
          <span>‚óè</span> Ready to hunt
        </span>
      </div>
    </header>

    <section class="results-section">
      <div class="section-header">
        <h2 class="section-title">Results</h2>
        <span id="resultsCount" class="results-count">No results yet</span>
      </div>
      
      <div id="resultsGrid" class="results-grid">
        <div class="empty-state">
          <span class="emoji">üéØ</span>
          <h3>Ready to Discover Pain Points</h3>
          <p>Select a power query to find customer frustrations and turn them into opportunities.</p>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
// Configuration
const API_CONFIG = {
  GOOGLE_API_KEY: '',
  SEARCH_ENGINE_ID: '',
  LAMBDA_ENDPOINT: ''
};

function loadConfig() {
  if (window.ENV) {
    API_CONFIG.GOOGLE_API_KEY = window.ENV.GOOGLE_API_KEY || '';
    API_CONFIG.SEARCH_ENGINE_ID = window.ENV.SEARCH_ENGINE_ID || '';
    API_CONFIG.LAMBDA_ENDPOINT = window.ENV.LAMBDA_ENDPOINT || '';
  }
}

// Power Queries with actionable focus
const POWER_QUERIES = [
  {
    id: 'competitor_hate',
    icon: 'üî•',
    title: 'Competitor Complaints',
    desc: 'Find unhappy customers to convert',
    template: '("hate" OR "frustrated with" OR "terrible") {{keyword}}'
  },
  {
    id: 'switching_signals',
    icon: 'üîÑ',
    title: 'Switching Signals',
    desc: 'Catch people ready to switch',
    template: '("switching from" OR "alternative to" OR "leaving") {{keyword}}'
  },
  {
    id: 'wish_list',
    icon: 'üí´',
    title: 'Wish List Signals',
    desc: 'Find unmet market needs',
    template: '"I wish there was" OR "I wish someone would" {{keyword}}'
  },
  {
    id: 'feature_requests',
    icon: 'üí°',
    title: 'Feature Requests',
    desc: 'Product improvement opportunities',
    template: '("should add" OR "please add" OR "missing feature") {{keyword}}'
  },
  {
    id: 'urgent_help',
    icon: 'üö®',
    title: 'Urgent Help Needed',
    desc: 'Immediate sales opportunities',
    template: '("need help with" OR "urgent" OR "ASAP") {{keyword}}'
  }
];

const PLATFORMS = {
  all: { sites: [] },
  reddit: { sites: ['site:reddit.com'] },
  twitter: { sites: ['site:twitter.com'] },
  linkedin: { sites: ['site:linkedin.com'] },
  hackernews: { sites: ['site:news.ycombinator.com'] },
  forums: { sites: ['site:stackoverflow.com', 'site:quora.com'] }
};

let currentQuery = null;
let currentResults = [];

// Initialize
function init() {
  loadConfig();
  initPowerQueries();
  setupEventListeners();
  loadLastSearch();
}

function initPowerQueries() {
  const container = document.getElementById('powerQueries');
  
  POWER_QUERIES.forEach(query => {
    const btn = document.createElement('div');
    btn.className = 'power-query';
    btn.innerHTML = `
      <div class="query-info">
        <span class="query-icon">${query.icon}</span>
        <div class="query-details">
          <div class="query-title">${query.title}</div>
          <div class="query-desc">${query.desc}</div>
        </div>
      </div>
    `;
    btn.onclick = () => {
      document.querySelectorAll('.power-query').forEach(q => q.classList.remove('active'));
      btn.classList.add('active');
      runPowerQuery(query);
    };
    container.appendChild(btn);
  });
}

function setupEventListeners() {
  document.getElementById('searchBtn').onclick = () => {
    if (currentQuery) runPowerQuery(currentQuery);
    else runPowerQuery(POWER_QUERIES[0]);
  };
  
  document.getElementById('searchInput').onkeydown = (e) => {
    if (e.key === 'Enter') {
      if (currentQuery) runPowerQuery(currentQuery);
      else runPowerQuery(POWER_QUERIES[0]);
    }
  };
  
  document.getElementById('searchInput').oninput = (e) => {
    localStorage.setItem('grumpy_search', e.target.value);
  };
}

function loadLastSearch() {
  const lastSearch = localStorage.getItem('grumpy_search');
  if (lastSearch) {
    document.getElementById('searchInput').value = lastSearch;
  }
}

function buildSearchQuery(template, keyword, platform) {
  let query = template.replace(/\{\{keyword\}\}/g, `"${keyword}"`);
  
  const platformConfig = PLATFORMS[platform] || PLATFORMS.all;
  if (platformConfig.sites.length > 0) {
    query += ' (' + platformConfig.sites.join(' OR ') + ')';
  }
  
  return query;
}

function getPlatformClass(domain) {
  if (domain.includes('reddit')) return 'source-reddit';
  if (domain.includes('twitter') || domain.includes('x.com')) return 'source-twitter';
  if (domain.includes('linkedin')) return 'source-linkedin';
  if (domain.includes('news.ycombinator')) return 'source-hackernews';
  if (domain.includes('github')) return 'source-github';
  if (domain.includes('stackoverflow')) return 'source-stackoverflow';
  if (domain.includes('medium')) return 'source-medium';
  if (domain.includes('quora')) return 'source-quora';
  return 'source-default';
}

function getPlatformName(domain) {
  if (domain.includes('reddit')) return 'Reddit';
  if (domain.includes('twitter') || domain.includes('x.com')) return 'Twitter';
  if (domain.includes('linkedin')) return 'LinkedIn';
  if (domain.includes('news.ycombinator')) return 'HN';
  if (domain.includes('github')) return 'GitHub';
  if (domain.includes('stackoverflow')) return 'Stack';
  if (domain.includes('medium')) return 'Medium';
  if (domain.includes('quora')) return 'Quora';
  return domain.split('.')[0];
}

// Generate actionable insights
function generateActionableInsight(result, queryType, keyword) {
  const text = `${result.title} ${result.snippet}`.toLowerCase();
  
  // Different actions based on query type and content
  if (queryType === 'competitor_hate') {
    if (text.includes('support') || text.includes('customer service')) {
      return { action: 'üìû Reach out about support', icon: 'üìû' };
    }
    if (text.includes('pricing') || text.includes('expensive')) {
      return { action: 'üí∞ Share pricing comparison', icon: 'üí∞' };
    }
    return { action: 'üí¨ Join the conversation', icon: 'üí¨' };
  }
  
  if (queryType === 'switching_signals') {
    return { action: 'üéØ Send migration guide', icon: 'üéØ' };
  }
  
  if (queryType === 'wish_list') {
    return { action: 'üí° Validate product idea', icon: 'üí°' };
  }
  
  if (queryType === 'feature_requests') {
    return { action: 'üìã Add to roadmap', icon: 'üìã' };
  }
  
  if (queryType === 'urgent_help') {
    return { action: 'üöÄ Offer immediate help', icon: 'üöÄ' };
  }
  
  return { action: 'üëÄ Monitor thread', icon: 'üëÄ' };
}

// Calculate priority
function calculatePriority(result, queryType) {
  const text = `${result.title} ${result.snippet}`.toLowerCase();
  const urgentWords = ['urgent', 'asap', 'immediately', 'help', 'stuck', 'critical'];
  const engagementWords = ['comments', 'replies', 'upvotes', 'views'];
  
  let score = 1; // low by default
  
  if (urgentWords.some(word => text.includes(word))) score = 3; // high
  else if (engagementWords.some(word => text.includes(word))) score = 2; // medium
  
  return score;
}

async function performGoogleSearch(query, timeRange) {
  if (!API_CONFIG.GOOGLE_API_KEY || !API_CONFIG.SEARCH_ENGINE_ID) {
    throw new Error('Google API not configured');
  }
  
  const params = new URLSearchParams({
    key: API_CONFIG.GOOGLE_API_KEY,
    cx: API_CONFIG.SEARCH_ENGINE_ID,
    q: query,
    num: '8', // Limit to 8 results for better AI analysis
    dateRestrict: timeRange
  });
  
  const response = await fetch(`https://www.googleapis.com/customsearch/v1?${params}`);
  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.error?.message || 'Search failed');
  }
  
  const data = await response.json();
  return data.items || [];
}

async function runPowerQuery(powerQuery) {
  const keyword = document.getElementById('searchInput').value.trim();
  if (!keyword) {
    alert('Please enter a search term');
    return;
  }
  
  currentQuery = powerQuery;
  const platform = document.getElementById('platformSelect').value;
  const timeRange = document.getElementById('timeSelect').value;
  
  // Update status
  document.getElementById('statusBadge').innerHTML = '<span>‚óè</span> Searching...';
  document.getElementById('statusBadge').className = 'status-badge status-warning';
  
  // Show loading
  showLoading();
  
  try {
    const query = buildSearchQuery(powerQuery.template, keyword, platform);
    const results = await performGoogleSearch(query, timeRange);
    currentResults = results;
    
    displayResults(results, powerQuery);
    
    document.getElementById('statusBadge').innerHTML = `<span>‚óè</span> Found ${results.length} opportunities`;
    document.getElementById('statusBadge').className = 'status-badge status-success';
    
  } catch (error) {
    document.getElementById('statusBadge').innerHTML = '<span>‚óè</span> Error occurred';
    document.getElementById('statusBadge').className = 'status-badge status-warning';
    showError(error.message);
  }
}

function showLoading() {
  document.getElementById('resultsGrid').innerHTML = `
    <div class="loading">
      <div class="spinner"></div>
      <p>Hunting for pain points...</p>
    </div>
  `;
  document.getElementById('resultsCount').textContent = 'Searching...';
}

function showError(message) {
  document.getElementById('resultsGrid').innerHTML = `
    <div class="empty-state">
      <span class="emoji">‚ö†Ô∏è</span>
      <h3>Search Error</h3>
      <p>${message}</p>
    </div>
  `;
}

function displayResults(results, powerQuery) {
  const grid = document.getElementById('resultsGrid');
  
  if (!results.length) {
    grid.innerHTML = `
      <div class="empty-state">
        <span class="emoji">üîç</span>
        <h3>No Results Found</h3>
        <p>Try a different search term or platform.</p>
      </div>
    `;
    return;
  }
  
  document.getElementById('resultsCount').textContent = `${results.length} pain points found`;
  
  let html = '';
  results.forEach(result => {
    const keyword = document.getElementById('searchInput').value.trim();
    const actionInsight = generateActionableInsight(result, powerQuery.id, keyword);
    const priority = calculatePriority(result, powerQuery.id);
    const platformClass = getPlatformClass(result.displayLink);
    const platformName = getPlatformName(result.displayLink);
    
    const priorityClass = priority === 3 ? 'priority-high' : priority === 2 ? 'priority-medium' : 'priority-low';
    
    // Highlight pain words
    let snippet = result.snippet || '';
    const painWords = ['frustrated', 'hate', 'terrible', 'broken', 'annoying', 'wish', 'need', 'help', 'urgent', 'switching', 'alternative'];
    painWords.forEach(word => {
      const regex = new RegExp(`\\b${word}\\b`, 'gi');
      snippet = snippet.replace(regex, `<mark style="background:#fef3c7; padding:2px 4px; border-radius:3px; font-weight:500;">$&</mark>`);
    });
    
    html += `
      <div class="result-card">
        <div class="${priorityClass} priority-dot"></div>
        
        <div class="card-header">
          <h3 class="result-title">
            <a href="${result.link}" target="_blank" rel="noopener">${result.title}</a>
          </h3>
          <span class="source-badge ${platformClass}">${platformName}</span>
        </div>
        
        <div class="result-snippet">${snippet}</div>
        
        <button class="action-btn" onclick="window.open('${result.link}', '_blank')">
          ${actionInsight.icon} ${actionInsight.action}
        </button>
        
        <div class="card-footer">
          <div class="card-meta">
            <span>${result.displayLink}</span>
          </div>
          <span style="color:var(--accent); cursor:pointer;" onclick="copyToClipboard('${result.link}')">Copy link</span>
        </div>
      </div>
    `;
  });
  
  grid.innerHTML = html;
}

// Utility function
function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    // Could add a toast notification here
  });
}

// Make functions global
window.copyToClipboard = copyToClipboard;

// Initialize app
init();
</script>
</body>
</html>