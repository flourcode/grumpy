<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GrumpyLinks â€” AI-Powered Pain Point Discovery</title>
<script src="env-config.js"></script>
<style>
:root {
  --bg:#ffffff; --sidebar:#f7f7f7; --card:#ffffff; --ink:#37352f; --muted:#787774;
  --accent:#2383e2; --success:#448361; --warning:#d9730d; --danger:#e03e3e;
  --border:#e9e9e7; --hover:#f1f1ef; --subtle:#f7f6f3;
  --shadow:rgba(15, 15, 15, 0.1) 0px 0px 0px 1px, rgba(15, 15, 15, 0.1) 0px 2px 4px;
  --shadow-lg:rgba(15, 15, 15, 0.1) 0px 0px 0px 1px, rgba(15, 15, 15, 0.2) 0px 5px 10px, rgba(15, 15, 15, 0.4) 0px 15px 40px;
  
  /* Platform Colors */
  --reddit:#ff4500; --twitter:#1da1f2; --linkedin:#0077b5; --hackernews:#ff6600;
  --github:#333; --stackoverflow:#f48024; --medium:#000; --quora:#b92b27;
}

* { box-sizing: border-box; }
html,body { margin:0; padding:0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, sans-serif; }
body { background:var(--bg); color:var(--ink); line-height:1.5; }

/* Layout */
.app { display:flex; min-height:100vh; }

/* Sidebar - Notion Style */
.sidebar {
  width:260px; background:var(--sidebar); border-right:1px solid var(--border);
  padding:16px; overflow-y:auto; flex-shrink:0;
}

.logo { 
  font-size:16px; font-weight:600; margin-bottom:24px; color:var(--ink);
  padding:8px 12px;
}

.nav-section { margin-bottom:20px; }
.nav-title { 
  font-size:11px; font-weight:500; color:var(--muted); 
  text-transform:uppercase; letter-spacing:0.5px; margin-bottom:8px; 
  padding:0 12px;
}

/* Search */
.search-input {
  width:100%; padding:8px 12px; border:1px solid var(--border);
  border-radius:6px; font-size:14px; background:white;
  transition:all 0.15s ease; margin-bottom:6px;
}
.search-input:focus {
  outline:none; border-color:var(--accent);
  box-shadow:0 0 0 1px var(--accent);
}

.search-btn {
  width:100%; padding:8px 12px; background:var(--accent);
  color:white; border:none; border-radius:6px; font-weight:500;
  cursor:pointer; transition:background 0.15s ease; font-size:14px;
}
.search-btn:hover { background:#1a6bb8; }

/* Power Queries - Notion Button Style */
.power-query {
  display:flex; align-items:center; width:100%;
  padding:6px 12px; margin-bottom:2px; border-radius:6px;
  cursor:pointer; transition:background 0.15s ease; font-size:14px;
  background:transparent; border:none; text-align:left;
}
.power-query:hover { background:var(--hover); }
.power-query.active { background:var(--accent); color:white; }

.query-title { font-weight:500; margin-bottom:2px; }
.query-desc { font-size:12px; color:var(--muted); }
.power-query.active .query-desc { color:rgba(255,255,255,0.8); }

/* Filters */
.filter-select {
  width:100%; padding:6px 12px; border:1px solid var(--border);
  border-radius:6px; background:white; margin-bottom:6px; font-size:14px;
}

/* Main Content */
.main-content { flex:1; padding:32px 40px; overflow-y:auto; }

/* Header - Notion Style */
.content-header {
  margin-bottom:32px;
}
.page-title { 
  font-size:32px; font-weight:700; margin:0 0 8px 0; 
  color:var(--ink);
}
.page-subtitle { 
  font-size:16px; color:var(--muted); margin:0;
}

/* Results Section */
.results-section { }
.section-header {
  display:flex; justify-content:space-between; align-items:center; 
  margin-bottom:16px; padding-bottom:8px; border-bottom:1px solid var(--border);
}
.section-title { font-size:20px; font-weight:600; margin:0; }
.results-count { color:var(--muted); font-size:14px; }

.results-grid {
  display:grid; grid-template-columns:repeat(auto-fit, minmax(400px, 1fr));
  gap:16px;
}

/* Card Design - Notion Style */
.result-card {
  background:white; border:1px solid var(--border); border-radius:8px;
  padding:20px; transition:all 0.15s ease; position:relative;
}
.result-card:hover {
  box-shadow:var(--shadow-lg);
}

.card-header {
  margin-bottom:12px;
}

.result-title {
  font-weight:600; font-size:16px; line-height:1.3; margin:0 0 8px 0;
  color:var(--ink);
}
.result-title a { color:inherit; text-decoration:none; }
.result-title a:hover { color:var(--accent); }

.source-badge {
  display:inline-block; padding:2px 8px; border-radius:4px; 
  font-size:11px; font-weight:500; color:white; text-transform:uppercase;
}
.source-reddit { background:var(--reddit); }
.source-twitter { background:var(--twitter); }
.source-linkedin { background:var(--linkedin); }
.source-hackernews { background:var(--hackernews); }
.source-github { background:var(--github); }
.source-stackoverflow { background:var(--stackoverflow); }
.source-medium { background:var(--medium); }
.source-quora { background:var(--quora); }
.source-default { background:var(--muted); }

.result-snippet {
  color:var(--muted); font-size:14px; line-height:1.4; 
  margin-bottom:16px; display:-webkit-box; -webkit-line-clamp:3; 
  -webkit-box-orient:vertical; overflow:hidden;
}

/* AI Insight - The Key Feature */
.ai-insight {
  background:var(--subtle); border:1px solid var(--border);
  border-radius:6px; padding:12px; margin-bottom:12px;
}
.ai-insight-label {
  font-size:11px; font-weight:500; color:var(--muted);
  text-transform:uppercase; letter-spacing:0.5px; margin-bottom:6px;
}
.ai-insight-text {
  font-size:14px; color:var(--ink); line-height:1.4;
  font-weight:500;
}

.card-footer {
  display:flex; justify-content:space-between; align-items:center;
  font-size:12px; color:var(--muted); margin-top:16px;
  padding-top:12px; border-top:1px solid var(--border);
}

.copy-link {
  color:var(--accent); cursor:pointer; font-weight:500;
  padding:4px 8px; border-radius:4px; transition:background 0.15s ease;
}
.copy-link:hover { background:var(--hover); }

/* Status Badge */
.status-badge {
  display:inline-flex; align-items:center; gap:6px;
  padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;
  margin-bottom:16px;
}
.status-success { background:#e6f2ed; color:var(--success); }
.status-warning { background:#fdf2e9; color:var(--warning); }
.status-info { background:#e9f3ff; color:var(--accent); }

/* Loading & Empty States */
.loading { 
  text-align:center; padding:80px 20px; color:var(--muted);
  grid-column:1 / -1;
}
.spinner {
  display:inline-block; width:16px; height:16px; margin-right:8px;
  border:2px solid var(--border); border-top:2px solid var(--accent);
  border-radius:50%; animation:spin 1s linear infinite;
}
@keyframes spin { 0%{ transform:rotate(0deg); } 100%{ transform:rotate(360deg); } }

.empty-state { 
  text-align:center; padding:80px 20px; color:var(--muted);
  grid-column:1 / -1;
}

/* Responsive */
@media (max-width: 1024px) {
  .app { flex-direction:column; }
  .sidebar { width:100%; padding:16px; }
  .main-content { padding:20px; }
  .results-grid { grid-template-columns:1fr; }
}
</style>
</head>
<body>

<div class="app">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">GrumpyLinks</div>

    <div class="nav-section">
      <div class="nav-title">Search</div>
      <input id="searchInput" class="search-input" type="text" 
             placeholder="Brand, product, or topic..." />
      <button id="searchBtn" class="search-btn">Search</button>
    </div>

    <div class="nav-section">
      <div class="nav-title">Power Queries</div>
      <div id="powerQueries"></div>
    </div>

    <div class="nav-section">
      <div class="nav-title">Filters</div>
      <select id="platformSelect" class="filter-select">
        <option value="all">All Platforms</option>
        <option value="reddit">Reddit</option>
        <option value="twitter">Twitter</option>
        <option value="linkedin">LinkedIn</option>
        <option value="hackernews">Hacker News</option>
        <option value="forums">Forums</option>
      </select>
      
      <select id="timeSelect" class="filter-select">
        <option value="d7">Last 7 days</option>
        <option value="d1">Last 24 hours</option>
        <option value="d30">Last 30 days</option>
      </select>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <header class="content-header">
      <h1 class="page-title">Pain Point Discovery</h1>
      <p class="page-subtitle">Find customer frustrations and turn them into business opportunities</p>
    </header>

    <div id="statusBadge" class="status-badge status-info">Ready to search</div>

    <section class="results-section">
      <div class="section-header">
        <h2 class="section-title">Results</h2>
        <span id="resultsCount" class="results-count">No results yet</span>
      </div>
      
      <div id="resultsGrid" class="results-grid">
        <div class="empty-state">
          <h3>Ready to Discover Pain Points</h3>
          <p>Select a power query to find customer frustrations and business opportunities.</p>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
// Configuration
const API_CONFIG = {
  GOOGLE_API_KEY: '',
  SEARCH_ENGINE_ID: '',
  LAMBDA_ENDPOINT: ''
};

function loadConfig() {
  if (window.ENV) {
    API_CONFIG.GOOGLE_API_KEY = window.ENV.GOOGLE_API_KEY || '';
    API_CONFIG.SEARCH_ENGINE_ID = window.ENV.SEARCH_ENGINE_ID || '';
    API_CONFIG.LAMBDA_ENDPOINT = window.ENV.LAMBDA_ENDPOINT || '';
  }
}

// Power Queries - business focused
const POWER_QUERIES = [
  {
    id: 'competitor_hate',
    title: 'Competitor Complaints',
    desc: 'Find unhappy customers to convert',
    template: '("hate" OR "frustrated with" OR "terrible") {{keyword}}'
  },
  {
    id: 'switching_signals',
    title: 'Switching Signals', 
    desc: 'People ready to change solutions',
    template: '("switching from" OR "alternative to" OR "leaving") {{keyword}}'
  },
  {
    id: 'wish_list',
    title: 'Unmet Needs',
    desc: 'Market gaps and opportunities',
    template: '"I wish there was" OR "someone should build" {{keyword}}'
  },
  {
    id: 'feature_requests',
    title: 'Feature Requests',
    desc: 'Product improvement ideas',
    template: '("should add" OR "missing feature" OR "needs to support") {{keyword}}'
  },
  {
    id: 'urgent_help',
    title: 'Urgent Problems',
    desc: 'Immediate business opportunities',
    template: '("need help with" OR "urgent" OR "stuck with") {{keyword}}'
  }
];

const PLATFORMS = {
  all: { sites: [] },
  reddit: { sites: ['site:reddit.com'] },
  twitter: { sites: ['site:twitter.com'] },
  linkedin: { sites: ['site:linkedin.com'] },
  hackernews: { sites: ['site:news.ycombinator.com'] },
  forums: { sites: ['site:stackoverflow.com', 'site:quora.com'] }
};

let currentQuery = null;

// Initialize
function init() {
  loadConfig();
  initPowerQueries();
  setupEventListeners();
  loadLastSearch();
}

function initPowerQueries() {
  const container = document.getElementById('powerQueries');
  
  POWER_QUERIES.forEach(query => {
    const btn = document.createElement('button');
    btn.className = 'power-query';
    btn.innerHTML = `
      <div>
        <div class="query-title">${query.title}</div>
        <div class="query-desc">${query.desc}</div>
      </div>
    `;
    btn.onclick = () => {
      document.querySelectorAll('.power-query').forEach(q => q.classList.remove('active'));
      btn.classList.add('active');
      currentQuery = query;
      runPowerQuery(query);
    };
    container.appendChild(btn);
  });
}

function setupEventListeners() {
  document.getElementById('searchBtn').onclick = () => {
    if (currentQuery) runPowerQuery(currentQuery);
    else runPowerQuery(POWER_QUERIES[0]);
  };
  
  document.getElementById('searchInput').onkeydown = (e) => {
    if (e.key === 'Enter') {
      if (currentQuery) runPowerQuery(currentQuery);
      else runPowerQuery(POWER_QUERIES[0]);
    }
  };
  
  document.getElementById('searchInput').oninput = (e) => {
    localStorage.setItem('grumpy_search', e.target.value);
  };
}

function loadLastSearch() {
  const lastSearch = localStorage.getItem('grumpy_search');
  if (lastSearch) {
    document.getElementById('searchInput').value = lastSearch;
  }
}

function buildSearchQuery(template, keyword, platform) {
  let query = template.replace(/\{\{keyword\}\}/g, `"${keyword}"`);
  
  const platformConfig = PLATFORMS[platform] || PLATFORMS.all;
  if (platformConfig.sites.length > 0) {
    query += ' (' + platformConfig.sites.join(' OR ') + ')';
  }
  
  return query;
}

function getPlatformClass(domain) {
  if (domain.includes('reddit')) return 'source-reddit';
  if (domain.includes('twitter') || domain.includes('x.com')) return 'source-twitter';
  if (domain.includes('linkedin')) return 'source-linkedin';
  if (domain.includes('news.ycombinator')) return 'source-hackernews';
  if (domain.includes('github')) return 'source-github';
  if (domain.includes('stackoverflow')) return 'source-stackoverflow';
  if (domain.includes('medium')) return 'source-medium';
  if (domain.includes('quora')) return 'source-quora';
  return 'source-default';
}

function getPlatformName(domain) {
  if (domain.includes('reddit')) return 'Reddit';
  if (domain.includes('twitter') || domain.includes('x.com')) return 'Twitter';
  if (domain.includes('linkedin')) return 'LinkedIn';
  if (domain.includes('news.ycombinator')) return 'Hacker News';
  if (domain.includes('github')) return 'GitHub';
  if (domain.includes('stackoverflow')) return 'Stack Overflow';
  if (domain.includes('medium')) return 'Medium';
  if (domain.includes('quora')) return 'Quora';
  return domain.split('.')[0];
}

// Generate business-focused AI insights
function generateBusinessInsight(result, queryType, keyword) {
  const text = `${result.title} ${result.snippet}`.toLowerCase();
  const domain = result.displayLink;
  
  if (queryType === 'competitor_hate') {
    if (text.includes('support') || text.includes('customer service')) {
      return `Create superior customer support content highlighting ${keyword}'s service gaps. Target users frustrated with slow response times.`;
    }
    if (text.includes('pricing') || text.includes('expensive') || text.includes('cost')) {
      return `Develop pricing comparison content showing cost-effective alternatives to ${keyword}. Consider freemium model targeting price-sensitive users.`;
    }
    if (text.includes('feature') || text.includes('missing') || text.includes('lack')) {
      return `Build the missing features that ${keyword} users are demanding. Position as the solution that "gets it right."`;
    }
    return `Reach out to this frustrated ${keyword} user with a helpful solution or alternative. Convert their pain into your opportunity.`;
  }
  
  if (queryType === 'switching_signals') {
    if (domain.includes('reddit') || domain.includes('forum')) {
      return `Create migration guides and comparison content for users leaving ${keyword}. Offer personalized consultation calls.`;
    }
    return `Develop onboarding sequences specifically for ${keyword} switchers. Address their migration concerns proactively.`;
  }
  
  if (queryType === 'wish_list') {
    if (text.includes('integration') || text.includes('connect')) {
      return `Build integration solutions between ${keyword} and other tools. Market as "the missing bridge" users are requesting.`;
    }
    if (text.includes('mobile') || text.includes('app')) {
      return `Develop mobile-first solutions that ${keyword} currently lacks. Target users frustrated with desktop-only limitations.`;
    }
    return `Validate this product idea with ${keyword} users. Survey demand and build MVP targeting this specific need.`;
  }
  
  if (queryType === 'feature_requests') {
    return `Add this requested feature to your roadmap. ${keyword} users are actively asking for this - first mover advantage available.`;
  }
  
  if (queryType === 'urgent_help') {
    if (text.includes('setup') || text.includes('configure')) {
      return `Offer setup consulting services for ${keyword}. Create premium onboarding packages for complex implementations.`;
    }
    return `Provide immediate solution to this ${keyword} problem. Consider it for your emergency support service tier.`;
  }
  
  return `Monitor this conversation for follow-up opportunities. Engage authentically with helpful resources about ${keyword}.`;
}

async function performGoogleSearch(query, timeRange) {
  if (!API_CONFIG.GOOGLE_API_KEY || !API_CONFIG.SEARCH_ENGINE_ID) {
    throw new Error('Google API not configured');
  }
  
  const params = new URLSearchParams({
    key: API_CONFIG.GOOGLE_API_KEY,
    cx: API_CONFIG.SEARCH_ENGINE_ID,
    q: query,
    num: '8',
    dateRestrict: timeRange
  });
  
  const response = await fetch(`https://www.googleapis.com/customsearch/v1?${params}`);
  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.error?.message || 'Search failed');
  }
  
  const data = await response.json();
  return data.items || [];
}

async function runPowerQuery(powerQuery) {
  const keyword = document.getElementById('searchInput').value.trim();
  if (!keyword) {
    alert('Please enter a search term');
    return;
  }
  
  const platform = document.getElementById('platformSelect').value;
  const timeRange = document.getElementById('timeSelect').value;
  
  document.getElementById('statusBadge').textContent = 'Searching...';
  document.getElementById('statusBadge').className = 'status-badge status-warning';
  
  showLoading();
  
  try {
    const query = buildSearchQuery(powerQuery.template, keyword, platform);
    const results = await performGoogleSearch(query, timeRange);
    
    displayResults(results, powerQuery, keyword);
    
    document.getElementById('statusBadge').textContent = `Found ${results.length} opportunities`;
    document.getElementById('statusBadge').className = 'status-badge status-success';
    
  } catch (error) {
    document.getElementById('statusBadge').textContent = 'Search failed';
    document.getElementById('statusBadge').className = 'status-badge status-warning';
    showError(error.message);
  }
}

function showLoading() {
  document.getElementById('resultsGrid').innerHTML = `
    <div class="loading">
      <div class="spinner"></div>
      <p>Analyzing pain points...</p>
    </div>
  `;
  document.getElementById('resultsCount').textContent = 'Searching...';
}

function showError(message) {
  document.getElementById('resultsGrid').innerHTML = `
    <div class="empty-state">
      <h3>Search Error</h3>
      <p>${message}</p>
    </div>
  `;
}

function displayResults(results, powerQuery, keyword) {
  const grid = document.getElementById('resultsGrid');
  
  if (!results.length) {
    grid.innerHTML = `
      <div class="empty-state">
        <h3>No Results Found</h3>
        <p>Try a different search term or platform.</p>
      </div>
    `;
    return;
  }
  
  document.getElementById('resultsCount').textContent = `${results.length} pain points`;
  
  let html = '';
  results.forEach(result => {
    const businessInsight = generateBusinessInsight(result, powerQuery.id, keyword);
    const platformClass = getPlatformClass(result.displayLink);
    const platformName = getPlatformName(result.displayLink);
    
    // Highlight pain words
    let snippet = result.snippet || '';
    const painWords = ['frustrated', 'hate', 'terrible', 'broken', 'annoying', 'wish', 'need', 'help', 'urgent', 'switching', 'alternative', 'missing', 'lack'];
    painWords.forEach(word => {
      const regex = new RegExp(`\\b${word}\\b`, 'gi');
      snippet = snippet.replace(regex, `<mark style="background:#fef3c7; padding:1px 3px; border-radius:2px; font-weight:500;">$&</mark>`);
    });
    
    html += `
      <div class="result-card">
        <div class="card-header">
          <h3 class="result-title">
            <a href="${result.link}" target="_blank" rel="noopener">${result.title}</a>
          </h3>
          <span class="source-badge ${platformClass}">${platformName}</span>
        </div>
        
        <div class="result-snippet">${snippet}</div>
        
        <div class="ai-insight">
          <div class="ai-insight-label">Business Opportunity</div>
          <div class="ai-insight-text">${businessInsight}</div>
        </div>
        
        <div class="card-footer">
          <span>${result.displayLink}</span>
          <span class="copy-link" onclick="copyToClipboard('${result.link}')">Copy link</span>
        </div>
      </div>
    `;
  });
  
  grid.innerHTML = html;
}

function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    // Success feedback could go here
  });
}

window.copyToClipboard = copyToClipboard;

init();
</script>
</body>
</html>