<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>GrumpyLinks â€” AI-Powered Pain Point Discovery</title>
<script src="env-config.js"></script>
<style>
:root {
  --bg:#0f1115; --card:#151924; --ink:#e6e9ef; --muted:#9aa3b2;
  --accent:#6ee7b7; --chip:#1c2230; --chipOn:#263048;
  --good:#a7f3d0; --bad:#fecaca; --border:#1e2433; --field:#0c0f16;
  --ai:#8b5cf6; --opportunity:#f59e0b;
}
* { box-sizing: border-box; }
html,body {
  margin:0; background:var(--bg); color:var(--ink);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}
body { overflow-x:hidden; }

/* Header */
header {
  position:sticky; top:0; z-index:10;
  backdrop-filter:saturate(120%) blur(6px);
  background:linear-gradient(180deg, rgba(15,17,21,.92), rgba(15,17,21,.85));
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding:12px 16px; border-bottom:1px solid #212636;
}
.badge {
  display:inline-block; padding:2px 8px; border-radius:999px;
  font-size:.75rem; background:#172033; color:#9cb3ff;
}

/* Layout */
main { padding:12px; }
.container {
  max-width:1200px; margin:0 auto;
  display:grid; grid-template-columns:380px 1fr; gap:16px;
}
.panel { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:14px; }
.panel h3 { margin:0 0 10px 0; font-size:13px; text-transform:uppercase; letter-spacing:.6px; color:var(--muted); }

/* Controls */
.searchbar { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
input[type="text"] {
  flex:1 1 220px; min-width:0;
  background:var(--field); border:1px solid #20273a; color:var(--ink);
  padding:12px 14px; border-radius:10px; font-size:16px;
}
input[type="text"]::placeholder { color:#7d8596; }

button, select {
  background:var(--chip); color:var(--ink); border:1px solid #273149;
  border-radius:10px; padding:10px 12px; cursor:pointer; font-size:15px;
  flex:0 1 auto; min-width:0;
}
button:hover { background:var(--chipOn); }
button:active { transform:translateY(1px); }

/* Power Query Buttons */
.power-queries {
  display:grid; grid-template-columns:1fr; gap:6px;
}
.power-btn {
  background:linear-gradient(135deg, #1e2a3e 0%, #2a3f5f 100%);
  border:1px solid #344267; color:var(--ink); text-align:left;
  padding:10px 12px; border-radius:8px; cursor:pointer;
  transition:all 0.2s ease; font-size:13px;
}
.power-btn:hover {
  background:linear-gradient(135deg, #2a3f5f 0%, #344267 100%);
  transform:translateY(-1px);
}
.power-btn .title { font-weight:600; color:var(--accent); margin-bottom:2px; }
.power-btn .desc { color:var(--muted); font-size:12px; }

/* AI Analysis Panel */
.ai-panel {
  background:linear-gradient(135deg, #4c1d95 0%, #7c3aed 100%);
  color:#fff; border:none; margin-bottom:16px;
}
.ai-panel h3 { color:#fff; }
.opportunity-score {
  font-size:2rem; font-weight:700; color:var(--good);
  text-align:center; margin:10px 0;
}
.score-medium { color:var(--opportunity); }
.score-low { color:var(--bad); }
.ai-grid {
  display:grid; grid-template-columns:1fr 1fr; gap:12px; margin:12px 0;
}
.ai-item {
  background:rgba(255,255,255,0.1); padding:10px; border-radius:8px;
}
.ai-item h4 { margin:0 0 6px; font-size:12px; opacity:0.8; }
.phrase-tag {
  background:rgba(255,255,255,0.2); padding:2px 6px; margin:2px;
  border-radius:12px; font-size:11px; display:inline-block;
}

/* Results */
.list { display:grid; gap:10px; }
.item { background:var(--field); border:1px solid var(--border); border-radius:12px; padding:12px; }
.badgeb {
  display:inline-block; font-size:12px; padding:3px 8px; border-radius:999px;
  background:#182033; color:var(--muted); margin-right:6px;
}
.score { background:#182a22; color:var(--good); }
.neg { background:#2a1a1a; color:var(--bad); }

a { color:#8ab4ff; text-decoration:none; }
a:hover { text-decoration:underline; }

/* Loading */
.loading { text-align:center; padding:20px; color:var(--muted); }
.spinner { 
  display:inline-block; width:20px; height:20px; margin-right:8px;
  border:2px solid #333; border-top:2px solid var(--accent); 
  border-radius:50%; animation:spin 1s linear infinite; 
}
@keyframes spin { 0%{ transform:rotate(0deg); } 100%{ transform:rotate(360deg); } }

/* Responsive */
@media (max-width:1100px){
  .container { grid-template-columns:320px 1fr; }
}
@media (max-width:900px){
  header .hint { display:none; }
  .container { grid-template-columns:1fr; gap:12px; }
  .ai-grid { grid-template-columns:1fr; }
}
@media (max-width:420px){
  input[type="text"] { font-size:16px; padding:14px; }
  button, select { padding:12px 14px; font-size:16px; }
}
</style>
</head>
<body>
<header>
  <div class="brand">ðŸ˜  GrumpyLinks <span class="badge">AI-Powered</span></div>
  <div class="hint">Find customer pain points. Turn complaints into opportunities.</div>
</header>

<main>
  <div class="container">
    <!-- Controls -->
    <section class="panel">
      <h3>Search</h3>
      <div class="searchbar">
        <input id="kw" type="text" placeholder="Brand, product, or topic" />
        <button id="runBtn" type="button">Hunt</button>
      </div>

      <h3 style="margin-top:16px">Power Queries âš¡</h3>
      <div class="power-queries" id="powerQueries"></div>

      <h3 style="margin-top:16px">Platforms</h3>
      <select id="platformSelect" style="width:100%;">
        <option value="all">All Platforms</option>
        <option value="reddit">Reddit</option>
        <option value="twitter">Twitter/X</option>
        <option value="linkedin">LinkedIn</option>
        <option value="hackernews">Hacker News</option>
        <option value="forums">Forums & Communities</option>
      </select>

      <h3 style="margin-top:16px">Time Range</h3>
      <select id="timeSelect" style="width:100%;">
        <option value="d30">Last 30 days</option>
        <option value="d7">Last 7 days</option>
        <option value="d1">Last 24 hours</option>
        <option value="y1">Last year</option>
      </select>
    </section>

    <!-- Output -->
    <section class="panel">
      <!-- AI Analysis Panel -->
      <div id="aiAnalysis" class="ai-panel" style="display:none;">
        <h3>ðŸ¤– AI Pain Point Analysis</h3>
        <div class="opportunity-score" id="opportunityScore">-</div>
        <div class="ai-grid">
          <div class="ai-item">
            <h4>Main Pain Point</h4>
            <div id="mainPainPoint">Analyzing...</div>
          </div>
          <div class="ai-item">
            <h4>Opportunity</h4>
            <div id="contentOpportunities">Analyzing...</div>
          </div>
        </div>
        <div class="ai-item">
          <h4>ðŸš€ Action Items</h4>
          <div id="actionItems">Analyzing...</div>
        </div>
        <div class="ai-item" style="margin-top:8px;">
          <h4>Trending Phrases</h4>
          <div id="trendingPhrases"></div>
        </div>
      </div>

      <h3>Results</h3>
      <div id="results" class="list">
        <div class="muted">Enter a search term and pick a power query to find pain points.</div>
      </div>
    </section>
  </div>
</main>

<script>
// Configuration - loaded from env-config.js
const API_CONFIG = {
  GOOGLE_API_KEY: '',
  SEARCH_ENGINE_ID: '',
  LAMBDA_ENDPOINT: ''
};

// Load configuration
function loadConfig() {
  if (window.ENV) {
    API_CONFIG.GOOGLE_API_KEY = window.ENV.GOOGLE_API_KEY || '';
    API_CONFIG.SEARCH_ENGINE_ID = window.ENV.SEARCH_ENGINE_ID || '';
    API_CONFIG.LAMBDA_ENDPOINT = window.ENV.LAMBDA_ENDPOINT || '';
  }
}

// Power Queries Library
const POWER_QUERIES = [
  {
    id: 'wish_list',
    title: 'Wish List Signals',
    desc: 'Find people begging for solutions',
    template: '"I wish there was" OR "I wish someone would" {{keyword}}'
  },
  {
    id: 'competitor_hate',
    title: 'Competitor Complaints',
    desc: 'Catch competitor frustrations',
    template: '("hate" OR "frustrated with" OR "terrible") {{keyword}}'
  },
  {
    id: 'switching_signals',
    title: 'Switching Signals',
    desc: 'People looking for alternatives',
    template: '("thinking of switching from" OR "looking for an alternative to" OR "better than") {{keyword}}'
  },
  {
    id: 'feature_requests',
    title: 'Feature Requests',
    desc: 'Product improvement demands',
    template: '("should add" OR "please add" OR "feature request") {{keyword}}'
  },
  {
    id: 'broken_promises',
    title: 'Broken Promises',
    desc: 'Unmet expectations',
    template: '("said it would" OR "supposed to" OR "promised") {{keyword}} ("not" OR "never" OR "doesnt")'
  },
  {
    id: 'urgent_help',
    title: 'Urgent Help Needed',
    desc: 'Immediate pain points',
    template: '("need help with" OR "how do I fix" OR "urgent") {{keyword}}'
  },
  {
    id: 'buying_intent',
    title: 'Hidden Buying Intent',
    desc: 'Recommendation requests',
    template: '("recommend me" OR "best way to" OR "what should I use") {{keyword}}'
  },
  {
    id: 'niche_demand',
    title: 'Unmet Niche Demand',
    desc: 'Underserved market segments',
    template: '("how do I" OR "anyone know how to" OR "is there a way") {{keyword}}'
  }
];

// Platform configurations
const PLATFORMS = {
  all: { sites: [] },
  reddit: { sites: ['site:reddit.com'] },
  twitter: { sites: ['site:twitter.com', 'site:x.com'] },
  linkedin: { sites: ['site:linkedin.com'] },
  hackernews: { sites: ['site:news.ycombinator.com'] },
  forums: { sites: ['site:stackoverflow.com', 'site:quora.com', 'inurl:forum', 'inurl:community'] }
};

let currentSearchResults = [];
let currentAnalysis = null;

// Initialize UI
function initUI() {
  const powerQueriesContainer = document.getElementById('powerQueries');
  
  POWER_QUERIES.forEach(query => {
    const btn = document.createElement('button');
    btn.className = 'power-btn';
    btn.innerHTML = `
      <div class="title">${query.title}</div>
      <div class="desc">${query.desc}</div>
    `;
    btn.onclick = () => runPowerQuery(query);
    powerQueriesContainer.appendChild(btn);
  });
}

// Build search query
function buildSearchQuery(template, keyword, platform, timeRange) {
  let query = template.replace(/\{\{keyword\}\}/g, `"${keyword}"`);
  
  // Add platform restrictions
  const platformConfig = PLATFORMS[platform] || PLATFORMS.all;
  if (platformConfig.sites.length > 0) {
    query += ' (' + platformConfig.sites.join(' OR ') + ')';
  }
  
  return query;
}

// Perform Google Custom Search
async function performGoogleSearch(query, timeRange = 'd30') {
  if (!API_CONFIG.GOOGLE_API_KEY || !API_CONFIG.SEARCH_ENGINE_ID) {
    throw new Error('Google API not configured');
  }
  
  const params = new URLSearchParams({
    key: API_CONFIG.GOOGLE_API_KEY,
    cx: API_CONFIG.SEARCH_ENGINE_ID,
    q: query,
    num: '10',
    dateRestrict: timeRange
  });
  
  const url = `https://www.googleapis.com/customsearch/v1?${params.toString()}`;
  
  const response = await fetch(url);
  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.error?.message || `Search failed: ${response.status}`);
  }
  
  const data = await response.json();
  return data.items || [];
}

// Analyze with AI
async function analyzeWithAI(results, query, platform) {
  if (!API_CONFIG.LAMBDA_ENDPOINT) {
    return {
      mainPainPoint: "AI analysis not configured",
      contentOpportunities: ["Configure Lambda endpoint"],
      trendingPhrases: ["setup", "needed"],
      opportunityScore: 3,
      actionItems: "Configure your Lambda endpoint to enable AI analysis."
    };
  }

  try {
    const response = await fetch(API_CONFIG.LAMBDA_ENDPOINT, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        query,
        platform,
        results: results.slice(0, 10)
      })
    });

    if (!response.ok) {
      throw new Error(`AI analysis failed: ${response.status}`);
    }

    return await response.json();
  } catch (error) {
    console.error('AI analysis error:', error);
    return {
      mainPainPoint: "AI analysis temporarily unavailable",
      contentOpportunities: ["Manual analysis recommended"],
      trendingPhrases: ["error", "retry"],
      opportunityScore: 3,
      actionItems: "Please try again later."
    };
  }
}

// Run power query
async function runPowerQuery(powerQuery) {
  const keyword = document.getElementById('kw').value.trim();
  if (!keyword) {
    alert('Please enter a search term');
    return;
  }
  
  const platform = document.getElementById('platformSelect').value;
  const timeRange = document.getElementById('timeSelect').value;
  
  // Show loading
  const resultsDiv = document.getElementById('results');
  const aiDiv = document.getElementById('aiAnalysis');
  
  resultsDiv.innerHTML = `
    <div class="loading">
      <div class="spinner"></div>
      Hunting for pain points...
    </div>
  `;
  
  aiDiv.style.display = 'block';
  document.getElementById('mainPainPoint').textContent = 'Analyzing...';
  document.getElementById('contentOpportunities').textContent = 'Analyzing...';
  document.getElementById('actionItems').textContent = 'Analyzing...';
  document.getElementById('opportunityScore').textContent = '-';
  document.getElementById('trendingPhrases').innerHTML = '';
  
  try {
    // Build and execute search
    const query = buildSearchQuery(powerQuery.template, keyword, platform, timeRange);
    const results = await performGoogleSearch(query, timeRange);
    currentSearchResults = results;
    
    // Display results
    displayResults(results, powerQuery.title);
    
    // Get AI analysis
    if (results.length > 0) {
      const analysis = await analyzeWithAI(results, query, platform);
      currentAnalysis = analysis;
      displayAIAnalysis(analysis);
    }
    
  } catch (error) {
    resultsDiv.innerHTML = `<div class="neg">Error: ${error.message}</div>`;
    aiDiv.style.display = 'none';
  }
}

// Display search results
function displayResults(results, queryTitle) {
  const resultsDiv = document.getElementById('results');
  
  if (!results.length) {
    resultsDiv.innerHTML = '<div class="muted">No results found. Try a different search term or platform.</div>';
    return;
  }
  
  let html = `<div style="margin-bottom:12px;"><strong>${queryTitle}</strong> - ${results.length} results found</div>`;
  
  results.forEach((result, index) => {
    // Highlight pain words
    let snippet = result.snippet || '';
    const painWords = ['frustrated', 'hate', 'terrible', 'broken', 'annoying', 'wish', 'need', 'help'];
    painWords.forEach(word => {
      const regex = new RegExp(`\\b${word}\\b`, 'gi');
      snippet = snippet.replace(regex, `<mark style="background:#fef3cd; padding:1px 2px; border-radius:2px;">$&</mark>`);
    });
    
    html += `
      <div class="item">
        <div style="display:flex; justify-content:space-between; align-items:start; gap:8px;">
          <a href="${result.link}" target="_blank" rel="noopener">${result.title}</a>
          <span class="badgeb">${result.displayLink}</span>
        </div>
        <div class="muted" style="margin-top:6px;">${snippet}</div>
      </div>
    `;
  });
  
  resultsDiv.innerHTML = html;
}

// Display AI analysis
function displayAIAnalysis(analysis) {
  document.getElementById('mainPainPoint').textContent = analysis.mainPainPoint || 'Analysis complete';
  
  // Content opportunities
  if (analysis.contentOpportunities && analysis.contentOpportunities.length > 0) {
    document.getElementById('contentOpportunities').innerHTML = analysis.contentOpportunities
      .slice(0, 2)
      .map(opp => `â€¢ ${opp}`)
      .join('<br>');
  }
  
  // Action items
  document.getElementById('actionItems').textContent = analysis.actionItems || 'No specific actions identified';
  
  // Opportunity score
  const score = analysis.opportunityScore || 5;
  const scoreElement = document.getElementById('opportunityScore');
  scoreElement.textContent = `${score}/10`;
  scoreElement.className = 'opportunity-score';
  if (score >= 8) scoreElement.classList.add('score-high');
  else if (score >= 6) scoreElement.classList.add('score-medium');
  else scoreElement.classList.add('score-low');
  
  // Trending phrases
  if (analysis.trendingPhrases && analysis.trendingPhrases.length > 0) {
    document.getElementById('trendingPhrases').innerHTML = analysis.trendingPhrases
      .slice(0, 6)
      .map(phrase => `<span class="phrase-tag">${phrase}</span>`)
      .join('');
  }
}

// Event listeners
document.getElementById('runBtn').addEventListener('click', () => {
  // Default to competitor complaints if no specific power query selected
  runPowerQuery(POWER_QUERIES[1]);
});

document.getElementById('kw').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    runPowerQuery(POWER_QUERIES[1]);
  }
});

// Initialize
loadConfig();
initUI();

// Load last search term
const lastSearch = localStorage.getItem('grumpy_kw');
if (lastSearch) {
  document.getElementById('kw').value = lastSearch;
}

// Save search term on input
document.getElementById('kw').addEventListener('input', (e) => {
  localStorage.setItem('grumpy_kw', e.target.value);
});
</script>
</body>
</html>