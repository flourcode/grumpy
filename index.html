<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GrumpyLinks ‚Äî AI-Powered Pain Point Discovery</title>
<script src="env-config.js"></script>
<style>
:root {
  --bg:#f8fafc; --sidebar:#ffffff; --card:#ffffff; --ink:#1e293b; --muted:#64748b;
  --accent:#3b82f6; --success:#10b981; --warning:#f59e0b; --danger:#ef4444;
  --border:#e2e8f0; --hover:#f1f5f9; --ai:#8b5cf6;
  --shadow:0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px 0 rgba(0,0,0,0.06);
  --shadow-lg:0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
  
  /* Platform Colors */
  --reddit:#ff4500; --twitter:#1da1f2; --linkedin:#0077b5; --hackernews:#ff6600;
  --github:#333; --stackoverflow:#f48024; --medium:#000; --quora:#b92b27;
}

* { box-sizing: border-box; }
html,body { margin:0; padding:0; font-family: Inter, system-ui, sans-serif; }
body { background:var(--bg); color:var(--ink); line-height:1.5; }

/* Layout */
.app { display:flex; min-height:100vh; }

/* Sidebar */
.sidebar {
  width:280px; background:var(--sidebar); border-right:1px solid var(--border);
  padding:20px; overflow-y:auto; flex-shrink:0;
}
.logo { font-size:20px; font-weight:700; margin-bottom:24px; color:var(--ink); }
.logo .emoji { margin-right:8px; }

.section { margin-bottom:24px; }
.section-title { 
  font-size:14px; font-weight:600; color:var(--muted); 
  text-transform:uppercase; letter-spacing:0.5px; margin-bottom:12px; 
}

/* Search */
.search-input {
  width:100%; padding:12px 16px; border:2px solid var(--border);
  border-radius:8px; font-size:15px; background:var(--bg);
  transition:border-color 0.2s ease;
}
.search-input:focus {
  outline:none; border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(59,130,246,0.1);
}

.search-btn {
  width:100%; margin-top:8px; padding:12px; background:var(--accent);
  color:white; border:none; border-radius:8px; font-weight:600;
  cursor:pointer; transition:background 0.2s ease;
}
.search-btn:hover { background:#2563eb; }

/* Power Queries */
.power-query {
  display:block; width:100%; text-align:left; padding:12px 16px;
  background:white; border:2px solid var(--border); border-radius:8px;
  margin-bottom:8px; cursor:pointer; transition:all 0.2s ease;
}
.power-query:hover {
  border-color:var(--accent); background:var(--hover);
  transform:translateY(-1px); box-shadow:var(--shadow);
}
.power-query .title { font-weight:600; color:var(--ink); margin-bottom:4px; }
.power-query .desc { font-size:13px; color:var(--muted); }

/* Filters */
.filter-select {
  width:100%; padding:10px 12px; border:2px solid var(--border);
  border-radius:8px; background:white; margin-bottom:8px;
}

/* Main Content */
.main-content {
  flex:1; padding:20px; overflow-y:auto;
}

/* Header */
.content-header {
  display:flex; justify-content:space-between; align-items:center;
  margin-bottom:24px; padding-bottom:16px; border-bottom:1px solid var(--border);
}
.page-title { font-size:24px; font-weight:700; margin:0; }
.status-badge {
  padding:4px 12px; border-radius:20px; font-size:13px; font-weight:500;
}
.status-success { background:#dcfce7; color:#166534; }
.status-warning { background:#fef3c7; color:#92400e; }
.status-info { background:#dbeafe; color:#1e40af; }

/* Compact AI Summary */
.ai-summary {
  background:linear-gradient(135deg, #f8faff 0%, #f0f4ff 100%);
  border:2px solid var(--ai); border-radius:12px; padding:16px; margin-bottom:20px;
  display:none;
}
.ai-summary-header {
  display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;
}
.ai-summary-title { font-weight:600; color:var(--ai); margin:0; }
.ai-summary-score {
  font-size:18px; font-weight:700; padding:4px 8px; border-radius:8px;
}
.score-high { background:#dcfce7; color:#166534; }
.score-medium { background:#fef3c7; color:#92400e; }
.score-low { background:#fecaca; color:#dc2626; }
.ai-summary-content { font-size:14px; color:var(--muted); }

/* Results */
.results-header {
  display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;
}
.results-count { color:var(--muted); font-size:14px; }

.results-grid {
  display:grid; grid-template-columns:repeat(auto-fill, minmax(420px, 1fr));
  gap:16px;
}

.result-card {
  background:white; border:2px solid var(--border); border-radius:12px;
  padding:16px; transition:all 0.2s ease; position:relative;
}
.result-card:hover {
  border-color:var(--accent); transform:translateY(-2px); box-shadow:var(--shadow-lg);
}

/* AI-Enhanced Card Features */
.card-header {
  display:flex; justify-content:space-between; align-items:start; margin-bottom:12px; gap:12px;
}

.relevance-bar {
  position:absolute; top:0; left:0; height:4px; border-radius:12px 12px 0 0;
  transition:width 0.3s ease;
}
.relevance-high { background:var(--success); width:80%; }
.relevance-medium { background:var(--warning); width:60%; }
.relevance-low { background:var(--muted); width:40%; }

.result-title {
  font-weight:600; font-size:15px; line-height:1.4; margin:0; flex:1;
}
.result-title a { color:var(--ink); text-decoration:none; }
.result-title a:hover { color:var(--accent); }

.source-badge {
  padding:4px 8px; border-radius:16px; font-size:11px; font-weight:600;
  white-space:nowrap; color:white; text-transform:uppercase;
}
.source-reddit { background:var(--reddit); }
.source-twitter { background:var(--twitter); }
.source-linkedin { background:var(--linkedin); }
.source-hackernews { background:var(--hackernews); }
.source-github { background:var(--github); }
.source-stackoverflow { background:var(--stackoverflow); }
.source-medium { background:var(--medium); }
.source-quora { background:var(--quora); }
.source-default { background:var(--muted); }

.result-snippet {
  color:var(--muted); font-size:14px; line-height:1.5; margin-bottom:12px;
}

/* AI Insights in Card */
.ai-insights {
  background:rgba(139, 92, 246, 0.05); border:1px solid rgba(139, 92, 246, 0.2);
  border-radius:8px; padding:10px; margin:12px 0; font-size:12px;
}
.ai-insights-header {
  display:flex; justify-content:space-between; align-items:center; margin-bottom:6px;
}
.ai-label { color:var(--ai); font-weight:600; }
.pain-score {
  background:var(--ai); color:white; padding:2px 6px; border-radius:12px;
  font-size:10px; font-weight:600;
}
.ai-tags { display:flex; flex-wrap:wrap; gap:4px; margin-top:6px; }
.ai-tag {
  background:rgba(139, 92, 246, 0.1); color:var(--ai); padding:2px 6px;
  border-radius:10px; font-size:10px; font-weight:500;
}

.result-footer {
  display:flex; justify-content:space-between; align-items:center;
  font-size:12px; color:var(--muted); margin-top:12px;
}

/* Loading */
.loading { text-align:center; padding:40px; color:var(--muted); }
.spinner {
  display:inline-block; width:20px; height:20px; margin-right:8px;
  border:2px solid #e5e7eb; border-top:2px solid var(--accent);
  border-radius:50%; animation:spin 1s linear infinite;
}
@keyframes spin { 0%{ transform:rotate(0deg); } 100%{ transform:rotate(360deg); } }

.empty-state { text-align:center; padding:60px 20px; color:var(--muted); }
.empty-state .emoji { font-size:48px; margin-bottom:16px; }

/* Responsive */
@media (max-width: 1024px) {
  .app { flex-direction:column; }
  .sidebar { width:100%; padding:16px; }
  .main-content { padding:16px; }
  .results-grid { grid-template-columns:1fr; }
}

@media (max-width: 640px) {
  .content-header { flex-direction:column; align-items:start; gap:12px; }
  .results-header { flex-direction:column; align-items:start; gap:8px; }
  .card-header { flex-direction:column; align-items:start; gap:8px; }
}
</style>
</head>
<body>

<div class="app">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <span class="emoji">üò†</span>GrumpyLinks
    </div>

    <div class="section">
      <div class="section-title">Search</div>
      <input id="searchInput" class="search-input" type="text" 
             placeholder="Enter brand, product, or topic..." />
      <button id="searchBtn" class="search-btn">üîç Hunt Pain Points</button>
    </div>

    <div class="section">
      <div class="section-title">Power Queries</div>
      <div id="powerQueries"></div>
    </div>

    <div class="section">
      <div class="section-title">Filters</div>
      <select id="platformSelect" class="filter-select">
        <option value="all">All Platforms</option>
        <option value="reddit">Reddit</option>
        <option value="twitter">Twitter/X</option>
        <option value="linkedin">LinkedIn</option>
        <option value="hackernews">Hacker News</option>
        <option value="forums">Forums & Communities</option>
      </select>
      
      <select id="timeSelect" class="filter-select">
        <option value="d30">Last 30 days</option>
        <option value="d7">Last 7 days</option>
        <option value="d1">Last 24 hours</option>
        <option value="y1">Last year</option>
      </select>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <header class="content-header">
      <h1 class="page-title">Pain Point Discovery</h1>
      <span id="statusBadge" class="status-badge status-info">Ready to hunt</span>
    </header>

    <!-- Compact AI Summary -->
    <div id="aiSummary" class="ai-summary">
      <div class="ai-summary-header">
        <h3 class="ai-summary-title">ü§ñ AI Analysis</h3>
        <span id="overallScore" class="ai-summary-score">-</span>
      </div>
      <div id="summaryContent" class="ai-summary-content"></div>
    </div>

    <!-- Results -->
    <section>
      <div class="results-header">
        <h2 style="margin:0; font-size:18px; font-weight:600;">Search Results</h2>
        <span id="resultsCount" class="results-count">No results yet</span>
      </div>
      
      <div id="resultsGrid" class="results-grid">
        <div class="empty-state">
          <div class="emoji">üîç</div>
          <h3>Ready to Hunt Pain Points</h3>
          <p>Enter a search term and select a power query to discover customer frustrations and opportunities.</p>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
// Configuration
const API_CONFIG = {
  GOOGLE_API_KEY: '',
  SEARCH_ENGINE_ID: '',
  LAMBDA_ENDPOINT: ''
};

// Load configuration
function loadConfig() {
  if (window.ENV) {
    API_CONFIG.GOOGLE_API_KEY = window.ENV.GOOGLE_API_KEY || '';
    API_CONFIG.SEARCH_ENGINE_ID = window.ENV.SEARCH_ENGINE_ID || '';
    API_CONFIG.LAMBDA_ENDPOINT = window.ENV.LAMBDA_ENDPOINT || '';
  }
}

// Power Queries
const POWER_QUERIES = [
  {
    id: 'wish_list',
    title: 'Wish List Signals',
    desc: 'People begging for solutions',
    template: '"I wish there was" OR "I wish someone would" {{keyword}}'
  },
  {
    id: 'competitor_hate',
    title: 'Competitor Complaints',
    desc: 'Frustrations with competitors',
    template: '("hate" OR "frustrated with" OR "terrible") {{keyword}}'
  },
  {
    id: 'switching_signals',
    title: 'Switching Signals',
    desc: 'Looking for alternatives',
    template: '("switching from" OR "alternative to" OR "better than") {{keyword}}'
  },
  {
    id: 'feature_requests',
    title: 'Feature Requests',
    desc: 'Product improvement demands',
    template: '("should add" OR "please add" OR "feature request") {{keyword}}'
  },
  {
    id: 'broken_promises',
    title: 'Broken Promises',
    desc: 'Unmet expectations',
    template: '("said it would" OR "supposed to") {{keyword}} ("not" OR "never")'
  },
  {
    id: 'urgent_help',
    title: 'Urgent Help',
    desc: 'Immediate pain points',
    template: '("need help with" OR "how do I fix" OR "urgent") {{keyword}}'
  }
];

// Platform configurations
const PLATFORMS = {
  all: { sites: [] },
  reddit: { sites: ['site:reddit.com'] },
  twitter: { sites: ['site:twitter.com'] },
  linkedin: { sites: ['site:linkedin.com'] },
  hackernews: { sites: ['site:news.ycombinator.com'] },
  forums: { sites: ['site:stackoverflow.com', 'site:quora.com'] }
};

let currentSearchResults = [];
let currentAnalysis = null;

// Initialize
function init() {
  loadConfig();
  initPowerQueries();
  setupEventListeners();
  loadLastSearch();
}

// Initialize power queries
function initPowerQueries() {
  const container = document.getElementById('powerQueries');
  
  POWER_QUERIES.forEach(query => {
    const btn = document.createElement('button');
    btn.className = 'power-query';
    btn.innerHTML = `
      <div class="title">${query.title}</div>
      <div class="desc">${query.desc}</div>
    `;
    btn.onclick = () => runPowerQuery(query);
    container.appendChild(btn);
  });
}

// Setup event listeners
function setupEventListeners() {
  document.getElementById('searchBtn').onclick = () => runPowerQuery(POWER_QUERIES[1]);
  document.getElementById('searchInput').onkeydown = (e) => {
    if (e.key === 'Enter') runPowerQuery(POWER_QUERIES[1]);
  };
  document.getElementById('searchInput').oninput = (e) => {
    localStorage.setItem('grumpy_search', e.target.value);
  };
}

// Load last search
function loadLastSearch() {
  const lastSearch = localStorage.getItem('grumpy_search');
  if (lastSearch) {
    document.getElementById('searchInput').value = lastSearch;
  }
}

// Build search query
function buildSearchQuery(template, keyword, platform) {
  let query = template.replace(/\{\{keyword\}\}/g, `"${keyword}"`);
  
  const platformConfig = PLATFORMS[platform] || PLATFORMS.all;
  if (platformConfig.sites.length > 0) {
    query += ' (' + platformConfig.sites.join(' OR ') + ')';
  }
  
  return query;
}

// Get platform class for source badge
function getPlatformClass(domain) {
  if (domain.includes('reddit')) return 'source-reddit';
  if (domain.includes('twitter') || domain.includes('x.com')) return 'source-twitter';
  if (domain.includes('linkedin')) return 'source-linkedin';
  if (domain.includes('news.ycombinator')) return 'source-hackernews';
  if (domain.includes('github')) return 'source-github';
  if (domain.includes('stackoverflow')) return 'source-stackoverflow';
  if (domain.includes('medium')) return 'source-medium';
  if (domain.includes('quora')) return 'source-quora';
  return 'source-default';
}

// Get platform name
function getPlatformName(domain) {
  if (domain.includes('reddit')) return 'Reddit';
  if (domain.includes('twitter') || domain.includes('x.com')) return 'Twitter';
  if (domain.includes('linkedin')) return 'LinkedIn';
  if (domain.includes('news.ycombinator')) return 'HackerNews';
  if (domain.includes('github')) return 'GitHub';
  if (domain.includes('stackoverflow')) return 'StackOverflow';
  if (domain.includes('medium')) return 'Medium';
  if (domain.includes('quora')) return 'Quora';
  return domain.split('.')[0].toUpperCase();
}

// Calculate pain score for individual result
function calculatePainScore(result, analysis) {
  const text = `${result.title} ${result.snippet}`.toLowerCase();
  const painWords = ['hate', 'frustrated', 'terrible', 'broken', 'annoying', 'awful', 'worst'];
  const urgentWords = ['urgent', 'help', 'fix', 'stuck', 'critical'];
  const wishWords = ['wish', 'want', 'need', 'should', 'please'];
  
  let score = 5; // base score
  
  // Pain indicators
  painWords.forEach(word => {
    if (text.includes(word)) score += 2;
  });
  
  // Urgency indicators
  urgentWords.forEach(word => {
    if (text.includes(word)) score += 1;
  });
  
  // Wish/demand indicators
  wishWords.forEach(word => {
    if (text.includes(word)) score += 1;
  });
  
  // Trending phrase bonus
  if (analysis?.trendingPhrases) {
    analysis.trendingPhrases.forEach(phrase => {
      if (text.includes(phrase.toLowerCase())) score += 1;
    });
  }
  
  return Math.min(Math.max(score, 1), 10);
}

// Get AI tags for result
function getAITags(result, analysis) {
  const text = `${result.title} ${result.snippet}`.toLowerCase();
  const tags = [];
  
  if (text.includes('alternative') || text.includes('switch')) tags.push('switching');
  if (text.includes('feature') || text.includes('add')) tags.push('feature-req');
  if (text.includes('broken') || text.includes('bug')) tags.push('broken');
  if (text.includes('expensive') || text.includes('price')) tags.push('pricing');
  if (text.includes('urgent') || text.includes('help')) tags.push('urgent');
  if (text.includes('wish') || text.includes('want')) tags.push('wishlist');
  
  return tags.slice(0, 3); // Max 3 tags
}

// Perform Google search
async function performGoogleSearch(query, timeRange) {
  if (!API_CONFIG.GOOGLE_API_KEY || !API_CONFIG.SEARCH_ENGINE_ID) {
    throw new Error('Google API not configured');
  }
  
  const params = new URLSearchParams({
    key: API_CONFIG.GOOGLE_API_KEY,
    cx: API_CONFIG.SEARCH_ENGINE_ID,
    q: query,
    num: '10',
    dateRestrict: timeRange
  });
  
  const response = await fetch(`https://www.googleapis.com/customsearch/v1?${params}`);
  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.error?.message || 'Search failed');
  }
  
  const data = await response.json();
  return data.items || [];
}

// Analyze with AI
async function analyzeWithAI(results, query, platform) {
  if (!API_CONFIG.LAMBDA_ENDPOINT) {
    return {
      mainPainPoint: "AI analysis not configured",
      contentOpportunities: ["Configure Lambda endpoint"],
      trendingPhrases: ["setup", "needed"],
      opportunityScore: 3,
      actionItems: "Configure your Lambda endpoint to enable AI analysis."
    };
  }

  try {
    const response = await fetch(API_CONFIG.LAMBDA_ENDPOINT, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ query, platform, results: results.slice(0, 10) })
    });

    if (!response.ok) throw new Error(`AI analysis failed: ${response.status}`);
    return await response.json();
  } catch (error) {
    return {
      mainPainPoint: "AI analysis temporarily unavailable",
      contentOpportunities: ["Manual analysis recommended"],
      trendingPhrases: ["error", "retry"],
      opportunityScore: 3,
      actionItems: "Please try again later."
    };
  }
}

// Run power query
async function runPowerQuery(powerQuery) {
  const keyword = document.getElementById('searchInput').value.trim();
  if (!keyword) {
    alert('Please enter a search term');
    return;
  }
  
  const platform = document.getElementById('platformSelect').value;
  const timeRange = document.getElementById('timeSelect').value;
  
  // Update status
  document.getElementById('statusBadge').textContent = 'Searching...';
  document.getElementById('statusBadge').className = 'status-badge status-warning';
  
  // Show loading
  showLoading();
  
  try {
    const query = buildSearchQuery(powerQuery.template, keyword, platform);
    const results = await performGoogleSearch(query, timeRange);
    currentSearchResults = results;
    
    // Get AI analysis first
    let analysis = null;
    if (results.length > 0) {
      analysis = await analyzeWithAI(results, query, platform);
      currentAnalysis = analysis;
    }
    
    // Display results with AI insights
    displayResults(results, powerQuery.title, analysis);
    
    // Show compact summary
    if (analysis) {
      displayCompactSummary(analysis);
    }
    
    // Update status
    document.getElementById('statusBadge').textContent = `Found ${results.length} results`;
    document.getElementById('statusBadge').className = 'status-badge status-success';
    
  } catch (error) {
    document.getElementById('statusBadge').textContent = 'Error occurred';
    document.getElementById('statusBadge').className = 'status-badge status-warning';
    showError(error.message);
  }
}

// Show loading
function showLoading() {
  document.getElementById('aiSummary').style.display = 'none';
  document.getElementById('resultsGrid').innerHTML = `
    <div class="loading">
      <div class="spinner"></div>
      Hunting for pain points...
    </div>
  `;
  document.getElementById('resultsCount').textContent = 'Searching...';
}

// Show error
function showError(message) {
  document.getElementById('resultsGrid').innerHTML = `
    <div class="empty-state">
      <div class="emoji">‚ö†Ô∏è</div>
      <h3>Search Error</h3>
      <p>${message}</p>
    </div>
  `;
}

// Display compact summary
function displayCompactSummary(analysis) {
  const summary = document.getElementById('aiSummary');
  const score = analysis.opportunityScore || 5;
  
  document.getElementById('overallScore').textContent = `${score}/10`;
  document.getElementById('overallScore').className = `ai-summary-score ${score >= 8 ? 'score-high' : score >= 6 ? 'score-medium' : 'score-low'}`;
  
  document.getElementById('summaryContent').textContent = analysis.mainPainPoint || 'Analysis complete';
  
  summary.style.display = 'block';
}

// Display results with AI insights
function displayResults(results, queryTitle, analysis) {
  const grid = document.getElementById('resultsGrid');
  
  if (!results.length) {
    grid.innerHTML = `
      <div class="empty-state">
        <div class="emoji">üîç</div>
        <h3>No Results Found</h3>
        <p>Try a different search term or platform.</p>
      </div>
    `;
    return;
  }
  
  document.getElementById('resultsCount').textContent = `${results.length} results found`;
  
  let html = '';
  results.forEach(result => {
    const painScore = calculatePainScore(result, analysis);
    const aiTags = getAITags(result, analysis);
    const platformClass = getPlatformClass(result.displayLink);
    const platformName = getPlatformName(result.displayLink);
    
    // Highlight pain words
    let snippet = result.snippet || '';
    const painWords = ['frustrated', 'hate', 'terrible', 'broken', 'annoying', 'wish', 'need', 'help', 'urgent'];
    painWords.forEach(word => {
      const regex = new RegExp(`\\b${word}\\b`, 'gi');
      snippet = snippet.replace(regex, `<mark style="background:#fef3c7; padding:2px 4px; border-radius:4px;">$&</mark>`);
    });
    
    // Relevance bar class
    const relevanceClass = painScore >= 8 ? 'relevance-high' : painScore >= 6 ? 'relevance-medium' : 'relevance-low';
    
    html += `
      <div class="result-card">
        <div class="${relevanceClass} relevance-bar"></div>
        <div class="card-header">
          <h3 class="result-title">
            <a href="${result.link}" target="_blank" rel="noopener">${result.title}</a>
          </h3>
          <span class="source-badge ${platformClass}">${platformName}</span>
        </div>
        <div class="result-snippet">${snippet}</div>
        
        <div class="ai-insights">
          <div class="ai-insights-header">
            <span class="ai-label">ü§ñ AI Insights</span>
            <span class="pain-score">${painScore}/10</span>
          </div>
          ${aiTags.length > 0 ? `<div class="ai-tags">${aiTags.map(tag => `<span class="ai-tag">${tag}</span>`).join('')}</div>` : ''}
        </div>
        
        <div class="result-footer">
          <span>Source: ${result.displayLink}</span>
          <a href="${result.link}" target="_blank" rel="noopener" style="color:var(--accent);">View ‚Üí</a>
        </div>
      </div>
    `;
  });
  
  grid.innerHTML = html;
}

// Initialize app
init();
</script>
</body>
</html>