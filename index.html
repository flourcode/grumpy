<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Grumpy Links — Turn Complaints Into Opportunities</title>
<meta name="description" content="Find customer pain points fast. Run live searches across Reddit, LinkedIn, X, HN and more — then turn complaints into content, products, or sales." />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
<script src="env-config.js"></script>
<style>
  :root{
    --bg:#f6f6f6; --card:#ffffff; --ink:#1f2328; --muted:#6b7280;
    --line:#e5e7eb; --accent:#ffcc4d; --radius:12px;
    --shadow:0 1px 2px rgba(0,0,0,.04), 0 2px 8px rgba(0,0,0,.04);
    --success:#10b981; --warning:#f59e0b; --danger:#ef4444;
  }
  *{ box-sizing:border-box; }
  html{ scroll-behavior:smooth; }
  html,body{ margin:0; padding:0; }
  body{ font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); color:var(--ink); line-height:1.55; }

  /* NAV (optional minimal) */
  .nav{ position:sticky; top:0; z-index:50; background:#fff; border-bottom:1px solid var(--line); }
  .nav-inner{ max-width:1100px; margin:0 auto; padding:10px 16px; display:flex; align-items:center; justify-content:space-between; gap:12px; }
  .brand{ display:flex; align-items:center; gap:10px; text-decoration:none; color:inherit; }
  .brand img{ height:28px; width:auto; border-radius:8px; }
  .brand-name{ font-weight:700; letter-spacing:.2px; }
  .nav-links{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .nav-link{ padding:8px 10px; border-radius:9px; text-decoration:none; color:var(--ink); font-size:.95rem; }
  .nav-link:hover{ background:#f3f4f6; }
  .nav-cta{ background:var(--accent); color:#222; text-decoration:none; padding:10px 14px; border-radius:10px; font-weight:700; }
  .nav-cta:hover{ filter:brightness(.95); }

  header,main,footer{ max-width:1100px; margin:0 auto; padding:0 16px; }

  /* HERO */
  .hero{ text-align:center; padding:48px 16px 28px;}
  .hero-wrap{ max-width:760px; margin:0 auto; }
  .hero-logo{ max-height:200px; width:auto; height:auto; margin-bottom:0px; }
  .hero-title{ font-size:2.6rem; font-weight:800; margin:0; letter-spacing:.2px; }
  .hero-tag{ font-size:1.35rem; font-weight:600; color:#3a2a3f; margin:8px 0 10px; }
  .hero-sub{ color:#5b5b5b; margin:0 auto 20px; max-width:680px; font-size:1.05rem; }
  .hero-cta{ display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:6px; }
  .btn{ border:1px solid var(--line); background:#fff; padding:12px 18px; border-radius:10px; cursor:pointer; text-decoration:none; color:#222; font-weight:700; }
  .btn:hover{ background:#f3f4f6; }
  .btn-primary{ background:var(--accent); color:#222; border:none; }
  .btn-primary:hover{ filter:brightness(.95); }

  /* SECTIONS */
  .section{ margin-top:28px; }
  .section-title{ display:flex; align-items:center; gap:8px; font-size:1.05rem; font-weight:800; margin:0 0 10px; }
  .tag{ display:inline-block; font-size:.75rem; padding:3px 8px; border-radius:999px; background:#fff7d1; border:1px solid #ffe89c; color:#7a5d00; }
  .tag.ai{ background:#f0f7ff; border:1px solid #cfe2ff; color:#1e40af; }
  .tag.hot{ background:#fff1f0; border:1px solid #fecaca; color:#dc2626; }

  /* CARDS & GRID */
  .card{ background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow); }
  .grid{ display:grid; grid-template-columns:1fr; gap:10px; }
  @media (min-width:860px){ .grid.two{ grid-template-columns:1fr 1fr; } .grid.three{ grid-template-columns:1fr 1fr 1fr; } }

  /* EXAMPLE TILES */
  .tile{ display:block; width:100%; text-align:left; background:#fff; border:1px solid var(--line);
         padding:12px 14px; border-radius:10px; cursor:pointer; font-size:.95rem;
         transition:background .15s ease, border-color .15s ease, transform .02s ease; }
  .tile:hover{ background:#f7f7f7; border-color:#d9dde2; }
  .tile:active{ transform:translateY(1px); }
  .tt{ font-weight:700; margin-bottom:4px; }
  .td{ color:#6b7280; font-size:.9rem; }

  .tip{ background:#fff7d1; border:1px solid #ffe89c; border-radius:10px; padding:12px; color:#5d4a00; margin-top:10px; }

  /* BUILDER */
  .field{ display:flex; flex-direction:column; gap:6px; margin-bottom:10px; }
  .label{ font-size:.9rem; color:#374151; }
  input[type="text"], select{ width:100%; border:1px solid var(--line); background:#fff; border-radius:10px; padding:10px 12px; font-size:.98rem; }
  input:focus, select:focus{ outline:none; border-color:#cfe5fb; box-shadow:0 0 0 3px rgba(14,165,233,.15); }
  .code{ font-family:ui-monospace,Menlo,Consolas,monospace; background:#fafafa; border:1px solid var(--line); border-radius:8px; padding:10px 12px; overflow:auto; font-size:.9rem; }
  .actions{ display:flex; gap:10px; flex-wrap:wrap; }

  /* SEARCH RESULTS */
  .results-section{ background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:18px; margin-top:16px; box-shadow:var(--shadow); }
  .results-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; padding-bottom:10px; border-bottom:1px solid var(--line); }
  .results-title{ font-weight:700; color:var(--ink); margin:0; }
  .close-results{ background:none; border:none; color:var(--muted); cursor:pointer; font-size:1.2rem; padding:4px 8px; border-radius:6px; }
  .close-results:hover{ background:#f3f4f6; }

  .search-info{ background:#f8fffe; border:1px solid #dcfce7; padding:12px; border-radius:8px; margin:16px 0; font-size:.9rem; }
  .search-query{ font-family:ui-monospace,Menlo,Consolas,monospace; background:#f1f5f9; padding:8px 10px; border-radius:6px; margin:6px 0; font-size:.85rem; word-break:break-all; cursor:pointer; transition:background .15s ease; }
  .search-query:hover{ background:#e2e8f0; }
  .search-url{ font-family:ui-monospace,Menlo,Consolas,monospace; background:#fef3cd; border:1px solid #fbbf24; color:#92400e; padding:8px 10px; border-radius:6px; margin:6px 0; font-size:.85rem; word-break:break-all; cursor:pointer; transition:all .15s ease; }
  .search-url:hover{ background:#fde68a; }

  .result-item{ padding:12px 0; border-bottom:1px solid #f0f0f0; }
  .result-item:last-child{ border-bottom:none; }
  .result-title{ font-weight:600; color:#666; margin:0 0 6px; font-size:.95rem; line-height:1.3; }
  .result-title-text{ color:#666; text-decoration:none; cursor:default; }
  .result-snippet{ color:var(--muted); font-size:.9rem; line-height:1.4; margin:0 0 6px; }
  .result-meta{ color:#999; font-size:.8rem; margin-top:4px; }
  .result-title a{ 
  color:#0ea5e9; 
  text-decoration:none; 
}
.result-title a:hover{ 
  text-decoration:underline; 
}

  /* AI ANALYSIS - PROMINENT HERO CONTENT */
  .ai-analysis{ 
    order: -1;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
    color:#fff; border-radius:var(--radius); padding:24px; 
    margin:0 0 20px 0; 
    box-shadow:0 12px 35px rgba(102, 126, 234, 0.2);
    animation: slideIn 0.5s ease-out;
  }
  
  @keyframes slideIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .ai-analysis h3{ margin:0 0 20px; display:flex; align-items:center; gap:8px; font-size:1.3rem; }
  .analysis-grid{ display:grid; grid-template-columns:1fr; gap:16px; }
  @media (min-width:768px){ .analysis-grid{ grid-template-columns:1fr 1fr; } }
  .analysis-item{ background:rgba(255,255,255,0.1); border-radius:8px; padding:14px; backdrop-filter:blur(10px); }
  .analysis-item h4{ margin:0 0 8px; font-size:.9rem; opacity:0.9; }
  .analysis-item .value{ font-size:1.1rem; font-weight:600; }
  .opportunity-score{ 
    font-size:2.5rem !important; font-weight:700; margin:0;
  }
  
  .score-high{ color:#10f5a8; }
  .score-medium{ color:#fbbf24; }
  .score-low{ color:#f87171; }
  .trending-phrases{ display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
  .phrase-tag{ background:rgba(255,255,255,0.2); padding:4px 8px; border-radius:16px; font-size:.8rem; }

  /* COLLAPSED SEARCH RESULTS */
  .search-results-collapsed {
    max-height: 200px;
    overflow: hidden;
    position: relative;
  }

  .search-results-collapsed::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 50px;
    background: linear-gradient(transparent, white);
  }

  .show-more-btn {
    margin: 10px 0;
    background: var(--accent);
    color: #222;
    border: none;
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.2s ease;
  }
  
  .show-more-btn:hover {
    filter: brightness(0.95);
    transform: translateY(-1px);
  }

  /* LOADING & ERROR */
  .loading-spinner{ text-align:center; padding:20px; color:var(--muted); }
  .spinner{ display:inline-block; width:20px; height:20px; border:2px solid var(--line); border-top:2px solid var(--accent); border-radius:50%; animation:spin 1s linear infinite; }
  @keyframes spin{ 0%{ transform:rotate(0deg); } 100%{ transform:rotate(360deg); } }
  .error-message{ background:#fef2f2; border:1px solid #fecaca; color:#dc2626; padding:12px; border-radius:8px; margin:10px 0; }
  .success-message{ background:#f0fdf4; border:1px solid #bbf7d0; color:#15803d; padding:12px; border-radius:8px; margin:10px 0; }

  .progress-bar-container {
    width: 100%; 
    background: #f0f0f0; 
    border-radius: 10px; 
    margin-top: 10px;
    overflow: hidden;
  }
  
  .progress-bar {
    height: 6px; 
    background: var(--accent); 
    border-radius: 10px; 
    transition: width 0.3s ease;
    width: 0%;
  }

  /* NEWSLETTER */
  .nl{ display:flex; flex-direction:column; gap:10px; }
  .nl-row{ display:flex; gap:10px; flex-wrap:wrap; }
  .nl-row input{ flex:1; min-width:220px; }
  .nl-note{ color:#6b7280; font-size:.9rem; }

  .hidden{ display:none; }
  .copy-btn{ background:var(--success); color:#fff; border:none; padding:6px 10px; border-radius:6px; font-size:.8rem; cursor:pointer; margin-left:8px; transition:all .15s ease; }
  .copy-btn:hover{ background:#059669; }

  footer{ color:#6b7280; font-size:.9rem; padding:28px 0 48px; border-top:1px solid var(--line); margin-top:40px; text-align:center; }
</style>
</head>
<body>

<!-- NAV -->
<nav class="nav">
  <div class="nav-inner">
    <a class="brand" href="#top">
      <span class="brand-name">😠 Grumpy Links</span>
    </a>
    <div class="nav-links">
      <a class="nav-link" href="#tool">Try Free</a>
      <a class="nav-link" href="#newsletter">Newsletter</a>
      <a class="nav-cta" href="#tool">Start Hunting</a>
    </div>
  </div>
</nav>

<!-- HERO -->
<header id="top" class="hero">
  <div class="hero-wrap">
    <h1 class="hero-title">😠 <br>
 Grumpy Links</h1>
    <p class="hero-tag">Turn Complaints Into Opportunities</p>
    <p class="hero-sub">
      Instantly find what your customers are frustrated about online — and turn those moments
      into ideas, content, products, or sales.
    </p>
    <div class="hero-cta">
      <a class="btn btn-primary" href="#tool">Try It Free</a>
      <a class="btn" href="#newsletter">Free Grumpy Club</a>
    </div>
  </div>
</header>

<main>
  <!-- EXAMPLES -->
  <section class="section" id="examples">
    <h2 class="section-title">Example Searches <span class="tag">live</span></h2>
    <div class="card">
      <div class="grid three">
        <button class="tile search-example" type="button" data-query="I wish there was" data-site="reddit.com">
          <div class="tt">"I wish there was" — Reddit</div>
          <div class="td">Wishlist posts → product & content gaps</div>
        </button>
        <button class="tile search-example" type="button" data-query="need help with" data-site="twitter.com">
          <div class="tt">"need help with" — X (Latest)</div>
          <div class="td">Real-time help requests</div>
        </button>
        <button class="tile search-example" type="button" data-query="frustrating OR annoying OR wish there was" data-site="news.ycombinator.com">
          <div class="tt">Tech pain — Hacker News</div>
          <div class="td">Frustrations & "wish there was" threads</div>
        </button>
        <button class="tile search-example" type="button" data-query="manual spreadsheet OR copy paste every week" data-site="reddit.com">
          <div class="tt">Automation gaps — Reddit</div>
          <div class="td">"manual spreadsheet" OR "copy paste every week"</div>
        </button>
        <button class="tile search-example" type="button" data-query="biggest mistake OR wish I knew" data-site="linkedin.com">
          <div class="tt">Lessons learned — LinkedIn</div>
          <div class="td">"biggest mistake" OR "wish I knew"</div>
        </button>
        <button class="tile search-example" type="button" data-query="why is it so hard OR what's the best way OR struggling with" data-site="quora.com">
          <div class="tt">How-to pain — Quora</div>
          <div class="td">Questions that reveal frustrations</div>
        </button>
      </div>
      <div class="tip">💡 Tip: Click any example to run a live search and get AI analysis of the pain points found!</div>
    </div>
  </section>

  <!-- TOOL -->
  <section class="section" id="tool">
    <h2 class="section-title">Smart Search Builder <span class="tag ai">AI analysis</span></h2>
    <div class="card">
      <div class="grid two">
        <div class="field">
          <span class="label">Source</span>
          <select id="src">
            <option value="reddit">Reddit (all)</option>
            <option value="reddit-entrepreneur">Reddit — r/Entrepreneur</option>
            <option value="linkedin">LinkedIn Posts</option>
            <option value="twitter">X (Twitter)</option>
            <option value="hackernews">Hacker News</option>
            <option value="quora">Quora</option>
            <option value="custom">Custom site…</option>
          </select>
        </div>
        <div class="field">
          <span class="label">Topic / industry</span>
          <input id="topic" type="text" placeholder="e.g., SaaS, AWS, sales, React" />
        </div>
      </div>

      <div class="field">
        <span class="label">Pain phrase</span>
        <select id="pain">
          <option value="">Choose…</option>
          <option value="struggling">struggling with</option>
          <option value="cantfind">can't find good</option>
          <option value="wishknew">wish I knew</option>
          <option value="needhelp">need help with</option>
          <option value="frustrated">frustrated with</option>
          <option value="tired">tired of</option>
          <option value="confused">confused about</option>
          <option value="wishsomeone">wish someone would make</option>
          <option value="custom">Custom…</option>
        </select>
      </div>

      <div class="field" id="customPhraseWrap" style="display:none">
        <span class="label">Custom phrase</span>
        <input id="customPhrase" type="text" placeholder='e.g., "unrealistic quota"' />
      </div>

      <div class="field" id="customSiteWrap" style="display:none">
        <span class="label">Custom site domain</span>
        <input id="customSite" type="text" placeholder="e.g., discord.com" />
      </div>

      <div class="field">
        <span class="label">Exclude words (optional)</span>
        <input id="exclude" type="text" placeholder="e.g., beginner, tutorial" />
      </div>

      <div class="grid two">
        <div class="field">
          <span class="label">Query preview</span>
          <div id="qPreview" class="code">—</div>
        </div>
        <div class="field">
          <span class="label">Target URL</span>
          <div id="urlPreview" class="code">—</div>
        </div>
      </div>

      <div class="actions" style="margin-top:8px">
        <button id="searchBtn" class="btn btn-primary" type="button">🔍 Search & Analyze</button>
        <button id="openBtn" class="btn" type="button">Open in Google</button>
        <button id="copyBtn" class="btn" type="button">Copy URL</button>
        <button id="resetBtn" class="btn" type="button">Reset</button>
      </div>
    </div>
  </section>

  <!-- SEARCH RESULTS -->
  <div id="searchResults" class="results-section hidden">
    <div class="results-header">
      <h3 class="results-title">Search Results</h3>
      <button class="close-results" onclick="hideResults()">✕</button>
    </div>
    
    <!-- AI Analysis Panel - Shows First -->
    <div id="aiAnalysis" class="ai-analysis hidden">
      <h3>🎯 Business Opportunities Found</h3>
      <div class="analysis-grid">
        <div class="analysis-item">
          <h4>Main Pain Point</h4>
          <div class="value" id="mainPainPoint">Analyzing...</div>
        </div>
        <div class="analysis-item">
          <h4>Opportunity Score</h4>
          <div class="opportunity-score" id="opportunityScore">-</div>
        </div>
        <div class="analysis-item">
          <h4>Content Opportunities</h4>
          <div id="contentOpportunities">Analyzing...</div>
        </div>
        <div class="analysis-item">
          <h4>Trending Phrases</h4>
          <div class="trending-phrases" id="trendingPhrases"></div>
        </div>
      </div>
      
      <div style="margin-top:16px; padding:14px; background:rgba(255,255,255,0.1); border-radius:8px;">
        <h4 style="margin:0 0 8px; font-size:.9rem;">🚀 Action Items:</h4>
        <div id="actionItems" style="font-size:.9rem; line-height:1.5;">
          Based on this analysis, consider creating content that addresses these pain points.
        </div>
        <div style="margin-top: 12px; text-align: center;">
          <button class="copy-btn" onclick="copyAnalysis()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);">
            📋 Copy Analysis
          </button>
        </div>
      </div>
    </div>
    
    <div id="resultsContent"></div>
    
    <div id="searchInfo" class="search-info hidden">
      <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px;">
        <strong>🔍 Search Details</strong>
        <span class="small">Click to copy</span>
      </div>
      
      <div>
        <strong>Query:</strong>
        <div id="searchQuery" class="search-query" onclick="copyToClipboard(this.textContent)" title="Click to copy search query"></div>
      </div>
      
      <div>
        <strong>Google Search URL:</strong>
        <div id="searchUrl" class="search-url" onclick="copyToClipboard(this.textContent)" title="Click to copy Google search URL"></div>
      </div>
      
      <div style="display:flex; gap:16px; font-size:.8rem; color:var(--muted); margin-top:8px; flex-wrap:wrap;">
        <div>⏱️ <span id="searchTime">Search time</span></div>
        <div>📊 <span id="resultCount">Results found</span></div>
        <div>🎯 <span id="platformInfo">Platform</span></div>
      </div>
    </div>
  </div>

  <!-- NEWSLETTER -->
  <section class="section" id="newsletter">
    <h2 class="section-title">Join the Grumpy Links Newsletter <span class="tag">weekly</span></h2>
    <div class="card nl">
      <p style="margin:0">Get fresh pain point finds, search recipes, and content angles — one tidy email per week.</p>
      <!-- Wire this to your ESP later; this is a client-side "thanks" demo -->
      <form id="nlForm" class="nl-row" action="#" method="get">
        <input type="email" id="nlEmail" placeholder="you@work.com" required />
        <button class="btn btn-primary" type="submit">Subscribe</button>
      </form>
      <div id="nlThanks" class="nl-note" style="display:none"><strong>You're in!</strong> Check your inbox for a welcome email.</div>
      <p class="nl-note">No spam. Unsubscribe anytime.</p>
    </div>
  </section>
</main>

<footer>
  © 2025 Grumpy Links. Find customer pain points and turn complaints into opportunities.
</footer>

<script>
  // Helpers
  const $ = (s)=>document.querySelector(s);
  const $$=(s)=>Array.from(document.querySelectorAll(s));

  // Configuration - will be set via environment variables
  const API_CONFIG = {
    GOOGLE_API_KEY: '', // Set via Amplify environment
    SEARCH_ENGINE_ID: '', // Set via Amplify environment  
    LAMBDA_ENDPOINT: '' // Set via Amplify environment
  };

  // Load configuration from environment (will be injected by Amplify)
  function loadConfig() {
    // In production, these will be injected by Amplify build process
    API_CONFIG.GOOGLE_API_KEY = window.ENV?.GOOGLE_API_KEY || '';
    API_CONFIG.SEARCH_ENGINE_ID = window.ENV?.SEARCH_ENGINE_ID || '';
    API_CONFIG.LAMBDA_ENDPOINT = window.ENV?.LAMBDA_ENDPOINT || '';
  }

  let currentSearchResults = [];
  let currentAnalysis = null;

  // Example tiles open searches (event delegation)
  document.addEventListener('click', async (e) => {
    const tile = e.target.closest('.search-example[data-query]');
    if (!tile) return;
    
    const query = tile.getAttribute('data-query');
    const site = tile.getAttribute('data-site') || '';
    const title = tile.querySelector('.tt').textContent;
    
    await performSearch(query, site, title);
  });

  // Show success message
  function showSuccess(message) {
    const toast = document.createElement('div');
    toast.className = 'success-message';
    toast.textContent = message;
    toast.style.position = 'fixed';
    toast.style.top = '20px';
    toast.style.right = '20px';
    toast.style.zIndex = '1000';
    document.body.appendChild(toast);
    setTimeout(() => document.body.removeChild(toast), 3000);
  }

  // Copy to clipboard
  async function copyToClipboard(text) {
    try {
      await navigator.clipboard.writeText(text);
      showSuccess('✅ Copied to clipboard!');
    } catch (error) {
      // Fallback
      const textArea = document.createElement('textarea');
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      showSuccess('✅ Copied to clipboard!');
    }
  }

  // Copy analysis function
  function copyAnalysis() {
    const analysis = currentAnalysis;
    if (!analysis) return;
    
    const text = `
Pain Point Analysis:
${analysis.mainPainPoint}

Content Opportunities:
${analysis.contentOpportunities.map((opp, i) => `${i+1}. ${opp}`).join('\n')}

Action Items:
${analysis.actionItems}

Opportunity Score: ${analysis.opportunityScore}/10
    `.trim();
    
    copyToClipboard(text);
  }

  // Perform Google Custom Search
  async function performGoogleSearch(query, site = '') {
    if (!API_CONFIG.GOOGLE_API_KEY || !API_CONFIG.SEARCH_ENGINE_ID) {
      throw new Error('Search API not configured. Please check your deployment settings.');
    }
    
    const startTime = Date.now();
    
    let searchQuery = query;
    if (site) {
      searchQuery = `${query} site:${site}`;
    }
    
    const url = `https://www.googleapis.com/customsearch/v1?key=${API_CONFIG.GOOGLE_API_KEY}&cx=${API_CONFIG.SEARCH_ENGINE_ID}&q=${encodeURIComponent(searchQuery)}&num=10`;
    
    const response = await fetch(url);
    
    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.error?.message || `Search failed: ${response.status}`);
    }
    
    const data = await response.json();
    const endTime = Date.now();
   const searchTime = ((endTime - startTime) / 1000).toFixed(2);
   
   const results = data.items ? data.items.map(item => ({
     title: item.title,
     snippet: item.snippet,
     url: item.link,
     displayLink: item.displayLink,
     formattedUrl: item.formattedUrl
   })) : [];
   
   return {
     results,
     searchTime,
     totalResults: data.searchInformation?.totalResults || '0',
     searchQuery,
     googleUrl: `https://www.google.com/search?q=${encodeURIComponent(searchQuery)}`
   };
 }

 // Analyze search results with AI
 async function analyzeResults(results, query, platform) {
   if (!API_CONFIG.LAMBDA_ENDPOINT) {
     return {
       mainPainPoint: "AI analysis not configured",
       contentOpportunities: ["Configure Lambda endpoint to get AI analysis"],
       trendingPhrases: ["configuration", "needed"],
       opportunityScore: 3,
       actionItems: "Set up your Lambda function endpoint to enable AI-powered pain point analysis."
     };
   }

   try {
     const response = await fetch(`${API_CONFIG.LAMBDA_ENDPOINT}`, {
       method: 'POST',
       headers: { 'Content-Type': 'application/json' },
       body: JSON.stringify({
         query,
         platform,
         results: results.slice(0, 10)
       })
     });

     if (!response.ok) {
       throw new Error(`AI analysis failed: ${response.status}`);
     }

     return await response.json();
   } catch (error) {
     console.error('AI analysis error:', error);
     return {
       mainPainPoint: "AI analysis temporarily unavailable",
       contentOpportunities: ["Manual analysis recommended"],
       trendingPhrases: ["analysis", "unavailable"],
       opportunityScore: 3,
       actionItems: "Check your Lambda function configuration and try again."
     };
   }
 }

 // Perform search and show results
 async function performSearch(query, site, searchTitle) {
   const resultsSection = $('#searchResults');
   const resultsContent = $('#resultsContent');
   const resultsTitle = $('.results-title');
   const searchInfo = $('#searchInfo');
   const aiAnalysis = $('#aiAnalysis');
   
   // Show loading
   resultsSection.classList.remove('hidden');
   searchInfo.classList.add('hidden');
   aiAnalysis.classList.add('hidden');
   resultsTitle.textContent = `Searching: ${searchTitle}`;
   resultsContent.innerHTML = `
     <div class="loading-spinner">
       <div class="spinner"></div>
       <p>🎯 Analyzing <span id="resultCounter">0</span> pain points found...</p>
       <div class="progress-bar-container">
         <div id="progressBar" class="progress-bar"></div>
       </div>
     </div>
   `;
   
   resultsSection.scrollIntoView({ behavior: 'smooth' });
   
   // Animate progress bar
   setTimeout(() => $('#progressBar').style.width = '30%', 200);
   
   try {
     // Get search results
     const searchData = await performGoogleSearch(query, site);
     currentSearchResults = searchData.results;
     
     // Update progress
     $('#progressBar').style.width = '60%';
     $('#resultCounter').textContent = searchData.results.length;
     
     // Show AI analysis first (before search results)
     if (searchData.results.length > 0) {
       aiAnalysis.classList.remove('hidden');
       $('#mainPainPoint').textContent = 'Analyzing...';
       $('#contentOpportunities').textContent = 'Analyzing...';
       $('#trendingPhrases').innerHTML = '';
       $('#opportunityScore').textContent = '-';
       $('#actionItems').textContent = 'Analyzing pain points...';
       
       // Update progress
       $('#progressBar').style.width = '80%';
       
       const analysis = await analyzeResults(searchData.results, query, site);
       currentAnalysis = analysis;
       displayAIAnalysis(analysis);
       
       // Complete progress
       $('#progressBar').style.width = '100%';
     }
     
     // Display search results after AI analysis
     displayResults(searchData, searchTitle, site);
     
   } catch (error) {
     displayError(error.message);
   }
 }

 // Display search results
 function displayResults(searchData, searchTitle, site) {
   const resultsContent = $('#resultsContent');
   const resultsTitle = $('.results-title');
   const searchInfo = $('#searchInfo');
   const { results, searchTime, totalResults, searchQuery, googleUrl } = searchData;
   
   resultsTitle.textContent = `Results: ${searchTitle}`;
   
   if (!results || results.length === 0) {
     resultsContent.innerHTML = `
       <div class="error-message">
         No results found for "${searchQuery}". Try different search terms or remove platform restrictions.
       </div>
     `;
     return;
   }
   
   let html = '';
   results.forEach((result, index) => {
     // Highlight pain point keywords in snippets
     let highlightedSnippet = result.snippet;
     const painWords = ['struggling', 'frustrated', 'problem', 'issue', 'difficult', 'hard', 'challenge', 'pain', 'annoying', 'broken', 'worst', 'hate', 'terrible', 'awful', 'sucks', 'confused', 'stuck', 'wish', 'need help', 'can\'t find'];
     painWords.forEach(word => {
       const regex = new RegExp(`\\b${word}\\b`, 'gi');
       highlightedSnippet = highlightedSnippet.replace(regex, `<mark style="background:#fef3cd; padding:1px 2px; border-radius:2px;">$&</mark>`);
     });
     
     html += `
       <div class="result-item">
         <div class="result-title">
  <a href="${result.url}" target="_blank" rel="noopener noreferrer">${result.title}</a>
</div>
         <div class="result-snippet">${highlightedSnippet}</div>
         <div class="result-meta">
           ${result.displayLink}
         </div>
       </div>
     `;
   });
   
   // Wrap in collapsible container
   html = html;
   
   resultsContent.innerHTML = html;
   
   // Show search info at bottom
   searchInfo.classList.remove('hidden');
   $('#searchQuery').textContent = searchQuery;
   $('#searchUrl').textContent = googleUrl;
   $('#searchTime').textContent = `${searchTime}s`;
   $('#resultCount').textContent = `${results.length} of ${parseInt(totalResults).toLocaleString()} total`;
   $('#platformInfo').textContent = site ? site : 'All platforms';
 }

 // Display AI analysis
 function displayAIAnalysis(analysis) {
   $('#mainPainPoint').textContent = analysis.mainPainPoint || 'Analysis complete';
   
   // Content opportunities
   if (analysis.contentOpportunities && analysis.contentOpportunities.length > 0) {
     $('#contentOpportunities').innerHTML = analysis.contentOpportunities
       .slice(0, 3)
       .map(opp => `<div style="margin-bottom:8px;">• ${opp}</div>`)
       .join('');
   }
   
   // Trending phrases
   if (analysis.trendingPhrases && analysis.trendingPhrases.length > 0) {
     $('#trendingPhrases').innerHTML = analysis.trendingPhrases
       .slice(0, 6)
       .map(phrase => `<span class="phrase-tag">${phrase}</span>`)
       .join('');
   }
   
   // Opportunity score
   const score = analysis.opportunityScore || 5;
   const scoreElement = $('#opportunityScore');
   scoreElement.textContent = `${score}/10`;
   scoreElement.className = 'opportunity-score';
   if (score >= 8) scoreElement.classList.add('score-high');
   else if (score >= 6) scoreElement.classList.add('score-medium');
   else scoreElement.classList.add('score-low');
   
   // Action items
   if (analysis.actionItems) {
     $('#actionItems').textContent = analysis.actionItems;
   }
 }

 // Display error
 function displayError(message) {
   const resultsContent = $('#resultsContent');
   const searchInfo = $('#searchInfo');
   const aiAnalysis = $('#aiAnalysis');
   searchInfo.classList.add('hidden');
   aiAnalysis.classList.add('hidden');
   resultsContent.innerHTML = `<div class="error-message">${message}</div>`;
 }

 // Hide results
 function hideResults() {
   $('#searchResults').classList.add('hidden');
 }

 // Build query + URL
 function buildQuery(){
   const src       = $('#src').value;
   const topic     = $('#topic').value.trim();
   const pain      = $('#pain').value;
   const customP   = $('#customPhrase').value.trim();
   const customS   = $('#customSite').value.trim();
   const exclude   = $('#exclude').value.trim();

   const map = {
     'reddit':              { platform:'reddit', site:'reddit.com' },
     'reddit-entrepreneur': { platform:'reddit', site:'reddit.com/r/Entrepreneur' },
     'linkedin':            { platform:'google', site:'linkedin.com' },
     'twitter':             { platform:'twitter', site:'twitter.com' },
     'hackernews':          { platform:'google', site:'news.ycombinator.com' },
     'quora':               { platform:'google', site:'quora.com' },
     'custom':              { platform:'google', site: customS }
   };
   const srcCfg = map[src] || map['reddit'];

   const t = topic || '';
   const templates = {
     'struggling': `"struggling with" ${t}`,
     'cantfind'  : t ? `"can't find good" ${t}` : `"can't find good"`,
     'wishknew'  : `"wish I knew" ${t}`,
     'needhelp'  : `"need help with" ${t}`,
     'frustrated': `"frustrated with" ${t}`,
     'tired'     : `"tired of" ${t}`,
     'confused'  : `"confused about" ${t}`,
     'wishsomeone': `"wish someone would make" ${t}`,
     'custom'    : customP ? (t ? `"${customP}" ${t}` : `"${customP}"`) : t
   };

   let q = (pain && templates[pain]) ? templates[pain] : t;

   if (exclude) {
     const excl = exclude.split(/[, ]+/).filter(Boolean).map(w => `-${w.replace(/^-/,'')}`).join(' ');
     q = (q ? q + ' ' : '') + excl;
   }
   q = (q || '').replace(/\s+/g,' ').trim();

   let url = '';
   const withSite = srcCfg.site ? ((q ? q + ' ' : '') + `site:${srcCfg.site}`) : q;
   const p = new URLSearchParams();
   p.set('q', withSite);
   url = 'https://www.google.com/search?' + p.toString();

   return { q: withSite, url, site: srcCfg.site };
 }

 function updatePreviews(){
   const { q, url } = buildQuery();
   $('#qPreview').textContent = q || '—';
   $('#urlPreview').textContent = url || '—';
 }

 // Wiring
 $('#src').addEventListener('change', () => {
   if ($('#src').value === 'custom') $('#customSiteWrap').style.display=''; else $('#customSiteWrap').style.display='none';
   updatePreviews();
 });
 $('#pain').addEventListener('change', () => {
   if ($('#pain').value === 'custom') $('#customPhraseWrap').style.display=''; else $('#customPhraseWrap').style.display='none';
   updatePreviews();
 });

 ['topic','customPhrase','customSite','exclude'].forEach(id => $('#'+id).addEventListener('input', updatePreviews));

 // Buttons
 $('#searchBtn').addEventListener('click', async () => {
   const { q, site } = buildQuery();
   if (!q) {
     alert('Please enter search criteria');
     return;
   }
   
   const title = $('#topic').value ? `${$('#pain option:checked').text || 'Search'} - ${$('#topic').value}` : ($('#pain option:checked').text || 'Custom Search');
   await performSearch(q.replace(/site:\S+\s*/, ''), site, title);
 });

 $('#openBtn').addEventListener('click', () => {
   const { url } = buildQuery();
   if (url) window.open(url, '_blank', 'noopener,noreferrer');
 });
 
 $('#copyBtn').addEventListener('click', async () => {
   const { url } = buildQuery();
   await copyToClipboard(url);
 });
 
 $('#resetBtn').addEventListener('click', () => {
   $('#src').value='reddit'; $('#topic').value=''; $('#pain').value='';
   $('#customPhrase').value=''; $('#customSite').value=''; $('#exclude').value='';
   $('#customPhraseWrap').style.display='none'; $('#customSiteWrap').style.display='none';
   updatePreviews();
   hideResults();
 });

 // Newsletter demo (replace with ESP)
 const nlForm = $('#nlForm'), nlThanks = $('#nlThanks');
 nlForm.addEventListener('submit', (e) => {
   e.preventDefault();
   nlForm.style.display='none'; nlThanks.style.display='';
 });

 // Make functions global for inline onclick handlers
 window.hideResults = hideResults;
 window.copyToClipboard = copyToClipboard;
 window.copyAnalysis = copyAnalysis;

 // Initialize
 loadConfig();
 updatePreviews();
</script>
</body>
</html>