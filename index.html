<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>GrumpyLinks â€” AI-Powered Pain Point Discovery</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="env-config.js"></script>
<style>
:root {
  /* Monochromatic Theme */
  --bg-primary: #0f0f10;
  --bg-secondary: #1a1a1c;
  --bg-tertiary: #232326;
  --bg-card: #1e1e20;
  --bg-card-hover: #252527;
  --bg-input: #1a1a1c;
  --bg-button: #2563eb;
  --bg-button-hover: #1d4ed8;
  --bg-success: #22c55e;
  --bg-warning: #f59e0b;
  --bg-danger: #ef4444;
  
  /* Text Colors */
  --text-primary: #ffffff;
  --text-secondary: #94a3b8;
  --text-muted: #64748b;
  --text-accent: #3b82f6;
  
  /* Border Colors */
  --border-primary: #2a2a2e;
  --border-secondary: #3a3a3e;
  --border-accent: #3b82f6;
  
  /* Shadows */
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.5);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.6);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.7);
  
  /* Platform Colors */
  --reddit: #ff4500;
  --twitter: #1da1f2;
  --linkedin: #0077b5;
  --hackernews: #ff6600;
  --github: #ffffff;
  --stackoverflow: #f48024;
  --medium: #ffffff;
  --quora: #b92b27;
  --youtube: #ff0000;
  --producthunt: #da552f;
  --discord: #5865f2;
  --glassdoor: #0caa41;
  --trustpilot: #00b67a;
  --appstore: #007aff;
  --tiktok: #ffffff;
}

* { 
  box-sizing: border-box; 
  margin: 0;
  padding: 0;
}

html, body { 
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  line-height: 1.5;
  font-size: 14px;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Layout */
.app { 
  display: flex;
  min-height: 100vh;
  background: var(--bg-primary);
}

/* Sidebar */
.sidebar {
  width: 320px;
  background: var(--bg-secondary);
  border-right: 1px solid var(--border-primary);
  padding: 24px;
  overflow-y: auto;
  flex-shrink: 0;
}

.logo {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-decoration: none;
  color: var(--text-primary);
  font-weight: 800;
  font-size: 20px;
  letter-spacing: -0.025em;
  margin-bottom: 24px;
  padding: 16px 0;
  border-bottom: 1px solid var(--border-primary);
  text-align: center;
}

.logo-emoji {
  font-size: 40px;
  line-height: 1;
  margin-bottom: 8px;
}

.logo-text {
  font-size: 20px;
  font-weight: 800;
  color: var(--text-primary);
}

.hero-content-sidebar {
  margin-bottom: 24px;
  padding: 16px;
  background: var(--bg-tertiary);
  border-radius: 8px;
  border: 1px solid var(--border-primary);
}

.hero-title-sidebar {
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 8px;
  letter-spacing: -0.025em;
  line-height: 1.3;
  color: var(--text-primary);
}

.hero-subtitle-sidebar {
  font-size: 13px;
  color: var(--text-secondary);
  font-weight: 400;
  line-height: 1.4;
  margin: 0;
}

.search-section {
  margin-bottom: 24px;
}

.section-title {
  font-size: 11px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 12px;
}

.search-input {
  width: 100%;
  padding: 12px 16px;
  background: var(--bg-input);
  border: 1px solid var(--border-primary);
  border-radius: 6px;
  color: var(--text-primary);
  font-size: 14px;
  font-weight: 500;
  transition: border-color 0.2s ease;
  font-family: inherit;
  margin-bottom: 12px;
}

.search-input:focus {
  outline: none;
  border-color: var(--border-accent);
}

.search-input::placeholder {
  color: var(--text-muted);
}

.select-input {
  width: 100%;
  padding: 10px 16px;
  background: var(--bg-input);
  border: 1px solid var(--border-primary);
  border-radius: 6px;
  color: var(--text-primary);
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: border-color 0.2s ease;
  font-family: inherit;
  margin-bottom: 8px;
}

.select-input:focus {
  outline: none;
  border-color: var(--border-accent);
}

.search-button {
  width: 100%;
  background: var(--bg-button);
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.2s ease;
  font-family: inherit;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.search-button:hover {
  background: var(--bg-button-hover);
}

/* Main Content */
.main-content {
  flex: 1;
  padding: 32px;
  overflow-y: auto;
  background: var(--bg-primary);
}

.results-header {
  margin-bottom: 32px;
  text-align: left;
}

.results-title {
  font-size: 32px;
  font-weight: 800;
  margin-bottom: 8px;
  letter-spacing: -0.025em;
  color: var(--text-primary);
}

.results-subtitle {
  color: var(--text-secondary);
  font-size: 16px;
  font-weight: 400;
}

.results-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr); /* Force 3 columns */
  gap: 20px;
  margin-bottom: 40px;
  max-width: 1400px;
}

/* Result Cards */
.result-card {
  background: var(--bg-card);
  border: 1px solid var(--border-primary);
  border-radius: 8px;
  padding: 20px;
  transition: all 0.2s ease;
  position: relative;
  overflow: hidden;
}

.result-card:hover {
  background: var(--bg-card-hover);
  border-color: var(--border-secondary);
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

.card-header {
  margin-bottom: 16px;
}

.result-title {
  font-size: 15px;
  font-weight: 600;
  line-height: 1.4;
  margin-bottom: 10px;
  color: var(--text-primary);
}

.result-title a {
  color: inherit;
  text-decoration: none;
  transition: color 0.2s ease;
}

.result-title a:hover {
  color: var(--text-accent);
}

.source-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: white;
}

.source-reddit { background: var(--reddit); }
.source-twitter { background: var(--twitter); }
.source-linkedin { background: var(--linkedin); }
.source-hackernews { background: var(--hackernews); }
.source-github { background: var(--github); color: var(--bg-primary); }
.source-stackoverflow { background: var(--stackoverflow); }
.source-medium { background: var(--medium); color: var(--bg-primary); }
.source-quora { background: var(--quora); }
.source-youtube { background: var(--youtube); }
.source-producthunt { background: var(--producthunt); }
.source-discord { background: var(--discord); }
.source-glassdoor { background: var(--glassdoor); }
.source-trustpilot { background: var(--trustpilot); }
.source-appstore { background: var(--appstore); }
.source-tiktok { background: var(--tiktok); color: var(--bg-primary); }
.source-default { background: var(--text-muted); }

.result-snippet {
  color: var(--text-secondary);
  font-size: 14px;
  line-height: 1.5;
  margin-bottom: 16px;
}

.result-snippet mark {
  background: rgba(59, 130, 246, 0.2);
  color: var(--text-accent);
  padding: 2px 4px;
  border-radius: 3px;
  font-weight: 500;
}

/* AI Insight */
.ai-insight {
  background: var(--bg-tertiary);
  border: 1px solid var(--border-primary);
  border-radius: 6px;
  padding: 16px;
  margin-bottom: 16px;
}

.ai-insight-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.ai-insight-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--text-accent);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.urgency-badge {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.urgency-high { 
  background: var(--bg-danger);
  color: white;
}

.urgency-medium { 
  background: var(--bg-warning);
  color: white;
}

.urgency-low { 
  background: var(--bg-success);
  color: white;
}

.ai-insight-text {
  color: var(--text-primary);
  font-size: 14px;
  line-height: 1.5;
  font-weight: 400;
}

.card-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 16px;
  border-top: 1px solid var(--border-primary);
  font-size: 12px;
  color: var(--text-muted);
}

.copy-link, .copy-opportunity-btn, .generate-prd-prompt-btn {
  color: var(--text-accent);
  cursor: pointer;
  font-weight: 500;
  padding: 6px 12px;
  border-radius: 4px;
  transition: all 0.2s ease;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border: 1px solid var(--border-primary);
  background: none; /* Make buttons match link style */
  font-family: inherit;
  margin-left: 8px; /* Spacing between buttons */
}

.copy-link:hover, .copy-opportunity-btn:hover, .generate-prd-prompt-btn:hover {
  background: var(--text-accent);
  color: white;
  border-color: var(--text-accent);
}

/* Footer */
.footer {
  border-top: 1px solid var(--border-primary);
  padding: 60px 32px 32px;
  margin-top: 60px;
}

.footer-content {
  max-width: 800px;
  margin: 0 auto;
}

.footer-hero {
  text-align: center;
  margin-bottom: 40px;
}

.footer-hero h2 {
  font-size: 28px;
  font-weight: 800;
  margin-bottom: 12px;
  letter-spacing: -0.025em;
  color: var(--text-primary);
}

.footer-hero p {
  font-size: 16px;
  color: var(--text-secondary);
  max-width: 500px;
  margin: 0 auto;
  line-height: 1.6;
}

.faqs-section {
  margin-bottom: 40px;
}

.faqs-title {
  font-size: 20px;
  font-weight: 700;
  text-align: center;
  margin-bottom: 24px;
  color: var(--text-primary);
}

.faq-item {
  background: var(--bg-card);
  border: 1px solid var(--border-primary);
  border-radius: 8px;
  margin-bottom: 12px;
  overflow: hidden;
  transition: all 0.2s ease;
}

.faq-item:hover {
  border-color: var(--border-secondary);
}

.faq-question {
  width: 100%;
  background: none;
  border: none;
  padding: 16px 20px;
  text-align: left;
  color: var(--text-primary);
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.2s ease;
  font-family: inherit;
}

.faq-question:hover {
  background: var(--bg-card-hover);
}

.faq-arrow {
  transition: transform 0.3s ease;
  color: var(--text-muted);
  font-size: 12px;
}

.faq-question.active .faq-arrow {
  transform: rotate(180deg);
  color: var(--text-accent);
}

.faq-answer {
  max-height: 0;
  overflow: hidden;
  transition: all 0.3s ease;
  background: var(--bg-tertiary);
}

.faq-answer.active {
  max-height: 150px;
  padding: 16px 20px;
}

.faq-answer p {
  color: var(--text-secondary);
  font-size: 13px;
  line-height: 1.5;
  margin: 0;
}

.footer-bottom {
  text-align: center;
  padding-top: 24px;
  border-top: 1px solid var(--border-primary);
}

.footer-bottom p {
  color: var(--text-muted);
  font-size: 12px;
  margin: 0;
}

/* Loading States */
.loading-container {
  grid-column: 1 / -1;
  text-align: center;
  padding: 60px 20px;
}

.loading-spinner {
  display: inline-block;
  width: 32px;
  height: 32px;
  border: 2px solid var(--border-primary);
  border-top: 2px solid var(--text-accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 16px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loading-text {
  color: var(--text-secondary);
  font-size: 14px;
  font-weight: 400;
}

.empty-state {
  grid-column: 1 / -1;
  text-align: center;
  padding: 60px 20px;
}

.empty-state h3 {
  color: var(--text-primary);
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 8px;
}

.empty-state p {
  color: var(--text-secondary);
  font-size: 14px;
}

@media (max-width: 1600px) {
  .results-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}
@media (max-width: 1200px) {
  .results-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}
@media (max-width: 1024px) {
  .app {
    flex-direction: column;
  }
  
  .sidebar {
    width: 100%;
    padding: 20px;
    border-right: none;
    border-bottom: 1px solid var(--border-primary);
  }
  
  .main-content {
    padding: 20px;
  }
  
  .results-grid {
    grid-template-columns: 1fr;
    gap: 16px;
  }
  
  .results-title {
    font-size: 24px;
  }
  
  .results-subtitle {
    font-size: 14px;
  }
}
@media (max-width: 800px) {
  .results-grid {
    grid-template-columns: 1fr;
  }
}
@media (max-width: 768px) {
  .sidebar {
    padding: 16px;
  }
  
  .main-content {
    padding: 16px;
  }
   .results-grid {
    grid-template-columns: 1fr; /* 1 column on mobile */
  }
  .result-card {
    padding: 16px;
  }
  
  .search-input,
  .select-input {
    font-size: 16px;
  }
  
  .footer {
    padding: 40px 16px 24px;
  }
}

/* Download Section Styles */
.download-container {
  margin-top: 40px;
  display: none;
}

.download-section {
  background: var(--bg-card);
  border: 1px solid var(--border-primary);
  border-radius: 12px;
  padding: 32px;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.download-section::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--text-accent) 0%, #60a5fa 100%);
}

.download-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 8px;
  font-family: 'Inter', sans-serif;
}

.download-subtitle {
  color: var(--text-secondary);
  font-size: 14px;
  margin-bottom: 24px;
  font-weight: 400;
}

.download-btn {
  background: linear-gradient(135deg, var(--bg-success) 0%, #16a34a 100%);
  color: white;
  border: none;
  padding: 16px 32px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  font-family: 'Inter', sans-serif;
  box-shadow: 0 4px 16px rgba(34, 197, 94, 0.2);
  text-transform: none;
  letter-spacing: 0;
}

.download-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(34, 197, 94, 0.3);
  background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
}

.download-btn:active {
  transform: translateY(0);
}

@media (max-width: 768px) {
  .download-section {
    padding: 24px 20px;
  }
  
  .download-btn {
    padding: 14px 28px;
    font-size: 13px;
  }
}
/* Professional PRD Styles - GitHub/Reference Doc Style */
.prd-container {
  margin-top: 40px;
  padding: 0;
  background: var(--bg-card);
  border: 1px solid var(--border-primary);
  border-radius: 12px;
  display: none;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
  overflow: hidden;
}

.prd-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0;
  padding: 32px 40px;
  border-bottom: 1px solid var(--border-primary);
  background: var(--bg-secondary);
}

.prd-title {
  font-size: 28px;
  font-weight: 700;
  color: var(--text-primary);
  margin: 0;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  letter-spacing: -0.02em;
}

.prd-actions {
  display: flex;
  gap: 12px;
}

.prd-action-btn {
  padding: 10px 18px;
  background: var(--bg-button);
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  font-family: 'Inter', sans-serif;
}

.prd-action-btn:hover {
  background: var(--bg-button-hover);
  transform: translateY(-1px);
}

.prd-action-btn.secondary {
  background: var(--bg-tertiary);
  border: 1px solid var(--border-secondary);
  color: var(--text-primary);
}

.prd-action-btn.secondary:hover {
  background: var(--bg-card-hover);
  border-color: var(--border-accent);
}

.prd-content {
  color: var(--text-primary);
  line-height: 1.6;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  padding: 40px;
  font-size: 15px;
  max-width: none;
}

/* Professional Typography */
.prd-content h1 {
  font-size: 32px;
  font-weight: 700;
  color: var(--text-primary);
  margin: 40px 0 24px 0;
  letter-spacing: -0.025em;
  line-height: 1.25;
  padding-bottom: 8px;
  border-bottom: 2px solid var(--border-primary);
}

.prd-content h1:first-child {
  margin-top: 0;
}

.prd-content h2 {
  font-size: 24px;
  font-weight: 600;
  color: var(--text-primary);
  margin: 32px 0 16px 0;
  letter-spacing: -0.02em;
  line-height: 1.3;
}

.prd-content h3 {
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
  margin: 24px 0 12px 0;
  letter-spacing: -0.01em;
  line-height: 1.4;
}

/* Clean Professional Lists */
.prd-content ul, .prd-content ol {
  margin: 20px 0;
  padding-left: 24px;
}

.prd-content li {
  margin-bottom: 12px;
  line-height: 1.6;
  color: var(--text-primary);
}

.prd-content ul li {
  list-style-type: disc;
  list-style-position: outside;
}

.prd-content ol li {
  list-style-type: decimal;
  list-style-position: outside;
}

/* Nested lists */
.prd-content li ul,
.prd-content li ol {
  margin: 8px 0;
  padding-left: 20px;
}

.prd-content li ul li {
  list-style-type: circle;
  margin-bottom: 6px;
}

/* Professional Emphasis */
.prd-content strong {
  color: var(--text-primary);
  font-weight: 600;
}

.prd-content em {
  color: var(--text-secondary);
  font-style: italic;
  font-weight: 400;
}

/* Clean Paragraphs */
.prd-content p {
  margin: 16px 0;
  line-height: 1.6;
  color: var(--text-primary);
}

/* Code and Technical Elements */
.prd-content code {
  background: var(--bg-tertiary);
  padding: 2px 6px;
  border-radius: 3px;
  font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
  font-size: 13px;
  color: var(--text-accent);
}

.prd-content pre {
  background: var(--bg-tertiary);
  padding: 16px;
  border-radius: 6px;
  overflow-x: auto;
  font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
  font-size: 13px;
  line-height: 1.4;
  margin: 20px 0;
}

/* Tables (if any) */
.prd-content table {
  width: 100%;
  border-collapse: collapse;
  margin: 24px 0;
  font-size: 14px;
}

.prd-content th,
.prd-content td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid var(--border-primary);
}

.prd-content th {
  font-weight: 600;
  color: var(--text-primary);
  background: var(--bg-tertiary);
}

/* Blockquotes */
.prd-content blockquote {
  margin: 20px 0;
  padding: 16px 20px;
  background: var(--bg-tertiary);
  border-left: 4px solid var(--text-accent);
  border-radius: 0 6px 6px 0;
}

.prd-content blockquote p {
  margin: 0;
  font-style: italic;
  color: var(--text-secondary);
}

/* Loading States */
.prd-loading {
  text-align: center;
  padding: 60px 40px;
  background: var(--bg-card);
}

.prd-loading-spinner {
  display: inline-block;
  width: 24px;
  height: 24px;
  border: 2px solid var(--border-primary);
  border-top: 2px solid var(--text-accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 20px;
}

.prd-loading-text {
  color: var(--text-primary);
  font-size: 16px;
  font-weight: 500;
  margin-bottom: 8px;
  font-family: 'Inter', sans-serif;
}

.prd-loading-text strong {
  color: var(--text-accent);
  font-weight: 600;
}

.prd-progress {
  margin-top: 20px;
  max-width: 300px;
  margin-left: auto;
  margin-right: auto;
}

.prd-progress-bar {
  width: 100%;
  height: 3px;
  background: var(--bg-tertiary);
  border-radius: 2px;
  overflow: hidden;
}

.prd-progress-fill {
  height: 100%;
  background: var(--text-accent);
  border-radius: 2px;
  transition: width 0.3s ease;
  width: 0%;
}

.prd-source-info {
  background: var(--bg-tertiary);
  padding: 16px 20px;
  border-radius: 6px;
  margin-bottom: 32px;
  font-size: 14px;
  color: var(--text-secondary);
  border: 1px solid var(--border-primary);
}

.prd-source-title {
  font-weight: 600;
  color: var(--text-primary);
  font-size: 15px;
  margin-bottom: 6px;
}

/* Responsive Design */
@media (max-width: 768px) {
  .prd-container {
    margin: 20px 0;
    border-radius: 8px;
  }
  
  .prd-header {
    flex-direction: column;
    gap: 16px;
    align-items: stretch;
    padding: 24px 20px;
  }
  
  .prd-title {
    font-size: 22px;
    text-align: center;
  }
  
  .prd-actions {
    justify-content: center;
    flex-wrap: wrap;
  }
  
  .prd-content {
    padding: 24px 20px;
    font-size: 14px;
  }
  
  .prd-content h1 {
    font-size: 26px;
  }
  
  .prd-content h2 {
    font-size: 20px;
  }
  
  .prd-content h3 {
    font-size: 16px;
  }
}

/* Smooth Animations */
.prd-container {
  animation: fadeInUp 0.4s ease-out;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>
</head>
<body>

<div class="app">
  <aside class="sidebar">
    <a href="#" class="logo">
      <span class="logo-emoji">ðŸ˜ </span>
      <span class="logo-text">GrumpyLinks</span>
    </a>

    <div class="hero-content-sidebar">
      <h1 class="hero-title-sidebar">Turn Complaints Into Ideas</h1>
      <p class="hero-subtitle-sidebar">AI-powered pain point discovery across 12+ platforms</p>
    </div>

    <div class="search-section">
      <div class="section-title">FIND GRUMPY CUSTOMERS</div>
      <input id="searchInput" class="search-input" type="text" 
             placeholder="Brand, product, or topic..." />
      <select id="queryDropdown" class="select-input">
        <option value="">General Pain Points</option>
        <option value="competitor_hate">Competitor Complaints</option>
        <option value="switching_signals">Switching Signals</option>
        <option value="wish_list">Unmet Needs</option>
        <option value="feature_requests">Feature Requests</option>
        <option value="urgent_help">Urgent Problems</option>
      </select>
      <select id="platformSelect" class="select-input">
        <option value="all">All Platforms</option>
        <option value="reddit">Reddit</option>
        <option value="twitter">Twitter</option>
        <option value="linkedin">LinkedIn</option>
        <option value="hackernews">Hacker News</option>
        <option value="youtube">YouTube</option>
        <option value="medium">Medium</option>
        <option value="producthunt">Product Hunt</option>
        <option value="discord">Discord</option>
        <option value="glassdoor">Glassdoor</option>
        <option value="trustpilot">Trustpilot</option>
        <option value="appstore">App Stores</option>
        <option value="forums">Forums</option>
      </select>
      <select id="timeSelect" class="select-input">
        <option value="d7">Last 7 days</option>
        <option value="d1">Last 24 hours</option>
        <option value="d30">Last 30 days</option>
        <option value="d365">Last year</option>
      </select>
      <button id="searchBtn" class="search-button">Search</button>
    </div>
  </aside>

  <main class="main-content">
    <div class="results-header" id="resultsHeader" style="display: none;">
      <h2 class="results-title">Pain Points Found</h2>
      <p class="results-subtitle">AI-analyzed customer complaints with business opportunities</p>
    </div>

    <div id="resultsGrid" class="results-grid">
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading demo search results...</p>
      </div>
    </div>

  <footer class="footer">
    <div class="footer-content">
      <div class="footer-hero">
        <h2>Discover Hidden Opportunities</h2>
        <p>Join thousands of entrepreneurs who use GrumpyLinks to find their next business idea in customer complaints and pain points.</p>
      </div>

      <div class="faqs-section">
        <h3 class="faqs-title">Frequently Asked Questions</h3>
        
        <div class="faq-item">
          <button class="faq-question" onclick="toggleFAQ(this)">
            How does GrumpyLinks find business opportunities?
            <span class="faq-arrow">â–¼</span>
          </button>
          <div class="faq-answer">
            <p>We search across Reddit, Twitter, YouTube, and 9+ other platforms for customer complaints, then use AI to analyze each pain point and suggest specific business opportunities you could build or create.</p>
          </div>
        </div>

        <div class="faq-item">
          <button class="faq-question" onclick="toggleFAQ(this)">
            What platforms do you search?
            <span class="faq-arrow">â–¼</span>
          </button>
          <div class="faq-answer">
            <p>We search Reddit, Twitter, LinkedIn, Hacker News, YouTube, Medium, Product Hunt, Discord, Glassdoor, Trustpilot, App Stores, and major forums like Stack Overflow and Quora.</p>
          </div>
        </div>

        <div class="faq-item">
          <button class="faq-question" onclick="toggleFAQ(this)">
            Is this different from regular Google search?
            <span class="faq-arrow">â–¼</span>
          </button>
          <div class="faq-answer">
            <p>Yes! We specifically search for complaints and frustrations, then analyze each one with AI to suggest business opportunities. Regular search won't give you actionable business insights from customer pain points.</p>
          </div>
        </div>

        <div class="faq-item">
          <button class="faq-question" onclick="toggleFAQ(this)">
            How accurate are the AI business suggestions?
            <span class="faq-arrow">â–¼</span>
          </button>
          <div class="faq-answer">
            <p>Our AI analyzes each complaint and suggests specific, actionable business opportunities. While not every suggestion will be viable, they provide concrete starting points for market research and idea validation.</p>
          </div>
        </div>

        <div class="faq-item">
          <button class="faq-question" onclick="toggleFAQ(this)">
            Can I export or save the results?
            <span class="faq-arrow">â–¼</span>
          </button>
          <div class="faq-answer">
            <p>You can copy individual links from each result card. For bulk export and advanced features, subscribe to our Daily Grumpy newsletter to get curated pain points delivered to your inbox.</p>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p>Â© 2025 GrumpyLinks. Find your next business opportunity in customer complaints.</p>
      </div>
    </div>
  </footer>
  </main>
</div>

<script>
// Configuration
var API_CONFIG = {
  GOOGLE_API_KEY: '',
  SEARCH_ENGINE_ID: '',
  LAMBDA_ENDPOINT: ''
};

function loadConfig() {
  if (window.ENV) {
    API_CONFIG.GOOGLE_API_KEY = window.ENV.GOOGLE_API_KEY || '';
    API_CONFIG.SEARCH_ENGINE_ID = window.ENV.SEARCH_ENGINE_ID || '';
    API_CONFIG.LAMBDA_ENDPOINT = window.ENV.LAMBDA_ENDPOINT || '';
  }
}

// FAQ Toggle Function
function toggleFAQ(element) {
  var answer = element.nextElementSibling;
  var isActive = element.classList.contains('active');
  
  // Close all FAQs first
  var allQuestions = document.querySelectorAll('.faq-question');
  for (var i = 0; i < allQuestions.length; i++) {
    allQuestions[i].classList.remove('active');
    allQuestions[i].nextElementSibling.classList.remove('active');
  }
  
  // If this wasn't active, open it
  if (!isActive) {
    element.classList.add('active');
    answer.classList.add('active');
  }
}

// Power Queries
var POWER_QUERIES = {
  'competitor_hate': {
    id: 'competitor_hate',
    title: 'Competitor Complaints',
    template: '("hate" OR "frustrated with" OR "terrible") {{keyword}}'
  },
  'switching_signals': {
    id: 'switching_signals',
    title: 'Switching Signals',
    template: '("switching from" OR "alternative to" OR "quitting" OR "leaving") {{keyword}}'
  },
  'wish_list': {
    id: 'wish_list',
    title: 'Unmet Needs',
    template: '"I wish there was" OR "someone should" {{keyword}}'
  },
  'feature_requests': {
    id: 'feature_requests',
    title: 'Feature Requests',
    template: '("should add" OR "missing feature" OR "needs to support") {{keyword}}'
  },
  'urgent_help': {
    id: 'urgent_help',
    title: 'Urgent Problems',
    template: '("need help with" OR "urgent" OR "stuck with") {{keyword}}'
  }
};

var PLATFORMS = {
  all: { sites: [] },
  reddit: { sites: ['site:reddit.com'] },
  twitter: { sites: ['site:twitter.com', 'site:x.com'] },
  linkedin: { sites: ['site:linkedin.com'] },
  hackernews: { sites: ['site:news.ycombinator.com'] },
  youtube: { sites: ['site:youtube.com'] },
  medium: { sites: ['site:medium.com'] },
  producthunt: { sites: ['site:producthunt.com'] },
  discord: { sites: ['site:discord.com'] },
  glassdoor: { sites: ['site:glassdoor.com'] },
  trustpilot: { sites: ['site:trustpilot.com'] },
  appstore: { sites: ['site:apps.apple.com', 'site:play.google.com'] },
  forums: { sites: ['site:stackoverflow.com', 'site:quora.com'] }
};

var currentAnalysis = null;
var currentSearchResults = []; // Global variable to store processed search results

// Demo Results Data
var DEMO_RESULTS = {
  query: "",
  results: [
    {
      title: "Zach (Probably) on X: \"This is actually painful, #ChatGPT works well ...\"",
      snippet: "This is actually painful, #ChatGPT works well on airplane wifi more or less... #Grok... Sucks. Like holy fuck does it SUCK on whatever insane networking is ...",
      link: "https://x.com/ThatOtherZach/status/1956024889560760322",
      displayLink: "x.com",
      insight: {
        businessOpportunity: "Develop an AI model optimized for low-bandwidth airplane wifi that offers a competitive advantage over existing AI assistants like Grok. Market it directly to travelers.",
        urgency: "medium"
      }
    },
    {
      title: "Why Wont Snapchat Work on Breeze Airplane Wifi | TikTok",
      snippet: "... broken Â· original sound - The office quote.s Â· Why Wont My Snap Chat Let Me ... Snapchat Is So Annoying Â· Why Is Snapchat Not Sending My Snaps. 364Likes. 203 ...",
      link: "https://www.tiktok.com/discover/why-wont-snapchat-work-on-breeze-airplane-wifi",
      displayLink: "www.tiktok.com",
      insight: {
        businessOpportunity: "Create a mobile app troubleshooting guide specifically for Snapchat and other popular apps on Breeze Airways wifi, offering solutions and workarounds.",
        urgency: "medium"
      }
	  },
   {
     title: "iOS - NextDNS Help Center",
     snippet: "Public WiFis / Airplane WiFi / Hotel WiFis / Captive Portal WiFis. Couldn't ... Wrongly 'seemingly' blocked from NextDNS and need help here.. also for ...",
     link: "https://help.nextdns.io/tag/ios",
     displayLink: "help.nextdns.io",
     insight: {
       businessOpportunity: "Offer a VPN service optimized to bypass captive portals and improve connectivity on public and airplane wifi networks, specifically for iOS devices.",
       urgency: "high"
     }
   },
   {
     title: "How to Connect Laptop to Airplane Wifi | TikTok",
     snippet: "... Airplane Wifi Spirit, How to Fix Unable to Connect to Wifi Hp Laptop ... How to Connect Phone to Pc with Broken Screen Â· Cara Guna Usb Wifi Adapter.",
     link: "https://www.tiktok.com/discover/how-to-connect-laptop-to-airplane-wifi",
     displayLink: "www.tiktok.com",
     insight: {
       businessOpportunity: "Develop a simplified step-by-step video tutorial series on connecting different laptop brands to airplane wifi, monetized through ads or premium content.",
       urgency: "low"
     }
   },
   {
     title: "Reclining your seat on a flight. I didn't know it was so taboo ...",
     snippet: "airplane wifi is ass so I used my Nintendo Switch) But for longer flights ... What do you need help on? Cancel X. Post New Message. You're browsing the ...",
     link: "https://gamefaqs.gamespot.com/boards/264562-playstation-5/81025624",
     displayLink: "gamefaqs.gamespot.com",
     insight: {
       businessOpportunity: "Develop a curated entertainment package (movies, games, ebooks) that can be downloaded before the flight and enjoyed without relying on airplane wifi.",
       urgency: "low"
     }
   },
   {
     title: "Starlink MCI to IAH : r/unitedairlines",
     snippet: "... airplane WiFI. Upvote 2. Downvote Reply reply. Award ... I hate this about United Â· r/unitedairlines - I hate this about United. 2. 25 ...",
     link: "https://www.reddit.com/r/unitedairlines/comments/1mqcce2/starlink_mci_to_iah/",
     displayLink: "www.reddit.com",
     insight: {
       businessOpportunity: "Create a real-time airplane wifi speed test and review platform where users can rate and compare the performance of different airlines' wifi services. Offer premium data insights to airlines.",
       urgency: "medium"
     }
   }
 ]
};

// Initialize
function init() {
 loadConfig();
 setupEventListeners();
 loadDemoSearch();
}

function setupEventListeners() {
 document.getElementById('searchBtn').onclick = performSearch;
 document.getElementById('searchInput').onkeydown = function(e) {
   if (e.key === 'Enter') performSearch();
 };
 document.getElementById('searchInput').oninput = function(e) {
   localStorage.setItem('grumpy_search', e.target.value);
 };
}

function loadDemoSearch() {
 document.getElementById('searchInput').value = DEMO_RESULTS.query;
 // Demo results already have insights embedded, so we can pass them directly
 displayResults(DEMO_RESULTS.results, null, DEMO_RESULTS.query, null);
}

function buildSearchQuery(template, keyword, platform) {
 var query = template.replace(/\{\{keyword\}\}/g, '"' + keyword + '"');

 var platformConfig = PLATFORMS[platform] || PLATFORMS.all;
 if (platformConfig.sites.length > 0) {
   query += ' (' + platformConfig.sites.join(' OR ') + ')';
 }

 return query;
}

function buildNormalSearchQuery(keyword, platform) {
 var query = '("frustrated" OR "hate" OR "terrible" OR "broken" OR "annoying" OR "wish there was" OR "need help" OR "problem with" OR "doesn' + "'" + 't work" OR "awful" OR "sucks") "' + keyword + '"';

 var platformConfig = PLATFORMS[platform] || PLATFORMS.all;
 if (platformConfig.sites.length > 0) {
   query += ' (' + platformConfig.sites.join(' OR ') + ')';
 }

 return query;
}

function getPlatformClass(domain) {
 if (domain.includes('reddit')) return 'source-reddit';
 if (domain.includes('twitter') || domain.includes('x.com')) return 'source-twitter';
 if (domain.includes('linkedin')) return 'source-linkedin';
 if (domain.includes('news.ycombinator')) return 'source-hackernews';
 if (domain.includes('github')) return 'source-github';
 if (domain.includes('stackoverflow')) return 'source-stackoverflow';
 if (domain.includes('medium')) return 'source-medium';
 if (domain.includes('quora')) return 'source-quora';
 if (domain.includes('youtube')) return 'source-youtube';
 if (domain.includes('producthunt')) return 'source-producthunt';
 if (domain.includes('discord')) return 'source-discord';
 if (domain.includes('glassdoor')) return 'source-glassdoor';
 if (domain.includes('trustpilot')) return 'source-trustpilot';
 if (domain.includes('tiktok')) return 'source-tiktok';
 if (domain.includes('apps.apple.com')) return 'source-appstore';
 if (domain.includes('play.google.com')) return 'source-playstore';
 return 'source-default';
}

function getPlatformName(domain) {
 if (domain.includes('reddit')) return 'Reddit';
 if (domain.includes('twitter') || domain.includes('x.com')) return 'Twitter';
 if (domain.includes('linkedin')) return 'LinkedIn';
 if (domain.includes('news.ycombinator')) return 'Hacker News';
 if (domain.includes('github')) return 'GitHub';
 if (domain.includes('stackoverflow')) return 'Stack Overflow';
 if (domain.includes('medium')) return 'Medium';
 if (domain.includes('quora')) return 'Quora';
 if (domain.includes('youtube')) return 'YouTube';
 if (domain.includes('producthunt')) return 'Product Hunt';
 if (domain.includes('discord')) return 'Discord';
 if (domain.includes('glassdoor')) return 'Glassdoor';
 if (domain.includes('trustpilot')) return 'Trustpilot';
 if (domain.includes('tiktok')) return 'TikTok';
 if (domain.includes('apps.apple.com')) return 'App Store';
 if (domain.includes('play.google.com')) return 'Play Store';
 return domain.split('.')[0];
}

function findInsightForResult(result, analysis) {
 if (!analysis || !analysis.resultInsights) {
   return {
     businessOpportunity: "AI analysis not available for this result",
     urgency: "low"
   };
 }

 // For demo data or cases where insights are already matched to results by index
 if (analysis.resultInsights.length > 0 && !analysis.resultInsights[0].title) {
   // Find by index - this works for demo data where insights array matches results array
   var resultIndex = analysis.resultInsights.findIndex(function(insight, index) {
     // Simple index-based matching for demo data
     return index < analysis.resultInsights.length;
   });
   
   if (resultIndex >= 0 && analysis.resultInsights[resultIndex]) {
     return analysis.resultInsights[resultIndex];
   }
 }

 // Improved matching logic: Try to find a direct match first (for real API data)
 var directMatch = analysis.resultInsights.find(function(insight) {
   return insight.title && insight.title === result.title;
 });
 if (directMatch) {
   return directMatch;
 }

 // Fallback to partial matching if direct match not found (for real API data)
 if (result.title) {
   var resultTitleWords = result.title.toLowerCase().split(' ').slice(0, 5).join(' ');
   var matchingInsight = analysis.resultInsights.find(function(insight) {
     if (!insight.title) return false;
     var insightTitleWords = insight.title.toLowerCase().split(' ').slice(0, 5).join(' ');
     return resultTitleWords.includes(insightTitleWords.slice(0, 20)) || 
            insightTitleWords.includes(resultTitleWords.slice(0, 20));
   });

   if (matchingInsight) {
     return matchingInsight;
   }
 }

 // As a last resort, return the first insight if available, or a default
 return analysis.resultInsights[0] || {
   businessOpportunity: "Monitor this result for business opportunities",
   urgency: "medium"
 };
}

function performGoogleSearch(query, timeRange) {
 if (!API_CONFIG.GOOGLE_API_KEY || !API_CONFIG.SEARCH_ENGINE_ID) {
   throw new Error('Google API not configured');
 }

 var params = new URLSearchParams({
   key: API_CONFIG.GOOGLE_API_KEY,
   cx: API_CONFIG.SEARCH_ENGINE_ID,
   q: query,
   num: '9', 
   dateRestrict: timeRange
 });

 return fetch('https://www.googleapis.com/customsearch/v1?' + params.toString())
   .then(function(response) {
     if (!response.ok) {
       return response.json().then(function(error) {
         throw new Error(error.error?.message || 'Search failed');
       });
     }
     return response.json();
   })
   .then(function(data) {
     return data.items || [];
   });
}

// In analyzeWithAI function - change to 10:
function analyzeWithAI(results, query, platform) {
 if (!API_CONFIG.LAMBDA_ENDPOINT) {
   return Promise.resolve({
     mainPainPoint: "AI analysis not configured",
     resultInsights: [],
     overallOpportunityScore: 3,
     topActionableIdeas: ["Configure Lambda endpoint to enable AI analysis"]
   });
 }

 return fetch(API_CONFIG.LAMBDA_ENDPOINT, {
   method: 'POST',
   headers: { 'Content-Type': 'application/json' },
   body: JSON.stringify({ query: query, platform: platform, results: results.slice(0, 10) })
 })
 .then(function(response) {
   if (!response.ok) throw new Error('AI analysis failed: ' + response.status);
   return response.json();
 })
 .catch(function(error) {
   console.error('AI analysis error:', error);
   return {
     mainPainPoint: "AI analysis temporarily unavailable",
     resultInsights: [],
     overallOpportunityScore: 3,
     topActionableIdeas: ["AI analysis error - please try again"]
   };
 });
}

function performSearch() {
 var keyword = document.getElementById('searchInput').value.trim();
 if (!keyword) {
   alert('Please enter a search term');
   return;
 }

 var queryType = document.getElementById('queryDropdown').value;
 var platform = document.getElementById('platformSelect').value;
 var timeRange = document.getElementById('timeSelect').value;

 showLoading();

 var query;
 var powerQuery = null;
 
 if (queryType && POWER_QUERIES[queryType]) {
   powerQuery = POWER_QUERIES[queryType];
   query = buildSearchQuery(powerQuery.template, keyword, platform);
 } else {
   query = buildNormalSearchQuery(keyword, platform);
 }
 
 performGoogleSearch(query, timeRange)
   .then(function(results) {
     if (results.length > 0) {
       return analyzeWithAI(results, query, platform)
         .then(function(analysis) {
           currentAnalysis = analysis;
           displayResults(results, powerQuery, keyword, analysis);
         });
     } else {
       displayResults(results, powerQuery, keyword, null);
     }
   })
   .catch(function(error) {
     showError(error.message);
   });
}

function showLoading() {
 var grid = document.getElementById('resultsGrid');
 var resultsHeader = document.getElementById('resultsHeader');
 var downloadBtn = document.getElementById('downloadOpportunitiesBtn');

 resultsHeader.style.display = 'block';
 downloadBtn.style.display = 'none'; // Hide download button during loading
 grid.innerHTML = '<div class="loading-container">' +
   '<div class="loading-spinner"></div>' +
   '<p class="loading-text">Analyzing pain points across platforms...</p>' +
   '</div>';
}

function showError(message) {
 var grid = document.getElementById('resultsGrid');
 var downloadBtn = document.getElementById('downloadOpportunitiesBtn');
 downloadBtn.style.display = 'none'; // Hide download button on error
 grid.innerHTML = '<div class="empty-state">' +
   '<h3>Search Error</h3>' +
   '<p>' + message + '</p>' +
   '</div>';
}

function displayResults(results, powerQuery, keyword, analysis) {
  var grid = document.getElementById('resultsGrid');
  var resultsHeader = document.getElementById('resultsHeader');
  var downloadBtn = document.getElementById('downloadOpportunitiesBtn');

  resultsHeader.style.display = 'block';

  if (!results.length) {
    grid.innerHTML = '<div class="empty-state">' +
      '<h3>No Pain Points Found</h3>' +
      '<p>Try a different search term, platform, or time range to discover customer complaints.</p>' +
      '</div>';
    downloadBtn.style.display = 'none';
    currentSearchResults = [];
    return;
  }
 var html = '';
 currentSearchResults = []; // Clear previous results
 
 for (var i = 0; i < results.length; i++) {
   var result = results[i];
   var platformClass = getPlatformClass(result.displayLink);
   var platformName = getPlatformName(result.displayLink);
   
   var snippet = result.snippet || '';
   var painWords = ['frustrated', 'hate', 'terrible', 'broken', 'annoying', 'wish', 'need', 'help', 'urgent', 'switching', 'alternative', 'missing', 'lack'];
   
   for (var j = 0; j < painWords.length; j++) {
     var word = painWords[j];
     var regex = new RegExp('(^|\\s)(' + word + ')(\\s|$)', 'gi');
     snippet = snippet.replace(regex, '$1<mark>$2</mark>$3');
   }
   
   // Handle insights - check if result has embedded insight (demo data) or use analysis
   var insight;
   if (result.insight) {
     // Demo data has insight embedded in result
     insight = result.insight;
   } else if (analysis) {
     // Real API data - find matching insight
     insight = findInsightForResult(result, analysis);
   } else {
     insight = {
       businessOpportunity: "AI analysis not available for this result",
       urgency: "low"
     };
   }

   // Store for potential download
   currentSearchResults.push({
     title: result.title,
     link: result.link,
     snippet: result.snippet,
     platform: platformName,
     businessOpportunity: insight.businessOpportunity || 'N/A',
     urgency: insight.urgency || 'medium'
   });

   html += '<div class="result-card">' +
     '<div class="card-header">' +
       '<h3 class="result-title">' +
         '<a href="' + result.link + '" target="_blank" rel="noopener">' + escapeHtml(result.title) + '</a>' +
       '</h3>' +
       '<span class="source-badge ' + platformClass + '">' + platformName + '</span>' +
     '</div>' +
     '<div class="result-snippet">' + snippet + '</div>' +
     '<div class="ai-insight">' +
       '<div class="ai-insight-header">' +
         '<div class="ai-insight-label">AI Business Opportunity</div>' +
         '<span class="urgency-badge urgency-' + (insight.urgency || 'medium') + '">' +
           (insight.urgency || 'medium').toUpperCase() +
         '</span>' +
       '</div>' +
       '<div class="ai-insight-text">' + (insight.businessOpportunity || 'Analyzing business opportunity...') + '</div>' +
       '<div style="display: flex; justify-content: flex-end; margin-top: 10px;">' +
         '<button class="copy-opportunity-btn" data-text="' + escapeHtml(insight.businessOpportunity || '') + '" onclick="copyToClipboard(this.dataset.text, \'opportunity\')">Copy Opportunity</button>' +
         '<button class="generate-prd-prompt-btn" data-title="' + escapeHtml(result.title) + '" data-snippet="' + escapeHtml(result.snippet || '') + '" data-opportunity="' + escapeHtml(insight.businessOpportunity || '') + '" onclick="generatePrdPrompt(this.dataset.title, this.dataset.snippet, this.dataset.opportunity)">Generate PRD Prompt</button>' +
       '</div>' +
     '</div>' +
     '<div class="card-footer">' +
       '<span>' + result.displayLink + '</span>' +
       '<span class="copy-link" data-link="' + escapeHtml(result.link) + '" onclick="copyToClipboard(this.dataset.link, \'link\')">Copy Link</span>' +
     '</div>' +
   '</div>';
 }

 grid.innerHTML = html;
  
  // Move download button below the grid instead of in header
  var downloadContainer = document.getElementById('download-container');
  if (!downloadContainer) {
    downloadContainer = document.createElement('div');
    downloadContainer.id = 'download-container';
    downloadContainer.className = 'download-container';
    grid.parentNode.insertBefore(downloadContainer, grid.nextSibling);
  }
  
  if (currentSearchResults.length > 0) {
    downloadContainer.innerHTML = `
      <div class="download-section">
        <h3 class="download-title">Export Your Opportunities</h3>
        <p class="download-subtitle">Download all ${currentSearchResults.length} opportunities as a CSV file for analysis</p>
        <button id="downloadOpportunitiesBtn" class="download-btn" onclick="downloadOpportunities()">
          Download CSV Report
        </button>
      </div>
    `;
    downloadContainer.style.display = 'block';
  } else {
    downloadContainer.style.display = 'none';
  }
}

// Helper function to escape HTML for use in attributes
function escapeHtml(text) {
 if (typeof text !== 'string') return text;
 var map = {
   '&': '&amp;',
   '<': '&lt;',
   '>': '&gt;',
   '"': '&quot;',
   "'": '&#039;'
 };
 return text.replace(/[&<>"']/g, function(m) { return map[m]; });
}

function copyToClipboard(textToCopy, type) {
 type = type || 'text';
 navigator.clipboard.writeText(textToCopy).then(function() {
   var message = '';
   if (type === 'link') message = 'Link copied!';
   else if (type === 'opportunity') message = 'Opportunity copied!';
   else if (type === 'prd-prompt') message = 'PRD prompt copied!';
   else message = 'Copied to clipboard!';
   
   // Simple alert for feedback, could be a toast notification
   alert(message);
 }).catch(function(err) {
   console.error('Failed to copy text: ', err);
   alert('Could not copy text to clipboard. Please try manually.');
 });
}

function downloadOpportunities() {
  if (currentSearchResults.length === 0) {
    alert('No opportunities to download.');
    return;
  }

  // Default to CSV format
  var format = 'csv'; 
  var filename = 'grumpylinks_opportunities_' + new Date().toISOString().slice(0,10);
  var dataStr;
  var contentType;

  // Always use CSV format
  var headers = ["Title", "Link", "Snippet", "Platform", "Business Opportunity", "Urgency"];
  var fieldMapping = {
    "Title": "title",
    "Link": "link", 
    "Snippet": "snippet",
    "Platform": "platform",
    "Business Opportunity": "businessOpportunity",
    "Urgency": "urgency"
  };
  
  var rows = currentSearchResults.map(function(row) {
    return headers.map(function(header) {
      var key = fieldMapping[header];
      var value = row[key];
      if (typeof value === 'string') {
        // Escape double quotes within the string and wrap in double quotes
        return '"' + value.replace(/"/g, '""') + '"';
      }
      return '"' + (value || '') + '"'; // Handle null/undefined values
    }).join(',');
  });
  dataStr = headers.join(',') + '\n' + rows.join('\n');
  contentType = 'text/csv';
  filename += '.csv';

  var blob = new Blob([dataStr], { type: contentType });
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  // Visual feedback
  var btn = event.target;
  var originalText = btn.textContent;
  btn.textContent = 'âœ… Downloaded!';
  btn.style.background = 'linear-gradient(135deg, #16a34a 0%, #15803d 100%)';
  
  setTimeout(function() {
    btn.textContent = originalText;
    btn.style.background = 'linear-gradient(135deg, var(--bg-success) 0%, #16a34a 100%)';
  }, 2000);
}
// Updated generatePrdPrompt function
function generatePrdPrompt(originalTitle, snippet, opportunity) {
  if (!API_CONFIG.LAMBDA_ENDPOINT) {
    alert('PRD generation not configured. Please set up your Lambda endpoint.');
    return;
  }

  // Show loading state for this specific button
  var button = event.target;
  var originalText = button.textContent;
  button.textContent = 'Generating...';
  button.disabled = true;

  // Show PRD container with loading state
  showPrdLoading(originalTitle);

  var progressInterval = startProgressAnimation();

  fetch(API_CONFIG.LAMBDA_ENDPOINT, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ 
      action: 'generate_prd',
      originalTitle: originalTitle,
      snippet: snippet,
      opportunity: opportunity
    })
  })
  .then(function(response) {
    if (!response.ok) {
      throw new Error('PRD generation failed: ' + response.status);
    }
    return response.json();
  })
  .then(function(data) {
    clearInterval(progressInterval);
    if (data.prd) {
      showPrdResults(data.prd, originalTitle, snippet, opportunity);
    } else {
      throw new Error('No PRD content received');
    }
  })
  .catch(function(error) {
    clearInterval(progressInterval);
    console.error('PRD generation error:', error);
    showPrdError(error.message);
  })
  .finally(function() {
    // Restore button state
    button.textContent = originalText;
    button.disabled = false;
  });
}

function showPrdLoading(title) {
  var container = getPrdContainer();
  container.innerHTML = `
    <div class="prd-header">
      <h2 class="prd-title">ðŸ¤– Generating Mini-PRD...</h2>
    </div>
    <div class="prd-loading">
      <div class="prd-loading-spinner"></div>
      <div class="prd-loading-text">Creating your product requirements document for:<br><strong>"${escapeHtml(title)}"</strong></div>
      <div class="prd-progress">
        <div class="prd-progress-bar">
          <div class="prd-progress-fill" id="prd-progress-fill"></div>
        </div>
      </div>
    </div>
  `;
  container.style.display = 'block';
  
  // Scroll to PRD container
  container.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function startProgressAnimation() {
  var progress = 0;
  var progressFill = document.getElementById('prd-progress-fill');
  
  return setInterval(function() {
    progress += Math.random() * 15; // Random progress increments
    if (progress > 90) progress = 90; // Don't complete until actual completion
    
    if (progressFill) {
      progressFill.style.width = progress + '%';
    }
  }, 500);
}
function showPrdResults(prdContent, originalTitle, snippet, opportunity) {
  var container = getPrdContainer();
  
  // Create a clean title from the original source
  var cleanTitle = originalTitle
    .replace(/^.*?:\s*"?/, '') // Remove "Username on Platform:" prefix
    .replace(/["'].*$/, '')     // Remove quotes and everything after
    .replace(/\.\.\.$/, '')     // Remove trailing ellipsis
    .replace(/[^\w\s-]/g, '')   // Remove special characters except spaces and hyphens
    .trim()
    .substring(0, 50);          // Limit length
  
  // If title is too short or generic, use the business opportunity
  if (cleanTitle.length < 10) {
    cleanTitle = opportunity.substring(0, 50) + '...';
  }
  
  // Format the PRD content
  var formattedContent = formatPrdContent(prdContent);
  
  container.innerHTML = `
    <div class="prd-header">
      <h2 class="prd-title">Mini Product Requirements Document for ${cleanTitle}</h2>
      <div class="prd-actions">
        <button class="prd-action-btn" onclick="copyPrdToClipboard()">Copy PRD</button>
        <button class="prd-action-btn secondary" onclick="downloadPrd()">Download</button>
        <button class="prd-action-btn secondary" onclick="closePrd()">âœ• Close</button>
      </div>
    </div>
    
    <div class="prd-content" id="prd-content">
      ${formattedContent}
    </div>
  `;
  
  // Store PRD content globally for copy/download
  window.currentPrdContent = prdContent;
  
  // Complete the progress bar
  var progressFill = document.getElementById('prd-progress-fill');
  if (progressFill) {
    progressFill.style.width = '100%';
  }
  
  // Scroll to PRD container
  setTimeout(function() {
    container.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 100);
}
function showPrdError(errorMessage) {
  var container = getPrdContainer();
  container.innerHTML = `
    <div class="prd-header">
      <h2 class="prd-title">âŒ PRD Generation Failed</h2>
      <div class="prd-actions">
        <button class="prd-action-btn secondary" onclick="closePrd()">âœ• Close</button>
      </div>
    </div>
    <div class="prd-content">
      <p style="color: var(--bg-danger); text-align: center; padding: 20px;">
        Failed to generate PRD: ${escapeHtml(errorMessage)}<br>
        <small>Please try again or check your connection.</small>
      </p>
    </div>
  `;
}

function getPrdContainer() {
  var container = document.getElementById('prd-container');
  if (!container) {
    container = document.createElement('div');
    container.id = 'prd-container';
    container.className = 'prd-container';
    
    // Insert after results grid
    var resultsGrid = document.getElementById('resultsGrid');
    resultsGrid.parentNode.insertBefore(container, resultsGrid.nextSibling);
  }
  return container;
}
function formatPrdContent(content) {
  // Remove emojis and clean up markdown formatting
  var cleaned = content
    // Remove all emojis first
    .replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '')
    // Clean up any emoji spans
    .replace(/<span[^>]*>[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]<\/span>/gu, '');

  // Split into sections by h2 headers
  var sections = cleaned.split(/(?=^## )/gm);
  
  var processedSections = sections.map(function(section) {
    // Convert headers first
    var processed = section
      .replace(/^# (.*$)/gm, '<h1>$1</h1>')
      .replace(/^## (.*$)/gm, '<h2>$1</h2>')
      .replace(/^### (.*$)/gm, '<h3>$1</h3>');
    
    // Convert numbered lists (reset numbering for each section)
    var lines = processed.split('\n');
    var inNumberedList = false;
    var listItems = [];
    
    for (var i = 0; i < lines.length; i++) {
      var line = lines[i];
      
      // Check if this line is a numbered list item
      if (/^\d+\.\s+/.test(line)) {
        // Extract the content after the number
        var content = line.replace(/^\d+\.\s+/, '');
        listItems.push('<li>' + content + '</li>');
        inNumberedList = true;
      } else {
        // If we were in a numbered list and this line isn't, close the list
        if (inNumberedList && listItems.length > 0) {
          lines[i - listItems.length] = '<ol>' + listItems.join('') + '</ol>';
          // Remove the processed list items
          for (var j = 1; j < listItems.length; j++) {
            lines[i - listItems.length + j] = '';
          }
          listItems = [];
          inNumberedList = false;
        }
      }
    }
    
    // Handle list at end of section
    if (inNumberedList && listItems.length > 0) {
      lines[lines.length - listItems.length] = '<ol>' + listItems.join('') + '</ol>';
      for (var k = 1; k < listItems.length; k++) {
        lines[lines.length - listItems.length + k] = '';
      }
    }
    
    return lines.join('\n');
  });
  
  // Join sections back together
  var result = processedSections.join('');
  
  // Continue with other formatting
  return result
    // Convert bold and italic
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.*?)\*/g, '<em>$1</em>')
    // Convert bullet lists
    .replace(/^[-*]\s+(.*)$/gm, '<li>$1</li>')
    // Wrap bullet list items
    .replace(/(<li>(?!.*<\/ol>).*<\/li>(?:\s*<li>(?!.*<\/ol>).*<\/li>)*)/gs, '<ul>$1</ul>')
    // Convert line breaks to paragraphs
    .replace(/\n\n+/g, '</p><p>')
    .replace(/^(?!<[huo])(.+)$/gm, '<p>$1</p>')
    // Clean up empty paragraphs and extra whitespace
    .replace(/<p><\/p>/g, '')
    .replace(/<p>\s*<\/p>/g, '')
    .replace(/\n\s*\n/g, '\n')
    .trim();
}
function copyPrdToClipboard() {
  if (window.currentPrdContent) {
    navigator.clipboard.writeText(window.currentPrdContent).then(function() {
      // Visual feedback
      var btn = event.target;
      var originalText = btn.textContent;
      btn.textContent = 'âœ… Copied!';
      btn.style.background = 'var(--bg-success)';
      
      setTimeout(function() {
        btn.textContent = originalText;
        btn.style.background = 'var(--bg-button)';
      }, 2000);
    }).catch(function() {
      alert('Could not copy to clipboard. Please select and copy manually.');
    });
  }
}

function downloadPrd() {
  if (window.currentPrdContent) {
    var filename = 'mini-prd-' + new Date().toISOString().slice(0,10) + '.md';
    var blob = new Blob([window.currentPrdContent], { type: 'text/markdown' });
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    // Visual feedback
    var btn = event.target;
    var originalText = btn.textContent;
    btn.textContent = 'âœ… Downloaded!';
    btn.style.background = 'var(--bg-success)';
    
    setTimeout(function() {
      btn.textContent = originalText;
      btn.style.background = 'var(--bg-tertiary)';
    }, 2000);
  }
}

function closePrd() {
  var container = document.getElementById('prd-container');
  if (container) {
    container.style.display = 'none';
  }
}

// Add these to your global scope
window.copyPrdToClipboard = copyPrdToClipboard;
window.downloadPrd = downloadPrd;
window.closePrd = closePrd;
// Expose functions to global scope for onclick handlers
window.copyToClipboard = copyToClipboard;
window.toggleFAQ = toggleFAQ;
window.downloadOpportunities = downloadOpportunities;
window.generatePrdPrompt = generatePrdPrompt;
window.copyPrdToClipboard = copyPrdToClipboard;
window.downloadPrd = downloadPrd;
window.closePrd = closePrd;

init();
</script>
</body>
</html>